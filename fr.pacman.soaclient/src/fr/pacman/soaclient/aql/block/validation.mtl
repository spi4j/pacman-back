[module validation(	'http://www.obeonetwork.org/dsl/soa/4.0.0', 
					'http://www.obeonetwork.org/dsl/environment/3.0.0')/]



[import fr::pacman::core::aql::validation::common/]
[import fr::pacman::core::validation::PacmanValidatorsReport/]
				
[comment écriture du rapport de validation pour un fichier de modélisation (soa)./]
[comment pour les dtos on est pas relié directement à la base de données, doit on être plus souple sur les références ?/]
[template public validation (m : soa::System)]
  [for (o | m.eAllContents(environment::DTO))]
    [comment pas de dto avec un mot-clé java./]
    [if (o.name.isJavaKeyword())][o.add(o.err1())/][/if]
  [/for]
  [for (o | m.eAllContents(environment::Reference))]
    [comment pas de dto avec un mot-clé java./]
    [if (o.name.isJavaKeyword())][o.add(o.err2())/][/if]
  [/for]
  [for (o | m.eAllContents(soa::Service))]
    [comment pas de service avec un mot-clé java./]
    [if (o.name.isJavaKeyword())][o.add(o.err3())/][/if]
  [/for]
  [for (o | m.eAllContents(soa::Parameter))]
    [comment pas de paramètre avec un mot-clé java./]
    [if (o.name.isJavaKeyword())][o.add(o.err4())/][/if]
  [/for]
  [for (o | m.eAllContents(soa::Operation))]
    [comment pas d'opération avec un mot-clé java./]
    [if (o.name.isJavaKeyword())][o.add(o.err5())/][/if]
  [/for]
  [for (o | m.eAllContents(environment::Attribute))]
    [comment pas d'attribut avec un mot-clé java./]
    [if (o.name.isJavaKeyword())][o.add(o.err6())/][/if]
  [/for]
  [for (o | m.eAllContents(environment::Literal))]
    [comment pas d'attribut d'énumération avec un mot-clé java./]
    [if (o.name.isJavaKeyword())][o.add(o.err7())/][/if]
  [/for]
  [for (o | m.eAllContents(environment::Enumeration))]
    [comment pas d'énumération avec un mot-clé java./]
    [if (o.name.isJavaKeyword())][o.add(o.err8())/][/if]
  [/for]
  [comment pas de nom de référence en double./]
  [let rs = m.eAllContents(environment::Reference)]
    [if (not (rs.name->asSet()->size() = rs->size()))]
      [for (r | rs)]
        [if (rs->select(o| o.name = r.name)->size() > 1)]
          [comment r.add(r.err8())/]
        [/if]
      [/for]
    [/if]
  [/let]
[/template]

[comment vérifie si le nom d'un élement correspond à un mot-clé java./]
[query public isJavaKeyword(s : String) : Boolean =
    s.toLower()
      .matches('abstract|assert|boolean|break|byte|case|catch|char|class|const|continue|'
              + 'default|do|double|else|enum|extends|final|finally|float|for|goto|if|'
              + 'implements|import|instanceof|int|interface|long|native|new|null|package|'
              + 'private|protected|public|return|short|static|strictfp|super|switch|'
              + 'synchronized|this|throw|throws|transient|try|void|volatile|while')
/]

[comment impossible de créer des éléments (objets) avec comme nom un mot-clé java./]
[query private err1 (o : environment::DTO) : String = 'RG_01@' + o.nameObject() + '@Présence de mot-clé java@Modifiez le nom du dto'/]
  
[comment impossible de créer des éléments (objets) avec comme nom un mot-clé java./]
[query private err2 (o : environment::Reference) : String = 'RG_01@' + o.nameObject() + '@Présence de mot-clé java@Modifiez le nom de la référence'/]
  
[comment impossible de créer des éléments (objets) avec comme nom un mot-clé java./]
[query private err3 (o : soa::Service) : String = 'RG_01@' + o.nameObject() + '@Présence de mot-clé java@Modifiez le nom du service'/]
  
[comment impossible de créer des éléments (objets) avec comme nom un mot-clé java./]
[query private err4 (o : soa::Parameter) : String = 'RG_01@' + o.nameObject() + '@Présence de mot-clé java@Modifiez le nom du paramètre'/]
  
[comment impossible de créer des éléments (objets) avec comme nom un mot-clé java./]
[query private err5 (o : soa::Operation) : String = 'RG_01@' + o.nameObject() + '@Présence de mot-clé java@Modifiez le nom de l\'opération'/]

[comment impossible de créer des éléments (objets) avec comme nom un mot-clé java./]
[query private err6 (o : environment::Attribute) : String = 'RG_01@' + o.nameObject() + '@Présence de mot-clé java@Modifiez le nom de l\'attribut'/]

[comment impossible de créer des éléments (objets) avec comme nom un mot-clé java./]
[query private err7 (o : environment::Literal) : String = 'RG_01@' + o.nameObject() + '@Présence de mot-clé java@Modifiez le nom du litéral'/]

[comment impossible de créer des éléments (objets) avec comme nom un mot-clé java./]
[query private err8 (o : environment::Enumeration) : String = 'RG_01@' + o.nameObject() + '@Présence de mot-clé java@Modifiez le nom de l\'énumération'/]
  
[comment impossible de créer plusieurs références avec le même nom./]
[query private err9(o : environment::Reference) : String = 'RG_02@' + o.nameObject() + '@Références avec un nom identique@Modifiez le nom des références'/]
