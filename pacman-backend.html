<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üõ†Ô∏è Documentation Technique<br>Pacman G√©n√©rateur de Code Java Backend</title>
<style>
 body { margin:0; font-family: Arial,sans-serif; display: block; overflow-x: hidden;}
  .sidebar { display:none; }
  main { margin-left: 350px; padding: 2em; }
  .local-toc { position: fixed; left: 10px; top: 1em; width: 300px; background: #fafafa; 
   border: 1px solid #ddd; padding: 1em; max-height: 90vh; overflow-y: auto; font-size: 0.9em; }
  .local-toc ul { list-style: none; padding-left: 1em; }
  .local-toc li { margin: 0.3em 0; }
  .local-toc a { text-decoration: none ; color: #1A5276}
  .local-toc a:visited { color: #1A5276;}
  .local-toc a:hover { color: #5499c7; text-decoration: none;}
  table { border-collapse: collapse; width: 100%; margin: 1.5em 0; font-size: 0.95em; background-color: #fff; border: 1px solid #ccc;}
  thead { background-color: #f2f2f2;}
  th, td { border: 1px solid #ccc; padding: 0.6em 0.8em; text-align: left; vertical-align: top;}
  tr:nth-child(even) { background-color: #f9f9f9;}
  pre {background: #f5f5f5; border: 1px solid #ccc; padding: 0.3em; border-radius: 4px;}
  img { max-width: 100%; height: auto; border: 1px solid #000000; border-radius: 4px; box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
   margin: 1em 0; display: block; padding: 5px; background-color: white;}
  /* Styles Pygments pour le code coloris√© */
  pre { line-height: 125%; }
td.linenos .normal { color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f0f0f0; }
.codehilite .c { color: #60A0B0; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #F00 } /* Error */
.codehilite .k { color: #007020; font-weight: bold } /* Keyword */
.codehilite .o { color: #666 } /* Operator */
.codehilite .ch { color: #60A0B0; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #60A0B0; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #007020 } /* Comment.Preproc */
.codehilite .cpf { color: #60A0B0; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #60A0B0; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #60A0B0; background-color: #FFF0F0 } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.codehilite .gr { color: #F00 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888 } /* Generic.Output */
.codehilite .gp { color: #C65D09; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #04D } /* Generic.Traceback */
.codehilite .kc { color: #007020; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #007020 } /* Keyword.Pseudo */
.codehilite .kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #902000 } /* Keyword.Type */
.codehilite .m { color: #40A070 } /* Literal.Number */
.codehilite .s { color: #4070A0 } /* Literal.String */
.codehilite .na { color: #4070A0 } /* Name.Attribute */
.codehilite .nb { color: #007020 } /* Name.Builtin */
.codehilite .nc { color: #0E84B5; font-weight: bold } /* Name.Class */
.codehilite .no { color: #60ADD5 } /* Name.Constant */
.codehilite .nd { color: #555; font-weight: bold } /* Name.Decorator */
.codehilite .ni { color: #D55537; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #007020 } /* Name.Exception */
.codehilite .nf { color: #06287E } /* Name.Function */
.codehilite .nl { color: #002070; font-weight: bold } /* Name.Label */
.codehilite .nn { color: #0E84B5; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #062873; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #BB60D5 } /* Name.Variable */
.codehilite .ow { color: #007020; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #BBB } /* Text.Whitespace */
.codehilite .mb { color: #40A070 } /* Literal.Number.Bin */
.codehilite .mf { color: #40A070 } /* Literal.Number.Float */
.codehilite .mh { color: #40A070 } /* Literal.Number.Hex */
.codehilite .mi { color: #40A070 } /* Literal.Number.Integer */
.codehilite .mo { color: #40A070 } /* Literal.Number.Oct */
.codehilite .sa { color: #4070A0 } /* Literal.String.Affix */
.codehilite .sb { color: #4070A0 } /* Literal.String.Backtick */
.codehilite .sc { color: #4070A0 } /* Literal.String.Char */
.codehilite .dl { color: #4070A0 } /* Literal.String.Delimiter */
.codehilite .sd { color: #4070A0; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #4070A0 } /* Literal.String.Double */
.codehilite .se { color: #4070A0; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #4070A0 } /* Literal.String.Heredoc */
.codehilite .si { color: #70A0D0; font-style: italic } /* Literal.String.Interpol */
.codehilite .sx { color: #C65D09 } /* Literal.String.Other */
.codehilite .sr { color: #235388 } /* Literal.String.Regex */
.codehilite .s1 { color: #4070A0 } /* Literal.String.Single */
.codehilite .ss { color: #517918 } /* Literal.String.Symbol */
.codehilite .bp { color: #007020 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #06287E } /* Name.Function.Magic */
.codehilite .vc { color: #BB60D5 } /* Name.Variable.Class */
.codehilite .vg { color: #BB60D5 } /* Name.Variable.Global */
.codehilite .vi { color: #BB60D5 } /* Name.Variable.Instance */
.codehilite .vm { color: #BB60D5 } /* Name.Variable.Magic */
.codehilite .il { color: #40A070 } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<nav class="sidebar"><ul><li><a href="chapter_1.html">üõ†Ô∏è Documentation Technique<br>Pacman G√©n√©rateur de Code Java Backend</a></li></ul></nav>
<main>
<h1>üõ†Ô∏è Documentation Technique<br>Pacman G√©n√©rateur de Code Java Backend</h1>
<p>üìÖ Historique des mises √† jour</p>
<ul>
<li>20/05/2025 : Initialisation du document.</li>
<li>04/06/2025 : Ajouts : Coffre fort, H√©ritage, Relations, R√®gles de gestion, Transactions.</li>
</ul>
<hr/>
<h2 id="introduction">üöÄ Introduction</h2>
<hr/>
<p>Cette documentation d√©crit le fonctionnement du plugin Eclipse <strong>Pacman</strong>, nouvelle version <strong>V5</strong>, dont l'objectif est de g√©n√©rer automatiquement du code Java √† partir de diff√©rentes mod√©lisations graphiques sous ISD (Information System Designer). </p>
<p>Elle apporte l'ensemble des informations n√©cessaires sur la mod√©lisation et la g√©n√©ration d'une application de type <strong>backend</strong> afin de mettre √† disposition un ou plusieurs services REST pour une application de type <strong>frontend</strong>. </p>
<p>Elle est destin√©e aux d√©veloppeurs souhaitant comprendre et utiliser l'ensemble des g√©n√©rateurs. </p>
<p>Il est √† noter que cette documentation ne rentre pas dans les d√©tails de la mod√©lisation de l'application, aspect dont les bases sont cens√©es √™tre d√©j√† connues et ma√Ætris√©es par les developpeurs qui vont utiliser cette version du plugin  <strong>pacman</strong>. Se reporter aux diff√©rents documents ad hoc pour plus d'informations sur ce sujet.</p>
<p>‚ùó Les nommages des diff√©rentes classes est ici donn√© avec la configuration par d√©faut du fichier de nommage qui est g√©n√©r√© avec un nouveau projet. Il sont donc susceptibles d'√©voluer en fonction des r√®gles pr√©cis√©es par les d√©veloppeurs de l'application cible.</p>
<p>‚ùó De nombreux exemples de code Java sont donn√©s dans le cadre de ce document, afin de ne pas rendre le code trop verbeux et trop long √† lire, ces exemples ont pour la plupart, √©t√© expurg√©s de la majorit√© des commentaires de type Javadoc.</p>
<h2 id="le-plugin-et-larchitecture-hexagonale">üß© Le Plugin et l'architecture hexagonale</h2>
<hr/>
<h3 id="pacman">Pacman</h3>
<p>Pacman V5 est un un g√©n√©rateur de code bas√© sur  : </p>
<ul>
<li>
<p><strong>Spring Boot</strong> : framework Java open-source con√ßu pour simplifier le d√©veloppement d'applications Spring. Il permet de cr√©er des applications pr√™tes √† l‚Äôemploi avec un minimum de configuration, gr√¢ce √† une approche "opinionated" (pr√©configur√©e). Il int√®gre un serveur embarqu√© (comme Tomcat) et g√®re automatiquement les d√©pendances via Spring Boot Starters. C‚Äôest un choix courant pour d√©velopper des API REST et, de mani√®re plus g√©n√©rale, des microservices en Java.</p>
</li>
<li>
<p><strong>l'architecture hexagonale</strong> : style d‚Äôarchitecture logicielle qui vise √† isoler le c≈ìur m√©tier (la logique d'application) des d√©tails techniques (comme les bases de donn√©es, les APIs, les interfaces utilisateur). Le c≈ìur communique avec l‚Äôext√©rieur via des "ports" (interfaces), que des "adapters" impl√©mentent. Cela facilite les tests, la maintenance et l‚Äô√©volution, tout en favorisant une forte s√©paration des responsabilit√©s.</p>
</li>
</ul>
<h3 id="architecture-hexagonale">Architecture hexagonale</h3>
<p>Si le framework SpringBoot ne n√©cessite pas d'explication particuli√®re dans le cadre de ce document (les d√©veloppeurs qui vont utiliser les g√©n√©rateurs Pacman sont cens√©s √™tre familier avec cette technologie) , un rappel plus approfondi est toutefois primordial concernant l'architecture hexagonale et ses diverses implications dans l'utilisation des g√©n√©rateurs.</p>
<p>Comme pr√©cit√©, l'objectif principal de l'architecture hexagonale est de s√©parer compl√®tement la couche m√©tier et les diff√©rentes couches techniques qui permettent d'utiliser ce m√©tier. </p>
<p>Pour simplifier √† ce niveau du document, la couche m√©tier est g√©n√©ralement appel√©e "domaine" et les autres couches sont int√©gr√©es dans ce que l'on appelle "l'infrastructure".  Il est surtout utile de retenir (comme vu plus haut) qu'il s'agit d'une architecture de type "<em>port - adapters</em>", au niveau Java, les "<em>ports</em>" seront donc des interfaces (au sens premier du terme) qui vont permettre aux diff√©rents couches de communiquer entre elles. Les impl√©mentations quant √† elles, seront des "<em>adapters</em>" qui impl√©mententeront ces interfaces.</p>
<p>Dans le cadre de <strong>Pacman</strong> cette architecture a √©t√© choisie car elle apporte (entre autres), deux avantages particuli√®rement int√©ressants : </p>
<ul>
<li>
<p>Gr√¢ce √† cette isolation, le c≈ìur de l‚Äôapplication (le domaine) n‚Äôa aucune connaissance directe de l‚Äôimpl√©mentation des interfaces techniques (comme les bases de donn√©es, les API externes ou les frameworks). Cela autorise, par exemple, √† placer le code m√©tier et le code d‚Äôinfrastructure dans deux d√©p√¥ts Git distincts. Ainsi, le d√©p√¥t contenant la logique m√©tier peut √™tre partag√© ou ouvert sans exposer les d√©tails sensibles ou propri√©taires li√©s √† l‚Äôinfrastructure, ce qui renfor√ße la s√©curit√©, la confidentialit√© et la portabilit√© du domaine m√©tier.</p>
</li>
<li>
<p>En encapsulant les d√©pendances techniques derri√®re des interfaces (<em>ports</em>), toute impl√©mentation sp√©cifique (<em>adaptateur</em>) peut √™tre modifi√©e, remplac√©e ou mise √† jour de mani√®re transparente pour la logique m√©tier. Ainsi, il est possible de migrer d‚Äôun framework web, d‚Äôun ORM ou d‚Äôun syst√®me de messagerie vers un autre sans r√©√©crire ou alt√©rer le code m√©tier. Cette ind√©pendance garantit une meilleure p√©rennit√© du c≈ìur fonctionnel de l‚Äôapplication et r√©duit les co√ªts li√©s aux √©volutions technologiques.</p>
</li>
</ul>
<p>‚ùó  Il est √† noter toutefois, un inconvient majeur de cette architecture. Dans le cadre de services de type CRUD (ou plus g√©n√©ralement pour des services qui ne font que manipuler des informations en base de donn√©es), la couche m√©tier sert uniquement de "passe-plat" entre les couches d'appel et les couches de persistance et n'apporte pas n√©cessairement de plus-value.</p>
<p>Voici un bref sch√©ma r√©capitulatif de cette architecture (en rapport avec l'√©tat actuel des g√©n√©rateurs de pacman) : </p>
<div align="center">
<img alt="Architecture hexagonale" src="images/pcm-hexagonal-1.png" width="500"/>
</div>
<h3 id="pacman-et-lhexagonal">Pacman et l'hexagonal</h3>
<p>La mani√®re dont Pacman g√®re et structure un projet en fonction de l'architecture hexagonale est la suivante (diff√®re tr√®s peu du standard). Il convient en premier lieu de noter que, en architecture hexagonale, le vocabulaire varie selon les auteurs et les contextes, d'o√π l'importance (de mani√®re g√©n√©rale) de bien d√©finir les termes d√®s le d√©part d'un projet pour assurer une compr√©hension commune et √©viter toute ambigu√Øt√© dans l‚Äôarchitecture. </p>
<p>Les ports entrants (<em>inbound ports</em>) repr√©sentent les points d'entr√©e vers le c≈ìur m√©tier : ce sont g√©n√©ralement des interfaces d√©finies dans le domaine que les adaptateurs entrants (par exemple, un contr√¥leur REST ou une interface utilisateur) appellent. Les ports sortants (<em>outbound ports</em>), eux, sont les interfaces que le domaine utilise pour solliciter des services externes (comme une base de donn√©es ou un service distant). Leurs impl√©mentations sont fournies par des adaptateurs sortants. </p>
<p>Certains parlent aussi d'API pour d√©signer les ports (<em>inbound</em>), et de SPI (Service Provider Interface) pour d√©signer les ports <em>outbound</em>. Les "<em>use cases</em>" ou cas d‚Äôusage incarnent la logique applicative et sont souvent mis en ≈ìuvre via des services m√©tier appel√©s par les ports entrants. Le terme "<em>features</em>" peut quant √† lui d√©signer un regroupement fonctionnel de use cases, surtout dans des approches modulaires ou orient√©es produit. Cependant, bien que la terminologie puisse varier, l‚Äôobjectif reste toujours le m√™me : s√©parer clairement les responsabilit√©s.</p>
<p>Pour Pacman lors de l'initialisation d'un projet, le g√©n√©rateur va toujours cr√©er quatre projets distincts qui sont respectivement : </p>
<ul>
<li>
<p><strong><em>[Nom du projet]</em></strong> : capsule pour l'ensemble des trois autres projets. Pacman √©tant un g√©n√©rateur qui produit des projets de type "Maven", ce projet contient donc le fichier de configuration parent (pom.xml) qui g√®re l'ensemble des ressources disponibles (librairies, plugins, etc...) et de mani√®re g√©n√©rale le cycle de vie du projet pendant sa phase de d√©veloppement. </p>
</li>
<li>
<p><strong><em>[Nom du projet]-model</em></strong> : contient les diff√©rents fichiers de mod√©lisation de l'application ainsi que les fichiers de configuration pour les options de g√©n√©ration de l'application. Ce projet ne contient (et ne doit contenir) aucun code. </p>
</li>
<li>
<p><strong><em>[Nom du projet]-domain</em></strong> : comme pr√©cit√©, contient l'ensemble des services m√©tier. Ce projet ne contient aucune r√©f√©rence √† un quelconque framework ou code technique. Il embarque toutes les ressources n√©cessaires pour pouvoir fonctionner (au niveau m√©tier) en totale autonomie, ce qui englobe  les classes m√©tier, les √©ventuelles exceptions m√©tier, les classes de test, les classes pour les r√®gles d'exigences, etc... En termes de vocabulaire, il est √† juste noter que si, au niveau m√©tier, on manipule des objets de transfert (DTO), au niveau des packages, on parlera toujours plut√¥t d'entit√©s afin d'√™tre raccord avec l'infrastructure.</p>
</li>
<li>
<p><strong><em>[Nom du projet]-server</em></strong> : le projet dit "d'infrastructure" qui contient l'ensemble du code d'ex√©cution pour que l'utilisateur externe puisse int√©ragir avec le code m√©tier. Vu la verbosit√© inh√©rente √† ce type d'architecture et au nombre √©l√©v√© de classes et/ou d'interfaces qu'elle entraine, il a √©t√© d√©cid√© de "couper" la notion g√©n√©rale d'infrastructure en deux afin de mieux structurer la r√©partition du code (packages). On parlera donc "d'application" pour toute la partie "<em>inbounds</em>" et "d'infrastructure" uniquement pour la partie "<em>outbounds</em>". Par ailleurs, on d√©laisse la notion de "<em>use case</em>", trop proche d'XML, et on parlera donc de "<em>features</em>" pour les services m√©tier ainsi que de "<em>providers</em>" pour les services techniques (acc√®s √† la couche de persistance).</p>
</li>
</ul>
<h2 id="installation">üõ†Ô∏è Installation</h2>
<hr/>
<h3 id="prerequis">Pr√©requis</h3>
<ul>
<li>Version Information System Designer  :  5.1.1+</li>
<li>JDK : 17+</li>
</ul>
<h3 id="etapes">Etapes</h3>
<p>1 - T√©l√©chargement du plugin  </p>
<ul>
<li>Le plugin (sous forme de fichier au format .zip) est t√©l√©chargeable √† partir de l'URI suivante : https://github.com/spi4j/pacman-back...</li>
<li>Charger le plugin et le stocker dans un r√©pertoire de votre choix sur le disque. </li>
</ul>
<p>2 - Installation dans Eclipse  </p>
<ul>
<li>Ouvrir Information System Designer et aller dans le menu "<em>/Help/Install New Software...</em>".</li>
<li>Cliquer sur le bouton "<em>Add</em>".</li>
<li>Cliquer sur le bouton "<em>Archive</em>".</li>
<li>Rechercher et s√©lectionner l'archive <strong>Pacman</strong> (format .zip) pr√©alablement charg√©e sur le disque.</li>
</ul>
<div align="center">
<img alt="Installation" src="images/pcm-install-1.png" width="500"/>
</div>
<ul>
<li>Cliquer sur le bouton "<em>Add</em>".</li>
<li>Cliquer sur le bouton "Select All".</li>
<li>D√©cocher la case "<em>Contact all updates sites during install to find required software</em>".</li>
</ul>
<div align="center">
<img alt="Installation" src="images/pcm-install-2.png" width="500"/>
</div>
<ul>
<li>Cliquer sur le bouton "<em>Next</em>".</li>
<li>V√©rifier la bonne prise en compte de l'ensemble des plugins qui vont √™tre install√©s.</li>
</ul>
<div align="center">
<img alt="Installation" src="images/pcm-install-3.png" width="500"/>
</div>
<ul>
<li>Cliquer sur le bouton "<em>Finish</em>"</li>
<li><strong>Pacman</strong> n'√©tant pas sign√©, cliquer sur le bouton "Select All".</li>
</ul>
<div align="center">
<img alt="Installation" src="images/pcm-install-4.png" width="500"/>
</div>
<ul>
<li>Cliquer sur le bouton "<em>True Selected</em>".</li>
</ul>
<div align="center">
<img alt="Installation" src="images/pcm-install-5.png" width="500"/>
</div>
<ul>
<li>Valider la demande de red√©marrage pour ISD en cliquant sur le bouton "<em>Restart Now</em>".</li>
</ul>
<p>3 - V√©rification de l'installation  </p>
<ul>
<li>Aller dans le menu "<em>/Help/About Obeo Designer Entreprise Edition....</em>".</li>
<li>V√©rifier la pr√©sence de l'ic√¥ne <strong>Pacman</strong> au niveau de la fen√™tre avec la liste des plugins install√©s. (ic√¥ne non contractuelle)</li>
</ul>
<div align="center">
<img alt="Installation" src="images/pcm-install-6.png" width="350"/>
</div>
<ul>
<li>Il est aussi possible d'aller voir plus loin en cliquant sur le bouton "<em>Installation Details</em>" et en v√©rifiant la liste des plugins au niveau du premier onglet "<em>Installed Software</em>".</li>
</ul>
<div align="center">
<img alt="Installation" src="images/pcm-install-7.png" width="500"/>
</div>
<h2 id="creation-dun-projet">‚òï Cr√©ation d'un projet</h2>
<hr/>
<p>Une fois ISD activ√©, se positionner sur la perspective "<em>Modeling</em>", situ√©e en haut √† gauche de l'IDE.   </p>
<p>Puis, se positionner (comme tout autre cr√©ation de projet) sur la vue "<em>Model Explorer</em>" et effectuer un click droit "<em>New/Project...</em>" ou se positionner dans le menu "<em>File/New/Project...</em>" en haut de l'IDE. </p>
<div align="center">
<img alt="Nouveau projet pacman" src="images/pcm-new-project-1.png" width="500"/>
</div>
<p>Naviguer dans l'arborescence jusqu'au r√©pertoire "<em>IS Designer</em>" et s√©lectionner "<em>Projet Cali</em>". Une fen√™tre de cr√©ation d'un nouvel applicatif de type "Pacman" apparait alors afin de saisir les diverses informations structurantes pour la g√©n√©ration du projet. </p>
<h3 id="wizard-de-creation">Wizard de cr√©ation</h3>
<p>Trois onglets sont disponibles : </p>
<p>‚û§ <strong>Projet</strong> : Saisir le nom d√©sir√© pour le projet, ainsi que l'auteur ou l'organisme, par d√©faut le package racine est automatiquement cr√©√© en fonction du nom pr√©alabalement saisi. Il est toutefois possible de le modifier manuellement en le saisissant directement dans le champ pr√©vu √† cet effet. Au niveau des options la version actuelle de <strong>Pacman</strong> ne permet de cr√©er que des projets de services REST avec le framework SpringBoot. Les champs "Type" et "Framework" ne contiennent donc pour l'instant qu'une seule valeur, √† l'heure de l'√©criture de ce document. Enfin s√©lectionner la (ou les) bases de donn√©es √† l'aide des deux listes d√©roulantes et des deux boutons pour faire passer la s√©lection de l'une √† l'autre des listes.</p>
<p>‚ùó La base H2 est toujours embarqu√©e par d√©faut, ne serait-ce que pour les tests unitaires.</p>
<div align="center">
<img alt="Nouveau projet pacman" src="images/pcm-new-project-2.png" width="500"/>
</div>
<p>‚û§ <strong>Base de donn√©es</strong> : Comme son nom l'indique, cet onglet permet de saisir l'ensemble des informations sp√©cifiques aux bases de donn√©es (hormis la s√©lection des bases qui a √©t√© effectu√©e au niveau de l'onglet pr√©c√©dent). Si les tables on besoin d'un pr√©fixe au niveau des scripts SQL (ex : "<em>TBL_</em>" ou "<em>MATABLE_</em>", etc...) le saisir au niveau du champ pr√©vu √† cet effet, de m√™me pour la cr√©ation d'un sch√©ma. Il est par ailleurs possible de saisir une liste de champs suppl√©mentaires qui seront automatiquement ajout√©s √† toutes les tables (donc √† toutes les entit√©s mod√©lis√©es). </p>
<p>Trois types de champ sont pr√©d√©finis (il suffit juste de les s√©lectionner, la ligne n'est pas saisissable par la suite) : </p>
<ul>
<li><em>Xtopsup</em> : ajoute un indicateur de suppression logique (automatiquement g√©r√© par Spring Data).</li>
<li><em>Xdmaj</em> : ajoute une date de derni√®re modification (automatiquement g√©r√©e par Spring Data).</li>
<li><em>Xuuid</em> : ajoute un identifiant universel (en plus de la cl√© primaire), g√©r√© par Pacman.</li>
</ul>
<p>Par ailleurs, il est possible de rajouter autants de champs suppl√©mentaires que d√©sir√©s, en s√©lectionnant le type, puis en renseignant les diff√©rentes rubriques.</p>
<div align="center">
<img alt="Nouveau projet pacman" src="images/pcm-new-project-3.png" width="500"/>
</div>
<p>Exemple avec les trois champs pr√©d√©finis (pour annuler une s√©lection, s√©lectionner la ligne blanche en premi√®re position dans la liste d√©roulante) : </p>
<div align="center">
<img alt="Nouveau projet pacman" src="images/pcm-new-project-3-b.png" width="500"/>
</div>
<p>‚ùó Ces champs sont uniquement destin√©s √† la couche de persistance, ils sont donc remont√©s uniquement au niveau des objets m√©tier pour des √©ventuels traitements associ√©s √† la valeur des ces attributs, mais ne passent jamais la couche m√©tier et ne sont donc jamais transmis au niveau des services REST. Un seul champ fait exception √† cette r√®gle, le champ <em>Xuuid</em>.</p>
<p>‚û§ <strong>Autre</strong> : </p>
<p>Il s'agit ici de l'ensemble des autres options qui permettent de prendre les d√©cisions structurantes pour la cr√©ation du squelette de l'application. Au niveau de la version actuelle de <strong>Pacman</strong> et comme vu pr√©c√©demment, toute la sous-rubrique "<em>Autre</em>" est d√©sactiv√©e car ces options ne concernent pas le framework SpringBoot. La rubrique "<em>R√®gles de gestion</em>" quant √† elle, permet de saisir (si besoin) un pr√©fixe pour le nom de l'ensemble des r√®gles qui vont √™tre mod√©lis√©es (par exemple "<em>REQ_XXXXXXX</em>" ou "<em>REGLE_GES_XXXXX</em>")</p>
<div align="center">
<img alt="Nouveau projet pacman" src="images/pcm-new-project-4.png" width="500"/>
</div>
<p>‚ùó Bien noter que le contr√¥le de la saisie est effectu√© en temps r√©el et que le bouton "<em>Finish</em>" ne sera pas activ√© tant que la saisie utilisateur n'aura pas pass√© l'ensemble des contr√¥les de coh√©rence. Il est donc important de toujours v√©rifier le message informatif en haut du formulaire afin de v√©rifier ce qui manque ou n'est pas conforme au niveau de la saisie.</p>
<p>Une fois la validation du formulaire effectu√©e en cliquant sur le bouton "<em>Finish</em>",  des vues vont √™tre automatiquement activ√©es (si certaines ne le sont pas d√©j√†) au niveau de l'IDE. 
Il s'agit des vues suivantes : </p>
<ul>
<li><strong>Properties</strong> : La vue de saisie des propri√©t√©s par rapports aux mod√©lisations.</li>
<li><strong>Problems</strong> : La vue concernant l'ensemble des probl√®mes sur l'application.</li>
<li><strong>Progress</strong> : La vue affichant la progression des t√¢ches.</li>
<li><strong>ErrorLog</strong> : La vue concernant les erreurs et informations sur les g√©n√©rations.</li>
<li><strong>JUnit</strong> : La vue concernant les tests unitaires.</li>
<li><strong>R√©capitulatif pour le projet</strong> : Si la case "<em>Affichage automatique du fichier lisezmoi</em>" a √©t√© coch√©e au niveau du formulaire de cr√©ation du projet, vue affichant le r√©capitulatif HTML pour la cr√©ation du projet.</li>
</ul>
<p>‚ùó Selon l'√©tat de l'IDE (juste ouvert, d√©veloppeur ayant d√©j√† travaill√© dessus, etc...), il se peut que la cr√©ation initiale du projet prenne un peu de temps, l'IDE ayant besoin de charger de nombreuses ressources pour travailler. Suivre les diff√©rentes √©tapes de la cr√©ation √† l'aide de la vue de progression des t√¢ches qui est automatiquement mise en avant. </p>
<h3 id="fichiers-generes">Fichiers G√©n√©r√©s</h3>
<p>Par la suite dans ce document le projet d'exemple sera appel√© simplement "demo". Il est cr√©√© avec les options suivantes : </p>
<ul>
<li>Base de donn√©es H2 uniquement.</li>
<li>"<em>TBL_</em>" comme pr√©fixe pour l'ensemble des tables dans les scripts SQL.</li>
<li>"<em>SCH</em>" comme sch√©ma pour la datasource.</li>
<li>"<em>REQ_</em>" comme pr√©fixe pour l'ensemble des r√®gles de gestion.</li>
<li>"<em>Xtopsup</em>, <em>Xdmaj</em> et <em>Xuuid</em>" s√©lectionn√©s en tant que champs automatiques.</li>
</ul>
<p>‚ùó Dans tous les fichiers et classes g√©n√©r√©es, il est possible de trouver des balises de type "<em>user code</em>". Ces balises ressemblent √† ceci : </p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Start of user code 56bcd4f8dd30c88089557e348b4165dc</span>

<span class="c1">// End of user code</span>
</code></pre></div>
<p>Ces balises ont √©t√© positionn√©es √† des endroits consid√©r√©s comme strat√©giques par le d√©veloppeur du g√©n√©rateur, elles permettent par la suite de positionner du code personnalis√© par le d√©veloppeur de l'application cible sans que celui-ci soit par la suite, √©cras√© lors des prochaines demandes de g√©n√©ration. </p>
<p>‚ùó Toutes les classes de haut niveau sont g√©n√©r√©es avec le nom de l'application en pr√©fixe, cela permet de mieux les distinguer des autres classes issues de la mod√©lisation utilisateur.</p>
<p>Comme vu pr√©c√©demment, la structure cr√©√©e est donc la suivante : </p>
<p><img alt="Nouveau projet pacman" src="images/pcm-new-project-arbo-1.png" style="display: inline-block; margin-right: 30px; vertical-align: top; width: 120px;"/>
<img alt="Nouveau projet pacman" src="images/pcm-new-project-arbo-2.png" style="display: inline-block; margin-right: 30px; vertical-align: top; width: 200px;"/>
<img alt="Nouveau projet pacman" src="images/pcm-new-project-arbo-3.png" style="display: inline-block; margin-right: 30px; vertical-align: top; width: 205px;"/>
<img alt="Nouveau projet pacman" src="images/pcm-new-project-arbo-4.png" style="display: inline-block; vertical-align: top; width: 215px;"/></p>
<p>‚û§ Le projet "<strong><em>demo</em></strong>" comme pr√©cit√© n'a que pour seul et unique but de servir de projet parent pour l'ensemble des autres projets Maven. Il a donc uniquement un fichier <em>pom.xml</em> auquel se r√©f√®rent tous les autres <em>pom.xml</em> des projets fils. Il s'agit ici d'une structure tout √† fait classique pour un projet multi-modules Maven. Le fichier "pom.xml" ne demande pas d'explications particuli√®res, il se contente juste de g√©rer les versions des diff√©rentes d√©pendances qui sont utilis√©es dans les autres modules. Il servira par ailleurs pour le packaging et le d√©ploiement de l'application.</p>
<p>‚û§ Le projet "<strong><em>demo-domain</em></strong>" qui porte l'ensemble de la couche m√©tier contient par d√©faut toutes les classes de haut niveau pour son bon fonctionnement. </p>
<p>Il s'agit : </p>
<ul>
<li>Des classes d'exception m√©tier au niveau du package <em>[package racine].domain.exceptions</em> Si besoin, placer ici toutes les nouvelles exceptions fonctionnelles dont la couche m√©tier a besoin dans le cadre de l'application.</li>
<li>Des classes pour le fonctionnement des futures r√®gles de gestion au niveau du package <em>[package racine].domain.services.requirements</em></li>
<li>
<p>Des diff√©rentes annotations dont √† besoin la couche m√©tier pour pouvoir converser avec l'infrastructure. En effet, ne pas oublier que la couche m√©tier doit √™tre totalement ind√©pendante de toute technique. Il est donc impossible d'utiliser directement des annotations de type Spring au niveau de ce projet sous peine de cr√©er une d√©pendance avec l'infrastructure. Il est donc n√©cessaire de cr√©er des annotations sp√©cifiques √† l'application g√©n√©r√©e, ces annotations sont par la suite prises en compte par le framework Spring au niveau de la couche d'infrastructure.</p>
<p>Ces annotations sont les suivantes : </p>
<ul>
<li><strong><em>AdapterService</em></strong> : identifie aupr√®s de Spring les classes qui vont servir d'adaptateur (impl√©mentation) pour les diff√©rents services.</li>
<li><strong><em>DomainService</em></strong>:  identifie aupr√®s de Spring les classes qui font partie du domaine (couche m√©tier).</li>
<li><strong><em>Requirement</em></strong> :  identifie les r√®gles de gestion pour les g√©n√©rateurs <strong>Pacman</strong>.</li>
<li><strong><em>StubService</em></strong> :  identifie aupr√®s de Spring les classes qui servent de bouchon pour les tests unitaires.</li>
<li><strong><em>Transactionnal</em></strong> : identifie aupr√®s de Spring les m√©thodes (ou classes) qui doivent √™tre jou√©es en mode transactionnel pour la couche de persistance.</li>
</ul>
</li>
</ul>
<p>Au niveau du fichier "<em>pom.xml</em>" il est encore une fois √† rappeler que la couche m√©tier ne doit contenir aucune d√©pendance avec toute couche technique, ce qui s'applique aux classes g√©n√©r√©es s'applique par cons√©quent aussi au d√©pendances pr√©sentes au niveau de ce fichier. Avec le plugin "<em>maven enforcer</em>", il est possible de d√©finir les d√©pendances authoris√©es et celles qui seront exclues afin d'√©viter qu'un d√©veloppeur ajoute (et utilise) une d√©pendance qui a une adh√©rance √† une quelconque couche technique.  Certes cette solution n'exclue pas que le d√©veloppeur param√®tre diff√©rement le plugin (puisqu'il a lui aussi acc√®s en modification au fichier maven), mais elle prot√®ge toutefois des erreurs d'inadvertance.</p>
<p>Ce plugin est param√©tr√© par d√©faut avec le code suivant : </p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;configuration&gt;</span>
<span class="w">   </span><span class="nt">&lt;rules&gt;</span>
<span class="w">      </span><span class="nt">&lt;bannedDependencies&gt;</span>
<span class="w">          </span><span class="nt">&lt;excludes&gt;</span>
<span class="w">             </span><span class="nt">&lt;exclude&gt;</span>*<span class="nt">&lt;/exclude&gt;</span><span class="w">                              </span>
<span class="w">          </span><span class="nt">&lt;/excludes&gt;</span>
<span class="w">          </span><span class="nt">&lt;includes&gt;</span>
<span class="w">             </span><span class="cm">&lt;!-- Placer ici les librairies authoris√©es. --&gt;</span>
<span class="w">             </span><span class="cm">&lt;!-- Pour l'instant uniquement librairies de test. --&gt;</span>
<span class="w">             </span><span class="nt">&lt;include&gt;</span>*:*:*:*:test<span class="nt">&lt;/include&gt;</span>
<span class="w">             </span><span class="nt">&lt;include&gt;</span>org.junit.jupiter:junit-jupiter<span class="nt">&lt;/include&gt;</span>
<span class="w">             </span><span class="nt">&lt;include&gt;</span>org.assertj:assertj-core<span class="nt">&lt;/include&gt;</span>
<span class="w">             </span><span class="nt">&lt;include&gt;</span>org.slf4j:slf4j-api<span class="nt">&lt;/include&gt;</span>
<span class="w">          </span><span class="nt">&lt;/includes&gt;</span>
<span class="w">      </span><span class="nt">&lt;/bannedDependencies&gt;</span>
<span class="w">  </span><span class="nt">&lt;/rules&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div>
<p>On va donc inclure toutes les librairies de test et de log pour l 'instant (attention sl4j est une surcouche donc elle ne pr√©suppose pas de l'impl√©mentation technique qui est derri√®re), tous le reste est exclu. Pour les librairies de test, pareillement, le fait d'utiliser JUnit ne permet pas de connaitre quel est le framework utilis√© par la suite pour le d√©veloppement de l'application.  On retouve donc uniquement les d√©pendances suivantes : </p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;dependency&gt;</span>
<span class="w">   </span><span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
<span class="w">   </span><span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">   </span><span class="nt">&lt;groupId&gt;</span>org.junit.jupiter<span class="nt">&lt;/groupId&gt;</span>
<span class="w">   </span><span class="nt">&lt;artifactId&gt;</span>junit-jupiter<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">   </span><span class="nt">&lt;groupId&gt;</span>org.assertj<span class="nt">&lt;/groupId&gt;</span>
<span class="w">   </span><span class="nt">&lt;artifactId&gt;</span>assertj-core<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>
<p>‚û§ Le projet "<strong><em>demo-model</em></strong>" qui contient la couche de mod√©lisation avec principalement trois fichiers : </p>
<ul>
<li><strong><em>[nom du projet].entity</em></strong> : le fichier de mod√©lisation pour la couche de persitance.</li>
<li><strong><em>[nom du projet].soa</em></strong> : le fichier de mod√©lisation pour l'ensemble des services.</li>
<li><strong><em>[nom du projet].requirement</em></strong> : le fichier de mod√©lisation pour les r√®gles de gestion.</li>
</ul>
<p>Au niveau du r√©pertoire <strong><em>/pacman-properties</em></strong> deux fichiers de param√®trage sont pr√©sents, il s'agit de la liste des options de configuration pour les g√©n√©rateurs <strong>Pacman</strong>. Le premier fichier <strong><em>nommage.properties</em></strong> permet de g√©rer la norme de nommage pour l'ensemble des classes qui vont √™tre g√©n√©r√©es. Par d√©faut il s'agit d'un nommage de type "SUN". Il est possible de modifier cette convention de nommage en fonction des d√©sid√©ratas du d√©veloppeur. Par exemple pour modifier le nom d'un param√®tre entrant dans une m√©thode, il est possible de faire la modification suivante : </p>
<div class="codehilite"><pre><span></span><code><span class="w">  </span><span class="c1"># Le nom d'un parametre IN classic</span>
<span class="w">  </span><span class="na">parameterMethodClassicIn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[CamelCase.LowerFirst/]</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="w">  </span><span class="c1"># Le nom d'un parametre IN classic</span>
<span class="w">  </span><span class="na">parameterMethodClassicIn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">in_[CamelCase.LowerFirst/]</span>
</code></pre></div>
<p>Le fichier <strong><em>project.properties</em></strong> quant √† lui, contient toutes les autres options structurantes pour les g√©n√©rateurs. Ce fichier a √©t√© initialis√© en partie √† l'aide du formulaire de cr√©ation de projet. Il est par la suite toujours possible de modifier les propri√©t√©s. Une des propri√©t√©s plus particuli√®rement peut √™tre utile si des probl√©matiques de g√©n√©ration sont rencontr√©es et pour v√©rifier si ces probl√©matiques sont li√©es directement aux g√©n√©rateur : </p>
<div class="codehilite"><pre><span></span><code><span class="w">  </span><span class="c1"># Flag indiquant si la generation pour le projet fonctionne en mode debug (non par defaut)</span>
<span class="w">  </span><span class="na">project.debug.enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</code></pre></div>
<p>Le fait de passer la propri√©t√© √† la valeur "<em>true</em>" permet de ne pas lancer les op√©rations de post traitement que sont (entre autres) l'organisation automatique des imports et le formattage du code g√©n√©r√©.</p>
<p>‚ùó Tout changement au niveau de ces fichiers est imm√©diatement pris en compte lors de la prochaine demande de g√©n√©ration.</p>
<p>Un fichier <strong><em>[nom de l'application]-validation.log</em></strong> vide est cr√©√© par d√©faut. Chaque demande de g√©n√©ration passe automatiquement par une pr√©-validation de la mod√©lisation. Toutes les erreurs de mod√©lisation rencontr√©es sont √©crites dans ce fichier consultable √† tout moment (si une erreur de mod√©lisation est rencontr√©e, la g√©n√©ration est stopp√©e avec un message d'avertissement). </p>
<p>‚û§ Le projet "<strong><em>demo-server</em></strong>" qui contient l'ensemble de l'infrastructure (dans le cas de <strong>Pacman</strong>, couche infrastructure divis√©e en "infrastructure" et "application"). Comme pour le domaine, un certain nombre de classes de haut niveau sont g√©n√©r√©es d√®s la cr√©ation du projet. On peut d'entr√©e voir le distinguo entre la couche "infrastructure" et la couche "application" avec les deux packages <strong><em>[package racine].infra</em></strong> et <strong><em>[package racine].app</em></strong> Pour rappel, la couche d'infrastructure contiendra l'ensemble des classes li√©es √† la couche de persistance alors que la couche applicative contiendra l'ensemble des classes pour les services REST.</p>
<p>‚Ä¢ <strong><em>[package racine]</em></strong> : contient la classe principale de d√©marrage pour l'application <strong><em>[nom de l'application]Bootsrap.java</em></strong></p>
<p>‚Ä¢Ô∏è <strong><em>[package racine].app</em></strong> : package racine pour la couche applicative, contient (principalement) par d√©faut les classes de haut niveau pour le bon fonctionnement des services REST. Il s'agit des classes pour la gestion centralis√©e des exceptions et de la configuration de la s√©curit√©.</p>
<p>‚Ä¢ <strong><em>[package racine].app.exceptions</em></strong> : contient les exceptions de la couche applicative. Si besoin d'exceptions suppl√©mentaires, les positionner √† ce niveau.</p>
<p>‚Ä¢ <strong><em>[package racine].app.adapters.controllers</em></strong> : package racine pour l'ensemble des service REST, contient par d√©faut le service pour l'api de sant√© de l'application.</p>
<p>‚Ä¢ <strong><em>[package racine].infra</em></strong> : package racine pour la couche de persistance, contient par d√©faut les classes de haut niveau pour la gestion du transactionnel au niveau de la couche de persistance.</p>
<p>‚Ä¢ <strong><em>/src/main/resources</em></strong> : contient le fichier de configuration SpringBoot pour l'application.</p>
<p>‚Ä¢ <strong><em>/src/test/resources</em></strong> : contient le fichier de configuration SpringBoot pour les tests unitaires de l'application.</p>
<p>‚Ä¢ <strong><em>[package racine] (niveau tests)</em></strong> : contient des classes utilitaires de haut niveau pour la gestion des tests unitaires JUnit.</p>
<p>Par d√©faut, relativement peu de code au niveau du fichier Maven (<em>pom.xml</em>), juste retenir que le projet √† une d√©pendance vers la couche domaine (<strong><em>[nom de l'application]-domain</em></strong>) et que la classe de d√©marrage de l'application est enregistr√©e pour le futur packaging et d√©ploiement de l'application :</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;plugin&gt;</span>
<span class="w">   </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<span class="w">   </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">   </span><span class="nt">&lt;executions&gt;</span>
<span class="w">      </span><span class="nt">&lt;execution&gt;</span>
<span class="w">        </span><span class="nt">&lt;goals&gt;</span>
<span class="w">           </span><span class="nt">&lt;goal&gt;</span>repackage<span class="nt">&lt;/goal&gt;</span>
<span class="w">        </span><span class="nt">&lt;/goals&gt;</span>
<span class="w">      </span><span class="nt">&lt;/execution&gt;</span>
<span class="w">    </span><span class="nt">&lt;/executions&gt;</span>
<span class="w">    </span><span class="nt">&lt;configuration&gt;</span>
<span class="w">        </span><span class="nt">&lt;mainClass&gt;</span>fr.demo.DemoBootstrap<span class="nt">&lt;/mainClass&gt;</span>
<span class="w">    </span><span class="nt">&lt;/configuration&gt;</span>
<span class="w"> </span><span class="nt">&lt;/plugin&gt;</span>
</code></pre></div>
<h2 id="les-fichiers-de-configuration-spring">üìù Les fichiers de configuration Spring</h2>
<hr/>
<h3 id="applicationproperties">application.properties</h3>
<p>Le fichier permet de configurer le framework SpringBoot. Il contient un ensemble de propri√©t√© par d√©faut, il est possible d'en rajouter et √©videmment de les modifier √† loisir. Il a √©t√© divis√© en plusieurs sections qui sont respectivement : </p>
<ul>
<li>Le param√©trage de l'api de sant√©.</li>
<li>Le param√©trage pour la description open api des services REST (Swagger-ui).</li>
<li>Le param√©trage de la s√©curit√© pour la liste des URIs √† ne pas s√©curiser.</li>
<li>Le param√©trage du serveur HTTP.</li>
<li>Le param√©trage de la couche de log.</li>
<li>La param√©trage pour le coffre fort.</li>
<li>Le param√©trage des profils Spring.</li>
<li>Le param√©trage du cache pour Spring.</li>
<li>Le param√©trage du framework pour le circuit-breaker.</li>
<li>Le param√©trage de la (ou les) datasource(s).</li>
</ul>
<p>Il n'est pas pour objectif dans le cadre de ce document, de d√©velopper chaque param√®tre dont certains sont par ailleurs suffisamment explicites mais plut√¥t de pr√©ciser certaines options qui ont √©t√© prises pour le param√©trage par d√©faut qui a √©t√© g√©n√©r√©.</p>
<h4 id="api-de-sante">Api de sant√©</h4>
<p>‚ùó Bien noter que par d√©faut, l'api de sant√© ne permet d'exposer que le "<strong><em>/health</em></strong>" et le "<strong><em>/info</em></strong>", par ailleurs on d√©cide d'exclure explicitement mappings et headdump √† l'aide des param√®tres suivants (bien faire attention √† l'exposition de ses points de terminaison): </p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Activation des points de terminaison pour l'api de sante, par defaut, seuls '/health' et '/info' sont actifs.</span>
<span class="na">management.endpoints.web.exposure.include</span><span class="o">=</span><span class="s">health,info</span>
<span class="c1"># Securite si demande d'activation de l'ensemble des points de terminaison.</span>
<span class="na">management.endpoints.web.exposure.exclude</span><span class="o">=</span><span class="s">mappings,heapdump</span>
</code></pre></div>
<p>Par d√©faut, l'api de sant√© a √©t√© param√©tr√©e pour √™tre consultable sur l'URL suivante : <strong><em>http://localhost:8080/actuator/health/</em></strong> 
Cette URL donne uniquement le r√©sultat suivant qui est le mode "par d√©faut" de l'actuator de SpringBoot : </p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"UP"</span><span class="p">}</span>
</code></pre></div>
<p>Pour une application g√©n√©r√©e par <strong>Pacman</strong>, il a √©t√© rajout√© un point de terminaison personnalis√© pour l 'application (si d√©sir√© par les d√©veloppeurs), il permet de surcharger le "<strong><em>/health</em></strong>" existant et d'ajouter toutes les informations suppl√©mentaires. Ce point de terminaison est activable en jouant sur les valeurs des propri√©t√©s suivantes : </p>
<div class="codehilite"><pre><span></span><code><span class="na">management.endpoint.health.show-details</span><span class="o">=</span><span class="s">always</span>
<span class="na">management.health.demo_health.enabled</span><span class="o">=</span><span class="s">true</span>
</code></pre></div>
<p>Apr√®s red√©marrage du serveur, l'affichage devient alors (sur la m√™me URL) : </p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"UNKNOWN"</span><span class="p">,</span><span class="nt">"components"</span><span class="p">:{</span><span class="nt">"demoHealthImpl"</span><span class="p">:{</span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"UNKNOWN"</span><span class="p">,</span><span class="nt">"details"</span><span class="p">:{</span><span class="nt">"version"</span><span class="p">:</span><span class="s2">"0.0.0"</span><span class="p">,</span><span class="nt">"latency"</span><span class="p">:</span><span class="s2">"0ms"</span><span class="p">}}}}</span>
</code></pre></div>
<p>Cette affichage est rendu par la classe sp√©cifique de l'application <strong><em>[nom de l'application]HealthImpl</em></strong> situ√©e au niveau du package <strong><em>[package racine].app.adapters.controllers</em></strong>. Modifier cette classe pour ajouter les donn√©es n√©cessaires.</p>
<p>Pareillement, pour ajouter des informations au niveau de l'URL "<strong><em>/info</em></strong>" compl√©ter cette fois le fichier de configuration au niveau de la rubrique ((rubrique Configuration du point de terminaison /info et si besoin, se reporter √† la documentation g√©n√©rale de l'actuator pour plus de pr√©cisions) : </p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Configuration du point  de terminaison /info, definir ici les informations necessaires.</span>
<span class="na">management.info.env.enabled</span><span class="o">=</span><span class="s">true</span>
<span class="na">app.cusomInfo</span><span class="o">=</span><span class="s">Une information de type custom...</span>
<span class="na">info.app.cusomInfo</span><span class="o">=</span><span class="s">${app.cusomInfo}</span>
<span class="na">info.app.java-version</span><span class="o">=</span><span class="s">${java.version}</span>
<span class="na">info.app.java-vendor</span><span class="o">=</span><span class="s">${java.vendor}</span>
<span class="na">info.app.excluded-actuator-enpoints</span><span class="o">=</span><span class="s">${management.endpoints.web.exposure.exclude}</span>
</code></pre></div>
<p>‚ùó Il est √† noter que tous les caract√®res accentu√©s ont √©t√© supprim√©s des lignes de commentaires, ceci est volontaire car malgr√© tous les demande de for√ßage en UTF-8, il est toujours possible selon le param√©trage des plateformes que le fichier reste cod√© en ISO-8859-1. Comme il n'a pas √©t√© (pour l'instant) jug√© utile de passer le fichier en <em>yaml</em> (car moins lisible), cette solution est celle qui a sembl√© √™tre la moins co√ªteuse. Libre au d√©veloppeurs de l'application cible de convertir le fichier <strong><em>.properties</em></strong> en fichier <strong><em>.yaml</em></strong> si d√©sir√©.</p>
<h4 id="open-api">Open Api</h4>
<p>OpenAPI est une sp√©cification standardis√©e pour d√©crire, documenter et consommer des API RESTful. Elle permet de d√©finir de mani√®re structur√©e les endpoints, les m√©thodes HTTP, les param√®tres d'entr√©e, les r√©ponses, et les mod√®les de donn√©es associ√©s. OpenAPI facilite l'interop√©rabilit√© entre services, la g√©n√©ration automatique de documentation interactive, ainsi que le d√©veloppement et les tests d'API en offrant un format lisible par machine (g√©n√©ralement en JSON ou YAML).</p>
<p>Il est ici possible (entre autres), de d√©finir l'URI pour l'interface de visualisation et d'interrogation de l'API d√©velopp√©e. Le fichier JSON g√©n√©r√© sera par d√©faut sous "<strong><em>/api-docs</em></strong>".</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Documentation JSON ex: http://localhost:8080/v1/api-docs</span>
<span class="na">springdoc.api-docs.path</span><span class="o">=</span><span class="s">/api-docs</span>
<span class="c1"># Documentation Swagger (ihm) ex: http://localhost:8080/swagger-ui.html</span>
<span class="na">springdoc.swagger-ui.path</span><span class="o">=</span><span class="s">/swagger-ui</span>
<span class="c1"># Definition de l'ordre d'affichage des operations (endpoints) &lt;alpha|method&gt;</span>
<span class="na">springdoc.swagger-ui.operations-sorter</span><span class="o">=</span><span class="s">method</span>
<span class="c1"># Definition de l'ordre d'affichage des tags &lt;alpha|fonction de tri JS personnalisee&gt;</span>
<span class="na">springdoc.swagger-ui.tags-sorter</span><span class="o">=</span><span class="s">alpha</span>
</code></pre></div>
<h4 id="uris">URIs</h4>
<p>‚ùó Il est particuli√®rement important en fonction des diverses modifications apport√©es au niveau des diff√©rentes rubriques, de modifier aussi la liste des URIs qui ne sont pas √† s√©curiser. Par d√©faut la s√©curit√© au niveau de l'acc√®s des services REST est automatiquement enclanch√©e (il n'y a pas de possibilit√© de l'activer ou de la d√©sactiver √† l'aide d'un param√®tre, elle est enclanch√©e d√®s que SpringBoot d√©tecte qu'elle est charg√©e et disponible au niveau des d√©pendance Maven). Cette liste est r√©cup√©r√©e par le gestionnaire de s√©curit√© g√©n√©r√© par <strong>pacman</strong> et permet de sortir ces URIs de la zone de s√©curit√©. Dans le cas contraire on aura un <em>HTTP:401</em> sur les URIs suivantes : </p>
<ul>
<li><strong><em>http://localhost:8080/actuator/health</em></strong></li>
<li><strong><em>http://localhost:8080/actuator/info</em></strong></li>
<li><strong><em>http://localhost/swagger-ui</em></strong></li>
<li><strong><em>http://localhost/api-docs</em></strong></li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="c1"># Ne pas oublier de reporter les modifications issues des rubriques precedentes </span>
<span class="na">security.whitelist.paths</span><span class="o">=</span><span class="s">/swagger-ui/**,/api-docs/**,/actuator/**</span>
</code></pre></div>
<h4 id="serveur-http">Serveur HTTP</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Un exemple de cle symetrique (pour le developpement uniquement).</span>
<span class="na">security.jwt.secret</span><span class="o">=</span><span class="s">HhO7b9aZ0e6eXEkQcL4BFxkGXGcWyN7F</span>
</code></pre></div>
<p>Outre la d√©finition du port et du contexte, une cl√© sym√©trique est automatiquement mide √† disposition pour la classe de gestion de la s√©curit√© des services REST lors du d√©veloppement (√† supprimer en production). </p>
<p>Elle est utilis√©e dans le cadre de la mod√©lisation et de la g√©n√©ration automatique d'une s√©curit√© de type <em>Http</em> ou <em>ApiKey</em>. Gr√¢ce √† la mise √† disposition de cette cl√©, il n'y a rien √† faire (hormis le param√©trage du jeton JWT attendu) pour la mise en place de ce type de s√©curit√©.</p>
<h4 id="logging">Logging</h4>
<p>La configuration pour les fichiers de log :</p>
<div class="codehilite"><pre><span></span><code><span class="na">logging.level.root</span><span class="o">=</span><span class="s">INFO</span>
<span class="na">logging.level.org.springframework.web</span><span class="o">=</span><span class="s">DEBUG</span>
<span class="na">logging.level.com.example</span><span class="o">=</span><span class="s">DEBUG</span>

<span class="c1"># Format du log</span>
<span class="na">logging.pattern.console</span><span class="o">=</span><span class="s">%d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg%n</span>

<span class="c1"># Fichier de log</span>
<span class="na">logging.file.name</span><span class="o">=</span><span class="s">logs/demo.log</span>
<span class="na">logging.file.max-size</span><span class="o">=</span><span class="s">10MB</span>
<span class="na">logging.file.total-size-cap</span><span class="o">=</span><span class="s">100MB</span>
</code></pre></div>
<h4 id="les-profils">Les profils</h4>
<p>Par d√©faut c'est le profil de d√©veloppement qui est activ√© pour Spring :  </p>
<div class="codehilite"><pre><span></span><code><span class="na">spring.profiles.active</span><span class="o">=</span><span class="s">dev</span>
</code></pre></div>
<p>L'utilisation de ce profil permet nottament dans le cadre des tests unitaires pour la couche de persistance, de d√©sactiver l'initialisation des champs automatiques (champs suppl√©mentaires communs √† l'ensemble des tables de la base de donn√©es) afin d'effectuer cette initialisation avec des valeurs sp√©cifiquement fournies par le d√©veloppeur du projet.</p>
<h4 id="cache">Cache</h4>
<p>Cette propri√©t√© agit sur l‚Äôimpl√©mentation du cache utilis√©e par Spring Boot lorsqu‚Äôon utilise l‚Äôannotation @Cacheable, @CachePut, @CacheEvict, etc. Par d√©faut, elle utilise un cache en m√©moire tr√®s basique (ConcurrentHashMap). </p>
<p>Dans la configuration actuelle, bon pour des tests ou des petits projets.</p>
<div class="codehilite"><pre><span></span><code><span class="na">spring.cache.type</span><span class="o">=</span><span class="s">simple</span>
</code></pre></div>
<h4 id="circuit-breaker">Circuit-breaker</h4>
<p>Gr√¢ce au framework Resilience4J, <strong>Pacman</strong> met √† disposition un m√©canisme de protection qui interrompt temporairement les appels vers un service externe lorsqu‚Äôun certain seuil d‚Äô√©checs est atteint. Le param√©trage est donc mis √† disposition dans le fichier "<strong><em>application.properties</em></strong>".</p>
<div class="codehilite"><pre><span></span><code><span class="na">resilience4j.circuitbreaker.instances.externalServiceCircuitBreaker.registerHealthIndicator</span><span class="o">=</span><span class="s">true</span>
<span class="na">resilience4j.circuitbreaker.instances.externalServiceCircuitBreaker.failureRateThreshold</span><span class="o">=</span><span class="s">50</span>
<span class="na">resilience4j.circuitbreaker.instances.externalServiceCircuitBreaker.waitDurationInOpenState</span><span class="o">=</span><span class="s">10000ms</span>
<span class="na">resilience4j.circuitbreaker.instances.externalServiceCircuitBreaker.permittedNumberOfCallsInHalfOpenState</span><span class="o">=</span><span class="s">3</span>
<span class="na">resilience4j.circuitbreaker.instances.externalServiceCircuitBreaker.slidingWindowSize</span><span class="o">=</span><span class="s">10</span>
</code></pre></div>
<h4 id="coffre-fort">Coffre fort</h4>
<p>Un coffre-fort est un syst√®me s√©curis√© permettant de stocker et de prot√©ger des informations sensibles, telles que des mots de passe, des cl√©s d‚ÄôAPI, des certificats ou des secrets d‚Äôapplication. Contrairement √† un simple fichier chiffr√©, un coffre-fort offre g√©n√©ralement des fonctionnalit√©s avanc√©es comme le contr√¥le d‚Äôacc√®s, l‚Äôaudit des acc√®s, le versionnement des secrets et le chiffrement automatique des donn√©es au repos et en transit. Dans le cas de <strong>Pacman</strong> c'est la solution "<em>spring-cloud-vault</em>" qui a √©t√© choisie.</p>
<p>‚ùó Par d√©faut le coffre-fort est d√©sactiv√©.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Activation ou d√©sactivation du coffre fort.</span>
<span class="na">spring.cloud.vault.enabled</span><span class="o">=</span><span class="s">false</span>
<span class="c1"># L'application √©choue au d√©marrage si Vault est inaccessible.</span>
<span class="na">spring.cloud.vault.fail-fast</span><span class="o">=</span><span class="s">false  </span>
<span class="c1"># URL de Vault (par d√©faut : http://localhost:8200).</span>
<span class="na">spring.cloud.vault.uri</span><span class="o">=</span><span class="s">http://localhost:8200</span>
<span class="c1"># M√©thode d'authentification &lt;token|approle|userpass|etc...&gt;</span>
<span class="na">spring.cloud.vault.authentication</span><span class="o">=</span><span class="s">token</span>
<span class="c1"># Le token d'acc√®s Vault (√† ne pas utiliser en dur en production !)</span>
<span class="na">spring.cloud.vault.token</span><span class="o">=</span><span class="s">s.yourVaultToken</span>
<span class="c1"># Backend utilis√© (kv v2 par d√©faut)</span>
<span class="na">spring.cloud.vault.kv.enabled</span><span class="o">=</span><span class="s">true</span>
<span class="c1"># Nom du backend utilis√© dans Vault (par d√©faut souvent secret).</span>
<span class="na">spring.cloud.vault.kv.backend</span><span class="o">=</span><span class="s">secret</span>
<span class="c1"># Nom utilis√© pour acc√©der au chemin dans Vault (ex. secret/data/myapp).</span>
<span class="na">spring.cloud.vault.kv.application-name</span><span class="o">=</span><span class="s">demo</span>
</code></pre></div>
<h4 id="datasources">Datasources</h4>
<p>Par d√©faut la datasource pour la base H2 est toujours param√©tr√©e pour les tests unitaires : </p>
<div class="codehilite"><pre><span></span><code><span class="c1"># H2 DB</span>
<span class="na">spring.datasource.url</span><span class="o">=</span><span class="s">jdbc:h2:file:C:/h2/test;DB_CLOSE_DELAY=-1;INIT=CREATE SCHEMA IF NOT EXISTS SCH;</span>
<span class="na">spring.datasource.username</span><span class="o">=</span><span class="s">sa</span>
<span class="na">spring.datasource.password</span><span class="o">=</span>
<span class="na">spring.jpa.database-platform</span><span class="o">=</span><span class="s">org.hibernate.dialect.H2Dialect</span>
</code></pre></div>
<p>Par ailleurs, on peut voir ici, la pr√©sence de la ligne "<strong><em>INIT=CREATE SCHEMA IF NOT EXISTS SCH;</em></strong>" Ceci est li√© au fait qu'une demande de cr√©ation de sch√©ma a √©t√© effectu√©e lors de la cr√©ation du projet "<em>demo</em>" (pour rappel le sch√©ma "<em>SCH</em>"). En fait, m√™me si la demande de cr√©ation de sch√©ma est effectu√© au niveau des scripts SQL qui sont g√©n√©r√©s √† partir de la mod√©lisation, il reste des probl√©matiques au niveau des tests unitaires et/ou lors de la demande de cr√©ation hors script (voir par la suite). Cette ligne permet donc de s'assurer dans tous les cas que le sch√©ma est bien cr√©√© avant la demande de cr√©ation et d'interrogation des tables.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># En production placer a 'none'. valeurs possibles : &lt;create | create-drop | update | validate | none&gt;</span>
<span class="na">spring.jpa.hibernate.ddl-auto</span><span class="o">=</span><span class="s">create-drop  </span>
</code></pre></div>
<p>Pour le d√©veloppement, il a √©t√© jug√© bon (encore une fois par d√©faut, modifier de suite si n√©cessaire) de laisser la cr√©ation de la base de donn√©es √† la charge de SpringData (sans passer par les scripts SQL g√©n√©r√©s), en lisant l'ensemble des annotations au niveau des entit√©s. A chaque d√©marrage la base est ainsi recr√©√©e et cela permet de v√©rifier rapidement si les relations entre les entit√©s sont bien celles attendues (peut √™tre utile tout au moins le temps de la mod√©lisation). </p>
<p>‚ùó Par contre bien faire attention √† la valeur de cette donn√©e et bien se souvenir, si l'option est laiss√©e √† "<em>create-drop</em>" lors du d√©veloppement que d'une part, la base est supprim√©e √† chaque d√©marrage du serveur et que d'autre part le script sql de cr√©ation n'est pas utilis√©.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Fortement conseille de placer a 'false' (LazyInitializationException).</span>
<span class="na">spring.jpa.open-in-view</span><span class="o">=</span><span class="s">false</span>
</code></pre></div>
<p>La propri√©t√© essentielle pour la couche de persistance ! <strong>Pacman</strong> est un ensemble de g√©n√©rateurs destin√©s √† la cr√©ation de services REST. La notion de "<em>LAZYLOADING</em>" devrait donc √™tre totalement absente dans les applications qui sont g√©n√©r√©es (hormis cas particuliers par la suite). Par ailleurs, le chargement par d√©faut pour les relations est toujours effectu√© en "<em>EAGER</em>" (sauf demande expresse au niveau de la mod√©lisation). Il est donc totalement inutile et (√† notre sens) deconseill√© de positionner ce param√®tre avec la valeur "<em>true</em>", ce qui laisserait ouverte la session JPA jusqu'a la couche applicative. La session devrait √† priori √™tre toujours ferm√©e d√®s la requ√™te initiale a √©t√© effectu√©e.</p>
<h3 id="testsproperties">tests.properties</h3>
<p>Ce fichier permet de configurer le framework SpringBoot pour le d√©roulement des tests d'int√©gration pour l'ensemble de la couche  d'infrastructure. A ce niveau, il s'agit juste de configurer une datasource, le param√©trage n'implique √† priori pas de commentaire particulier hormis le fait que le param√®tre "<strong><em>spring.jpa.defer-datasource-initialization</em></strong>" est comment√© puisque la demande de cr√©ation de la base de donn√©es n'est plus g√©r√©e par le cycle de vie de Spring mais est expressement demand√©e par programmation. Le param√®tre est toutefois conserv√© pour m√©moire.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">## Base H2 embarquee par defaut.</span>
<span class="na">spring.datasource.url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">jdbc:h2:mem:testdemo;DB_CLOSE_DELAY=-1</span>
<span class="na">spring.jpa.properties.hibernate.dialect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">org.hibernate.dialect.H2Dialect</span>

<span class="c1"># Attendre la creation des tables avant d'executer les scripts d'initialisation sql.</span>
<span class="c1"># spring.jpa.defer-datasource-initialization=true</span>

<span class="c1"># Autres proprietes</span>
<span class="na">spring.jpa.hibernate.ddl-auto</span><span class="o">=</span><span class="s">none </span>
<span class="na">spring.jpa.hibernate.naming.implicit-strategy</span><span class="o">=</span><span class="s">org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyJpaImpl</span>
<span class="na">spring.jpa.hibernate.naming.physical-strategy</span><span class="o">=</span><span class="s">org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl</span>
<span class="na">spring.jpa.hibernate.naming-strategy</span><span class="o">=</span><span class="s">org.hibernate.cfg.ImprovedNamingStrategy</span>
<span class="na">spring.jpa.properties.hibernate.format_sql</span><span class="o">=</span><span class="s">true</span>
<span class="na">spring.sql.init.mode</span><span class="o">=</span><span class="s">always</span>

<span class="c1"># Debug des requetes sql pour le developpement.</span>
<span class="na">logging.level.org.hibernate.SQL</span><span class="o">=</span><span class="s">DEBUG</span>
<span class="na">logging.level.org.hibernate.type.descriptor.sql.BasicBinder</span><span class="o">=</span><span class="s">TRACE</span>
<span class="na">logging.level.org.hibernate.orm.jdbc.bind</span><span class="o">=</span><span class="s">TRACE</span>
</code></pre></div>
<h2 id="generation-de-la-couche-de-persistance">üõ¢Ô∏è G√©n√©ration de la couche de persistance</h2>
<hr/>
<p>Dans un premier temps l'objectif ici (et dans le cadre des deux prochains chapitres de premier niveau) n'est pas d'entrer dans toutes les subtilit√©s de la mod√©lisation et/ou de la g√©n√©ration associ√©e mais de comprendre avec une premi√®re mod√©lisation tr√®s simple, l'ensemble du fonctionnement et de voir les diff√©rentes classes g√©n√©r√©es par <strong>Pacman</strong> dans le cadre de l'architecture hexagonale. </p>
<p>A ce niveau il n'aura donc qu'une seule entit√© afin d'√©viter de polluer la compr√©hension g√©n√©rale par une mod√©lisation plus complexe. </p>
<h3 id="modelisation">Mod√©lisation</h3>
<p>Comme pr√©cit√© la mod√©lisation sera √† ce niveau tr√®s simple, gestion d'une personne avec un nom, un pr√©nom et un √¢ge.... La mod√©lisation ressemble donc √† ceci (dans un namespace appel√© arbitrairement "referentiel")  : </p>
<p><img alt="Mod√©lisation entit√©" src="images/pcm-model-entity-1.png" width="150"/></p>
<p>Le param√©trage pour l'attribut nom : </p>
<div align="center">
<img alt="Mod√©lisation entit√©" src="images/pcm-model-entity-2.png"/>
</div>
<p>Le param√©trage pour l'attribut pr√©nom : </p>
<div align="center">
<img alt="Mod√©lisation entit√©" src="images/pcm-model-entity-3.png"/>
</div>
<p>Le param√©trage pour l'attribut √¢ge : </p>
<div align="center">
<img alt="Mod√©lisation entit√©" src="images/pcm-model-entity-4.png"/>
</div>
<h3 id="generation">G√©n√©ration</h3>
<p>Dans l'explorateur de mod√®les, aller au niveau du projet de mod√©lisation <strong><em>[nom de l'application]-model</em></strong>, se positionner sur le fichier de mod√©lisation des entit√©s <strong><em>[nom de l'application].entity</em></strong> et par un clique droit, faire apparaitre le menu de g√©n√©ration <strong>Pacman</strong>. Sont pr√©sent√©s (√† l'inverse des versions pr√©cedentes) uniquement les g√©n√©rateurs associ√©s au type du fichier sur lequel le d√©veloppeur s'est positionn√©. </p>
<div align="center">
<img alt="G√©n√©ration entit√©" src="images/pcm-gen-entity-1.png" width="600"/>
</div>
<p>On peut remarquer la pr√©sence d'un g√©n√©rateur "<strong><em>Validation du diagramme de mod√©lisation</em></strong>". Quelle que soit la couche √† g√©n√©rer, il est toujours possible de lancer directement le g√©n√©rateur d√©sir√© et celui-ci va automatiquement activer la validation du diagramme avant de se lancer. Si des erreurs sont detect√©es, il est alors possible d'aller voir le r√©sultat de la validation au niveau du projet de mod√©lisation, en ouvrant le fichier "<strong><em>[nom de l'application]-validation.log</em></strong>". Par ailleurs il est aussi possible de lancer sp√©cifiquement la validation du mod√®le afin de v√©rifier par avance si tout est correct. Si la validation est lanc√©e en "standalone", et que le diagramme est valide, alors un message sp√©cifique est affich√© au d√©veloppeur : </p>
<div align="center">
<img alt="G√©n√©ration entit√©" src="images/pcm-gen-entity-2.png" width="400"/>
</div>
<p>Lancer successivement la g√©n√©ration des scripts SQL et de la couche de persistance...</p>
<p>Aucune classe n'a √©t√© g√©n√©r√©e au niveau de la couche m√©tier ce qui est normal puisque l'entit√© appartient √† la couche de persistance, la persistance √©tant g√©r√©e par l'infrastructure. Se reporter au niveau du projet serveur <strong><em>[nom de l'application]-server</em></strong>, les scripts de cr√©ation, de suppression et d'initialisation de la base de donn√©es sont disponibles soit : </p>
<ul>
<li>
<p>au niveau du r√©pertoire <strong><em>/src/main/resources/sql</em></strong> pour les scripts de cr√©ation et de suppression de la base de donn√©es (d√©veloppement et production).</p>
</li>
<li>
<p>create_tables_demo_h2.sql</p>
</li>
<li>
<p>drop_tables_demo_h2.sql</p>
</li>
<li>
<p>au niveau du r√©pertoire <strong><em>/scr/test/resources</em></strong> pour les les scripts de cr√©ation et d'initialisation de la base de donn√©es (tests unitaires).</p>
</li>
<li>
<p>create_tables_demo_h2.sql</p>
</li>
<li>init_tables_demo_h2.sql</li>
</ul>
<p>Plusieurs remarques √† ce stade : </p>
<p>‚Ä¢ Tous les scripts sont toujours sous la forme "<strong><em>[create/drop/init]_tables_[nom de l'application]_[type de base]</em></strong>"</p>
<p>‚Ä¢ Il existe autant de scripts que de bases de donn√©es d√©clar√©es au niveau du r√©pertoire <strong><em>/src/main/resources/sql</em></strong> (pour les tests, seule la base H2 est utilis√©e)</p>
<p>‚Ä¢ Le script de cr√©ation H2 est aussi pr√©sent au niveau du r√©pertoire  <strong><em>/scr/test/resources</em></strong> car tr√®s l√©g√®rement diff√©rent de celui utilis√© pour la production (d√©claration des contraintes pour les tests unitaires qui passent au niveau de l'initialisation des donn√©es).</p>
<p>‚Ä¢ On peux voir dans les scripts la pr√©sence des champs suppl√©mentaires qui ont √©t√© demand√©s dans le cadre du projet "demo".</p>
<div class="codehilite"><pre><span></span><code><span class="cm">/******************************************************************/</span>
<span class="cm">/* Base de donnees:      h2                                       */</span>
<span class="cm">/* Application:          demo                                     */</span>
<span class="cm">/* Date de creation:     07/05/2025 15:50:30                      */</span><span class="w"> </span><span class="cm">/******************************************************************/</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* Schema: SCH                                                    */</span><span class="w"> </span><span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">schema</span><span class="w"> </span><span class="n">SCH</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* Sequences                                                      */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">SCH</span><span class="p">.</span><span class="n">TBL_PERSONNE_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : SCH.TBL_PERSONNE                                       */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">SCH</span><span class="p">.</span><span class="n">TBL_PERSONNE</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table SCH.TBL_PERSONNE */</span>
<span class="w">  </span><span class="n">TBL_PERSONNE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">NOM</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">PRENOM</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">AGE</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="w">  </span><span class="n">XTOPSUP</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">'false'</span><span class="p">,</span>
<span class="w">  </span><span class="n">XDMAJ</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">XUUID</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">TBL_PERSONNE_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">TBL_PERSONNE_ID</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">SCH</span><span class="p">.</span><span class="n">TBL_PERSONNE</span><span class="p">.</span><span class="n">TBL_PERSONNE_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table SCH.TBL_PERSONNE'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">SCH</span><span class="p">.</span><span class="n">TBL_PERSONNE</span><span class="p">.</span><span class="n">NOM</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Le nom de la personne. Cette donn√©e est obligatoire'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">SCH</span><span class="p">.</span><span class="n">TBL_PERSONNE</span><span class="p">.</span><span class="n">PRENOM</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Le pr√©nom pour la personne. Cette donn√©e est obligatoire'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">SCH</span><span class="p">.</span><span class="n">TBL_PERSONNE</span><span class="p">.</span><span class="n">AGE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'L''age pour la personne, cette donn√©e est optionnelle'</span><span class="p">;</span>
</code></pre></div>
<p>‚Ä¢ Au niveau du script d'initialisation pour les tests il est √† noter que l'identifiant est initialis√© √† 1000 et non √† 1 comme pour la s√©quence au niveau du script de cr√©ation. Comme le d√©veloppeur peut ajouter autant d'insertions que d√©sir√©es dans le script, cela √©vite d'avoir des collisions de cl√©s primaires lors de l'ex√©cution des tests, entre les tuples qui sont enregistr√©s par le script d'initialisation et les tuples enregistr√©s programmatiquement dans le cadre des tests par les classes automatiquement g√©n√©r√©es par Pacman. </p>
<div class="codehilite"><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">SCH</span><span class="p">.</span><span class="n">TBL_PERSONNE</span><span class="w"> </span><span class="p">(</span><span class="n">TBL_PERSONNE_ID</span><span class="p">,</span><span class="n">NOM</span><span class="p">,</span><span class="n">PRENOM</span><span class="p">,</span><span class="n">AGE</span><span class="p">,</span><span class="n">XTOPSUP</span><span class="p">,</span><span class="n">XDMAJ</span><span class="p">,</span><span class="n">XUUID</span><span class="p">)</span><span class="w"> </span><span class="k">values</span>
<span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="s1">'S'</span><span class="p">,</span><span class="s1">'S'</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">false</span><span class="p">,</span><span class="k">current_timestamp</span><span class="p">,</span><span class="s1">'a81bc81b-dead-4e5d-abff-90865d1e13b1'</span><span class="p">);</span>
</code></pre></div>
<p>Au niveau des classes g√©n√©r√©es : </p>
<p>‚û§ <strong><em>[package racine].infra</em></strong> : pr√©sence d'une nouvelle classe <strong><em>[Nom de l'application]EntityAbs</em></strong>, cette classe est reg√©n√©r√©e √† chaque fois (possibilit√© de changement des donn√©es au niveau du fichier de configuration de <strong>Pacman</strong>). Elle contient et g√®re le cycle de vie des diff√©rents champs suppl√©mentaires qui sont communs √† l'ensemble des tables. Dans le cadre du projet "demo" comme il a √©t√© demand√© de rajouter les champs "Xtopsup, Xdmaj et Xuuid" on les retrouve donc √† ce niveau : </p>
<div class="codehilite"><pre><span></span><code><span class="cm">/** Indicateur de suppression logique. */</span>
<span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"xtopsup"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="kd">protected</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="n">xtopsup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="cm">/** Date de mise √† jour de la ligne. */</span>
<span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"xdmaj"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="kd">protected</span><span class="w"> </span><span class="n">Instant</span><span class="w"> </span><span class="n">xdmaj</span><span class="p">;</span>

<span class="cm">/** Identifiant unique universel. */</span>
<span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"xuuid"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">unique</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">updatable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="kd">protected</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">xuuid</span><span class="p">;</span>
</code></pre></div>
<p>‚ùó Il est √† noter que cette classe est toujours g√©n√©r√©e, m√™me en l'absence de champ suppl√©mentaire.</p>
<p>‚û§ <strong><em>[package racine].infra.entities.[nom du namespace]</em></strong> : impl√©mentation de la ou des entit√©s, dans le cas du projet "demo", il s'agit de l'entit√© "<em>PersonneEntityImpl</em>". Ici le g√©n√©rateur se contente de rajouter l'ensemble des annotations de persistance, encore une fois comme un indicateur de suppression logique a √©t√© demand√© (<em>Xtopsup</em>) il est g√©r√© automatiquement par Spring Data. </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_PERSONNE"</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"SCH"</span><span class="p">)</span>
<span class="nd">@SequenceGenerator</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"PERSONNE_SEQUENCE"</span><span class="p">,</span><span class="w"> </span><span class="n">sequenceName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"SCH.TBL_PERSONNE_SEQ"</span><span class="p">,</span><span class="w"> </span><span class="n">allocationSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="nd">@SQLDelete</span><span class="p">(</span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"UPDATE SCH.TBL_PERSONNE SET xtopsup = true WHERE TBL_PERSONNE_ID = ?"</span><span class="p">)</span>
<span class="nd">@SQLRestriction</span><span class="p">(</span><span class="s">"xtopsup = false"</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PersonneEntityImpl</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">DemoEntityAbs</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<p>L'identifiant de l'entit√© est automatiquement cr√©√© et est associ√© √† la s√©quence par le g√©n√©rateur (s√©quence aussi cr√©√©e et initialis√©e dans le script SQL) : </p>
<div class="codehilite"><pre><span></span><code><span class="cm">/** Id. */</span>
<span class="nd">@Id</span>
<span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GenerationType</span><span class="p">.</span><span class="na">SEQUENCE</span><span class="p">,</span><span class="w"> </span><span class="n">generator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"PERSONNE_SEQUENCE"</span><span class="p">)</span>
<span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_PERSONNE_ID"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">personne_id</span><span class="p">;</span>
</code></pre></div>
<p>Chaque attribut est annot√© pour que Spring Data puisse faire la liaison avec la couche de persistance (il est aussi possible de modifier par mod√©lisation le nom de la colonne afin qu'il soit diff√©rent de celui de l'attribut au niveau de la classe java (voir plus loin)): </p>
<div class="codehilite"><pre><span></span><code><span class="cm">/** Le nom de la personne. Cette donn√©e est obligatoire. */</span>
<span class="c1">// Start of user code aee37c30f5d091a495526f636a3527bb</span>
<span class="c1">// End of user code</span>
<span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"NOM"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">;</span>

<span class="cm">/** Le pr√©nom pour la personne. Cette donn√©e est obligatoire. */</span>
<span class="c1">// Start of user code 209f4226d4ca0e91af3607674c06a9bc</span>
<span class="c1">// End of user code</span>
<span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"PRENOM"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">prenom</span><span class="p">;</span>

<span class="cm">/** L'age pour la personne, cette donn√©e est optionnelle. */</span>
<span class="c1">// Start of user code 7d637d275668ed6d41a9b97e6ad3a556</span>
<span class="c1">// End of user code</span>
<span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"AGE"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
</code></pre></div>
<p>Chaque entit√© poss√®de toujours deux constructeurs, un sans param√®tre et un second avec l'ensemble des param√®tres ce qui peut √™tre utile avec certains lambdas d'initialisation si on d√©sire peupler la base de donn√©es non pas par script mais programmatiquement.</p>
<p>‚û§ <strong><em>[package racine].infra.entities.repositories.[nom du namespace]</em></strong> : cr√©ation du repository d√©di√© √† l'entit√©, sous la forme <strong><em>[nom de l'entit√©]Repository</em></strong>. Il s'agit d'une interface vide (CRUD par d√©faut) pour les op√©rations basiques de r√©cup√©ration, sauvegarde, etc.... Lors de la g√©n√©ration, <strong>Pacman</strong> privil√©gie toujours l'utilisation d'un repository par rapport √† celle de l'entity manager, car plus simple et plus lisible. Il reste juste au d√©veloppeur de positionner ses requ√™tes JPQL au niveau de cette interface. Il est toutefois toujours possible pour le d√©veloppeur de demander express√©ment l'utilisation de l'entity manager si besoin (voir plus loin).</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">PersonneRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">PersonneEntityImpl</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="c1">// Start of user code f0e770b82a09fdf18b21d0a4b108eef5</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="p">}</span>
</code></pre></div>
<p>Exemple de requete JPQL : </p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">PersonneRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">PersonneEntityImpl</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nd">@Query</span><span class="p">(</span><span class="s">"SELECT u FROM SCH.TBL_PERSONNE u WHERE u.active = true AND u.email LIKE %:emailPart%"</span><span class="p">)</span>
<span class="w">  </span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findActiveUsersByEmailContaining</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">"emailPart"</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">emailPart</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="tests">Tests</h3>
<p>‚û§ <strong><em>[package racine].infra.adapters.[nom du namespace]</em></strong> : Des tests unitaires JUnit sont g√©n√©r√©s par d√©faut au niveau du package de test, avec pour chaque entit√©, une classe <strong><em>[nom de l'entit√©]RepositoryTestImpl</em></strong>, dans le cadre de l'application "demo", il s"agit de la classe <em>PersonneRepositoryTestImpl</em>. Ces tests de base auto g√©n√©r√©s permettent de v√©rifier le bon fonctionnement des op√©rations CRUD pour la base de  donn√©es. </p>
<p>Chaque classe de test r√©cup√®re le "Repository" par le biais d'une injection par constucteur, on active le profil Spring pour les tests et on demande expressement la configuration issue de "<strong><em>test.properties</em></strong>" au lieu de celle de production "<strong><em>application.properties</em></strong>". Enfin on demande l'initialisation de la base de donn√©e avec la ligne "<strong><em>initSql(dataSource);</em></strong>" :</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@SpringBootTest</span>
<span class="nd">@ActiveProfiles</span><span class="p">(</span><span class="s">"test"</span><span class="p">)</span>
<span class="nd">@ExtendWith</span><span class="p">(</span><span class="n">SpringExtension</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@TestInstance</span><span class="p">(</span><span class="n">Lifecycle</span><span class="p">.</span><span class="na">PER_CLASS</span><span class="p">)</span>
<span class="nd">@TestPropertySource</span><span class="p">(</span><span class="n">locations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"classpath:tests.properties"</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PersonneRepositoryTestImpl</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">DemoTestAbs</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="cm">/** Couche de persistance. */</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">PersonneRepository</span><span class="w"> </span><span class="n">personneRepository</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Constructeur avec injection de la couche de persistance.</span>
<span class="cm">   * </span>
<span class="cm">   * @param personneRepository Le repository pour l'entit√©.</span>
<span class="cm">   * @param dataSource         La source de donn√©es √† utiliser pour les tests.</span>
<span class="cm">   * @param entityManager      L'EntityManager utilis√© pour manipuler la base de</span>
<span class="cm">   *                           donn√©es.</span>
<span class="cm">   */</span>
<span class="w">   </span><span class="nd">@Autowired</span>
<span class="w">   </span><span class="n">PersonneRepositoryTestImpl</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">PersonneRepository</span><span class="w"> </span><span class="n">personneRepository</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">DataSource</span><span class="w">   </span>
<span class="w">      </span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">EntityManager</span><span class="w"> </span><span class="n">entityManager</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="na">personneRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">personneRepository</span><span class="p">;</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="na">entityManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entityManager</span><span class="p">;</span>
<span class="w">      </span><span class="n">initSql</span><span class="p">(</span><span class="n">dataSource</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">  </span><span class="n">etc</span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<p>‚ùó La demande expresse d'initialisation a √©t√© g√©n√©r√©e suite au constat d'effets de bord si on laissait Spring initialiser la base avec son propre cycle de vie.</p>
<p>Voici un exemple de test unitaire pour la persistance : </p>
<div class="codehilite"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * V√©rifie que l'entit√© personne est correctement r√©cup√©r√©e par son identifiant.</span>
<span class="cm"> * </span>
<span class="cm"> * @throws Exception Si une exception se produit pendant l'ex√©cution du test.</span>
<span class="cm"> */</span>
<span class="w"> </span><span class="nd">@Test</span>
<span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testFindById</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>

<span class="w">   </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">PersonneEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">personne</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">personneRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">crudId</span><span class="p">);</span>
<span class="w">   </span><span class="n">assertTrue</span><span class="p">(</span><span class="o">!</span><span class="n">personne</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(),</span><span class="w"> </span><span class="s">"Aucune entit√© n'a ete recup√©r√©e"</span><span class="p">);</span>
<span class="w">   </span><span class="n">assertTrue</span><span class="p">(</span><span class="n">personne</span><span class="p">.</span><span class="na">get</span><span class="p">().</span><span class="na">getPersonne_id</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">crudId</span><span class="p">,</span><span class="w"> </span><span class="s">"L'entit√© recup√©r√©e n'est pas la bonne entit√©"</span><span class="p">);</span>

<span class="w">   </span><span class="c1">// Start of user code 6ace50c02167250b08e7a5ea0d5e8720</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="p">}</span>
</code></pre></div>
<p>‚ùó Avant de lancer les tests, ne pas oublier de demander (si cela n'a pas d√©j√† √©t√© effectu√© au pr√©alable) la g√©n√©ration des scripts SQL. Pour ce faire, se positionner au niveau du fichier de mod√©lisation de la couche de persistance <strong><em>[nom de l'application].entity</em></strong> et par clique droit, demander la g√©n√©ration : </p>
<p><img alt="G√©n√©ration scripts SQL" src="images/pcm-gen-entity-3.png" width="600"/></p>
<p>Un clique droit "<strong><em>Run As/Junit Test</em></strong>" sur la classe doit renvoyer le r√©sultat suivant : </p>
<div align="center">
<img alt="Tests unitaires" src="images/pcm-test-entity-1.png" width="300"/>
</div>
<h2 id="generation-des-regles-de-gestion">üìè G√©n√©ration des r√®gles de gestion</h2>
<hr/>
<p>Il est possible de mod√©liser un ensemble de r√®gles de gestion afin de g√©n√©rer des m√©thodes dont le corps doit par la suite √™tre impl√©ment√© par les d√©veloppeurs. Ces r√®gles peuvent √™tre fonctionnelles ou techniques, elles peuvent √™tre hi√©rarchis√©es en cat√©gories et sous-cat√©gories, elles sont versionn√©es, etc... </p>
<p>Les r√®gles de gestion sont toutes centralis√©es au niveau du domaine (couche m√©tier) puisqu'il s'agit par excellence d'une partie du code m√©tier. Ces r√®gles seront par la suite appel√©es au niveau de l'impl√©mentation du service m√©tier qui a √©t√© mod√©lis√© dans le diagrame SOA.</p>
<p>‚ùó Ne pas confondre r√®gles de gestion et r√®gles de calcul m√©tier, ici les r√®gles devraient √™tres consid√©r√©es comme des r√®gles ou le seul retour possible est un bool√©en, ou ce que l'on teste est valide ou n'est pas valide.</p>
<p>Dans le cadre de l'application "demo", avec les informations dont on dispose, une r√®gle tr√®s simple va √™tre mod√©lis√©e, v√©rifier que la personne est majeure. </p>
<h3 id="modelisation_1">Mod√©lisation</h3>
<p>Se positionner au niveau de fichier de mod√©lisation des "Requirements" : <strong><em>[nom de l'application].requirements</em></strong> et ajouter la r√®gle (encore une fois, dans le cadre de ce document l'objectif n'est pas de montrer en d√©tail l'utilisation du modeleur) : </p>
<p><img alt="R√®gle de gestion" src="images/pcm-model-req-1.png"/></p>
<p>Puis se reporter au niveau du diagramme SOA pour attacher la r√®gle de gestion au niveau de l'op√©ration, gr√¢ce √† la vue "<strong><em>Linked Requirements</em></strong>".</p>
<div align="center">
<img alt="R√®gle de gestion" src="images/pcm-model-req-2.png" width="500"/>
</div>
<p>Une fois que la r√®gle de gestion a √©t√© attach√©e √† une op√©ration, une cl√© jaune apparait alors au niveau de cette derni√®re afin de confirmer que l'op√©ration √† bien une ou plusieurs r√®gles de gestion qui lui sont raccord√©es : </p>
<p><img alt="R√®gle de gestion" src="images/pcm-model-req-3.png"/></p>
<h3 id="generation_1">G√©n√©ration</h3>
<p>Pour lancer la g√©n√©ration des r√®gles de gestions, utiliser en premier le g√©n√©rateur disponible au niveau du fichier de mod√©lisation pour les "Requirements", en l'occurence le fichier <strong><em>[nom de l'application].requirements</em></strong> </p>
<div align="center">
<img alt="R√®gle de gestion" src="images/pcm-model-req-4.png"/>
</div>
<p>Pour l'instant, seule l'√©num√©ration contenant l'ensemble des r√®gles de gestion est mise √† jour au niveau du projet contenant les informations du domaine (<strong><em>[nom de l'application]-domain</em></strong>. Pour rappel cette √©num√©ration est situ√©e au niveau du package <strong><em>[package racine].services.requirements</em></strong></p>
<div class="codehilite"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * La personne doit √™tre majeure </span>
<span class="cm"> * RequirementVersionTest#testVersion_REQ_PERSONNE_AGE()</span>
<span class="cm"> */</span>
<span class="n">REQ_PERSONNE_AGE</span><span class="p">(</span><span class="s">"La personne doit etre majeure"</span><span class="p">,</span><span class="w"> </span><span class="s">"1"</span><span class="p">);</span>
</code></pre></div>
<p>Pour pouvoir utiliser cette nouvelle r√®gle de gestion, il est maintenant n√©cessaire de passer √† la g√©n√©ration de la couche de service avec le chapitre suivant.</p>
<h2 id="generation-de-la-couche-de-service">üåê G√©n√©ration de la couche de service</h2>
<hr/>
<p>C'est ici qu'est effectu√©e la plus grosse partie du travail de g√©n√©ration et que l'ensemble de la mod√©lisation va permettre d'articuler le code autour de l'architecture hexagonale.</p>
<h3 id="modelisation_2">Mod√©lisation</h3>
<p>La mod√©lisation des objets m√©tier (DTO) est effectu√©e au niveau du fichier de mod√©lisation (<strong><em>[nom de l'application].soa</em></strong>). Le plus simple (m√©thode conseill√©e lors de la premi√®re mod√©lisation) est de s√©lectionner au niveau de la palette d'outils "<strong><em>Namespace from Entity Namespace</em></strong>" et de cocher l'ensemble des composants. </p>
<p>Dans le cas de l'application "demo", le diagramme (encore une fois tr√®s simple) ressemble √† ceci :</p>
<p><img alt="Tests unitaires" src="images/pcm-model-dto-1.png" width="200"/></p>
<p>Pareillement, deux op√©rations de type CRUD sont mod√©lis√©es, une pour retourner une personne en fonction de l'identifiant et une pour retourner l'ensemble des personnes pr√©sentes dans la base de donn√©es. Encore une fois il s'agit pour l'instant, de se focaliser sur la mani√®re dont <strong>Pacman</strong> g√©n√®re les diff√©rentes classes et les articule en fonction de l'architecture hexagonale, plut√¥t que de faire de suite un exemple plus complexe. Il n'est pas non plus dans l'objectif de ce chap√Ætre de d√©tailler toutes les possibilit√©s de mod√©lisation.</p>
<p><img alt="Tests unitaires" src="images/pcm-model-soa-1.png" width="200"/></p>
<p>Dans cet exemple : </p>
<ul>
<li>La version de l'application est laiss√© √† la version par d√©faut soit 0.0.1</li>
<li>L'uri racine est positionn√©e sur "<em>/api</em>".</li>
<li>L'uri pour le service est "<em>/personnes</em>".</li>
<li>L'uri pour la recherche par identifiant est "<em>/{id}</em>"</li>
<li>Le service n'est pas s√©curis√© (acc√®s libre).</li>
<li>Dans le cas ou la personne n'est pas trouv√©e, une "fault" a √©t√© mod√©lis√©e avec comme code de retour 404 (il est aussi possible de mod√©liser un 204).</li>
</ul>
<h3 id="generation_2">G√©n√©ration</h3>
<p>Dans l'explorateur de mod√®les, aller au niveau du projet de mod√©lisation <strong><em>[nom de l'application]-model</em></strong>, se positionner sur le fichier de mod√©lisation des entit√©s <strong><em>[nom de l'application].soa</em></strong> et par un clique droit, faire apparaitre le menu de g√©n√©ration <strong>Pacman</strong> (G√©n√©rateurs Cali). </p>
<div align="center">
<img alt="G√©n√©ration soa" src="images/pcm-gen-soa-1.png" width="600"/>
</div>
<p><strong>Au niveau du projet du domaine (couche m√©tier)</strong> : </p>
<p>‚Ä¢ <strong><em>[package racine].domain.entities</em></strong> : Comme pour la couche de persistance, une classe parent est automatiquement g√©n√©r√©e pour les objets m√©tiers. A l'inverse de la classe g√©n√©r√©e pour les entit√©s, celle-ci ne contient aucune annotation et m√©thode pour g√©rer le cycle de vie des champs automatiques. Elle sert juste de conteneur pour mettre √† disposition les diff√©rents attributs au niveau du DTO.</p>
<p>‚Ä¢ <strong><em>[package racine].domain.entities.[nom du namespace]</em></strong> : Contient les impl√©mentations des objets m√©tier (le DTO) avec pour chaque objet une classe de type <strong><em>[nom du dto]DToImpl</em></strong> (ici <em>PersonneDtoImpl</em>). En plus des attributs et de leurs assesseurs, chaque objet m√©tier g√©n√©r√© contient automatiquement : </p>
<ul>
<li>Une m√©thode de validation pour les champs obligatoires ainsi que pour les champs qui ont des r√®gles sp√©cifiques issues de la mod√©lisation (taille, pattern). </li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="n">PersonneDtoImpl</span><span class="w"> </span><span class="nf">validate</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DemoValidationException</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="n">ValidatorUtils</span><span class="p">.</span><span class="na">checkMandatory</span><span class="p">(</span><span class="s">"nom"</span><span class="p">,</span><span class="w"> </span><span class="n">nom</span><span class="p">,</span><span class="w"> </span><span class="n">errors</span><span class="p">);</span>
<span class="w">    </span><span class="n">ValidatorUtils</span><span class="p">.</span><span class="na">checkSize</span><span class="p">(</span><span class="s">"nom"</span><span class="p">,</span><span class="w"> </span><span class="n">nom</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="n">errors</span><span class="p">);</span>
<span class="w">    </span><span class="n">ValidatorUtils</span><span class="p">.</span><span class="na">checkMandatory</span><span class="p">(</span><span class="s">"prenom"</span><span class="p">,</span><span class="w"> </span><span class="n">prenom</span><span class="p">,</span><span class="w"> </span><span class="n">errors</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">errors</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DemoValidationException</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">errors</span><span class="p">.</span><span class="na">toArray</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[</span><span class="n">errors</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="o">]</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Une red√©finition de la m√©thode "<em>equals()</em>" </li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">equals</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">PersonneDtoImpl</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">PersonneDtoImpl</span><span class="w"> </span><span class="n">personne</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PersonneDtoImpl</span><span class="p">)</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">personne_id</span><span class="p">,</span><span class="w"> </span><span class="n">personne_id</span><span class="p">)</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">nom</span><span class="p">,</span><span class="w"> </span><span class="n">personne</span><span class="p">.</span><span class="na">nom</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">prenom</span><span class="p">,</span><span class="w"> </span><span class="n">personne</span><span class="p">.</span><span class="na">prenom</span><span class="p">)</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">age</span><span class="p">,</span><span class="w"> </span><span class="n">personne</span><span class="p">.</span><span class="na">age</span><span class="p">)</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">xtopsup</span><span class="p">,</span><span class="w"> </span><span class="n">personne</span><span class="p">.</span><span class="na">xtopsup</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">xdmaj</span><span class="p">,</span><span class="w"> </span><span class="n">personne</span><span class="p">.</span><span class="na">xdmaj</span><span class="p">)</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">xuuid</span><span class="p">,</span><span class="w"> </span><span class="n">personne</span><span class="p">.</span><span class="na">xuuid</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Une red√©finition de la m√©thode "<em>hashCode()</em>" </li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">hashCode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">hash</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">personne_id</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">nom</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">prenom</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">age</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">xtopsup</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">xdmaj</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">xuuid</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Une red√©finition de la m√©thode "<em>toString()</em>" </li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">"PersonneDtoImpl { personne_id = "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">personne_id</span>
<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="s">"nom = "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">nom</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"prenom = "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">prenom</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"age = "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">age</span>
<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="s">"xtopsup = "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">xtopsup</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"xdmaj = "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">xdmaj</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"xuuid = "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">xuuid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"}"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>‚Ä¢ <strong><em>[package racine].domain.port.adapters.[nom du namespace]</em></strong> : Contient les interfaces (ports) pour les services d'infrastructure (couche de persistance), avec pour chaque service mod√©lis√© une interface d'acc√®s √† l'impl√©mentation (adapter). Il s'agit donc de l'acc√®s au "<em>inbounds</em>", toutes les interfaces sont de type <strong><em>[nom du DTO]Provider</em></strong>. </p>
<p>‚ùó On parle ici de "Provider" car on consid√®re que, pour la couche m√©tier, l'acc√®s √† la couche de persistance est un service fourni. Par ailleurs √† ce niveau le domaine n'a pas √† savoir si la donn√©e provient d'une base de donn√©es, d'un fournisseur de mail, d'un fournisseur de services REST, etc... Cet acc√®s est transparent √† ce niveau, le m√©tier sait uniquement qu'il peut r√©cup√©rer des informations concernant l'entit√© qu'il est cens√© g√©rer, peut importe comment ces informations sont r√©cup√©r√©es. </p>
<p>On reprend ici l'ensemble des op√©rations mod√©lis√©es au niveau du diagramme SOA.</p>
<div class="codehilite"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * Service de gestion des personnes.</span>
<span class="cm"> * </span>
<span class="cm"> * @Author j.dupont</span>
<span class="cm"> */</span>
<span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">GestionPersonnesProvider</span><span class="w"> </span><span class="p">{</span>

<span class="w"> </span><span class="cm">/**</span>
<span class="cm">  * Cette m√©thode retourne la personne qui correspond √† l'identifiant pass√© en</span>
<span class="cm">  * param√®tre.</span>
<span class="cm">  * </span>
<span class="cm">  * @param identifiant : L'identifiant pour la personne.</span>
<span class="cm">  *</span>
<span class="cm">  * @return Optional&lt;PersonneDtoImpl&gt; : La personne.</span>
<span class="cm">  */</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">PersonneDtoImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">chercheParId</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">identifiant</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Retourne la liste des personnes pr√©sentes en base.</span>
<span class="cm">   * </span>
<span class="cm">   *</span>
<span class="cm">   * @return List&lt;PersonneDtoImpl&gt; : La liste de toutes les personnes pr√©sentes en base.</span>
<span class="cm">   */</span>
<span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">PersonneDtoImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">retourneTous</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>‚Ä¢ <strong><em>[package racine].domain.port.adapters.features.[nom du namespace]</em></strong> : Contient les interfaces (ports) pour l'appel des services m√©tier par l'infrastructure, avec pour chaque service mod√©lis√© une interface d'acc√®s √† l'impl√©mentation (adapter), ici le service REST. Il s'agit donc de l'acc√®s au "<em>outbounds</em>", toutes les interfaces sont de type <strong><em>[nom du service]Service</em></strong>. Avec la version actuelle de <strong>Pacman</strong>, ces interfaces on exactement le m√™me code que l'interface pour l'acc√®s au "Provider" de la couche de persistance (99% des cas d'utilisation).</p>
<p>‚Ä¢ <strong><em>[package racine].domain.services.[nom du namespace]</em></strong> : Contient les impl√©mentations des services m√©tier (qui impl√©mentent l'interface vue juste ci-dessus), avec pour chaque impl√©mentation un service nomm√© <strong><em>[nom du service]ServiceImpl</em></strong>.</p>
<div class="codehilite"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * Service de gestion des personnes.</span>
<span class="cm"> *</span>
<span class="cm"> * @Author j.dupont</span>
<span class="cm"> */</span>
<span class="w"> </span><span class="c1">// Start of user code 4a236703b9d5317c198dc3e3d6db3fc6</span>
<span class="w"> </span><span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">"unused"</span><span class="p">)</span>
<span class="w"> </span><span class="c1">// End of user code</span>
<span class="w"> </span><span class="nd">@DomainService</span>
<span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GestionPersonnesServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">GestionPersonnesService</span><span class="w"> </span><span class="p">{</span>

<span class="w">   </span><span class="cm">/** R√®gles de gestion associ√©es. */</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">GestionPersonnesRequirementImpl</span><span class="w"> </span><span class="n">requirements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GestionPersonnesRequirementImpl</span><span class="p">();</span>

<span class="w">   </span><span class="cm">/** Le logger pour la classe. */</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">LOG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">GestionPersonnesServiceImpl</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

<span class="w">   </span><span class="cm">/** Interface de persistance. */</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">GestionPersonnesProvider</span><span class="w"> </span><span class="n">gestionPersonnesProvider</span><span class="p">;</span>

<span class="w">   </span><span class="c1">// Start of user code 2234954db9958848e5c5f1c19fe4a482</span>
<span class="w">   </span><span class="c1">// End of user code</span>

<span class="w">   </span><span class="cm">/**</span>
<span class="cm">    * Constructeur avec injection de la persistance.</span>
<span class="cm">    */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">GestionPersonnesServiceImpl</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">GestionPersonnesProvider</span><span class="w"> </span><span class="n">gestionPersonnesProvider</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="na">gestionPersonnesProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gestionPersonnesProvider</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Cette m√©thode retourne la personne qui correspond √† l'identifiant pass√© en</span>
<span class="cm">     * param√®tre.</span>
<span class="cm">     * </span>
<span class="cm">     * @param identifiant : L'identifiant pour la personne.</span>
<span class="cm">     *</span>
<span class="cm">     * @return Optional&lt;PersonneDtoImpl&gt; : La personne.</span>
<span class="cm">     */</span>
<span class="w">     </span><span class="c1">// Start of user code ea90c22bb8cac819a5c286613bb46870</span>
<span class="w">     </span><span class="c1">// End of user code</span>
<span class="w">     </span><span class="nd">@Override</span>
<span class="w">     </span><span class="kd">public</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">PersonneDtoImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">chercheParId</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">identifiant</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">// Appel des exigences en provenance de la mod√©lisation</span>
<span class="w">        </span><span class="c1">// Start of user code 1804fe669db8e4489d6be56c814e9b1d</span>

<span class="w">        </span><span class="c1">// End of user code</span>

<span class="w">        </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">PersonneDtoImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">personne</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">gestionPersonnesProvider</span><span class="p">.</span><span class="na">chercheParId</span><span class="p">(</span><span class="n">identifiant</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Start of user code 1f02d896fb99cca181e0d94fc20b42f2</span>
<span class="w">        </span><span class="c1">// End of user code</span>

<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="n">personne</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="cm">/**</span>
<span class="cm">      * Retourne la liste des personnes pr√©sentes en base.</span>
<span class="cm">      * </span>
<span class="cm">      *</span>
<span class="cm">      * @return List&lt;PersonneDtoImpl&gt; : La liste des personnes pr√©sentes en base.</span>
<span class="cm">      */</span>
<span class="w">      </span><span class="c1">// Start of user code 0cef7902fd0827c082758b681c5b9e44</span>
<span class="w">      </span><span class="c1">// End of user code</span>
<span class="w">      </span><span class="nd">@Override</span>
<span class="w">      </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">PersonneDtoImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">retourneTous</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">// Appel des exigences en provenance de la mod√©lisation</span>
<span class="w">        </span><span class="c1">// Start of user code b3cd801bacaa8215ea8b99cd493f3c64</span>
<span class="w">        </span><span class="c1">// End of user code</span>

<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">PersonneDtoImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">personnes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">gestionPersonnesProvider</span><span class="p">.</span><span class="na">retourneTous</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Start of user code fc7467f7f1fb6f5cccd57590429003e4</span>
<span class="w">        </span><span class="c1">// End of user code</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">personnes</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div>
<p>Il s'agit de la classe "centrale" pour la manipulation des objets de l'application, afin d'√™tre prise en compte par Spring, la classe est annot√© "<strong><em>@DomainService</em></strong>": </p>
<ul>
<li>Par le bais de son interface "<em>GestionPersonnesService</em>", ce service est appelable par le service REST de l'infrastructure.</li>
<li>Par le biais de l'interface "<em>GestionPersonnesProvider</em>" (et l'injection dans le constructeur de son impl√©mentation), ce service est capable d'appeler l'infrastructure pour avoir acc√®s √† la couche de persistance. Comme l'impl√©mentation du fournisseur de persistance est au niveau de l'infrastructure, mais que son interface est d√©finie au niveau du domaine, le domaine n'a pas √† connaitre l'infrastructure et n'a donc aucune d√©pendance Maven sur le projet <strong><em>[nom de l'application]-server</em></strong> </li>
</ul>
<p>Par ailleurs, une classe <strong><em>[nom du service]RequirementsImpl</em></strong> est aussi automatiquement g√©n√©r√©e (m√™me si aucune r√®gle de gestion n'a √©t√© pr√©alablement mod√©lis√©e, dans ce cas le corps est vide). Cette classe contient l'ensemble des r√®gles qui ont √©t√© attach√©es au service. Comme dans le cas de l'application "demo" une r√®gle concernant le contr√¥le de l'√¢ge a √©t√© pr√©alablement positionn√©e sur l'op√©ration, le code g√©n√©r√© par d√©faut pour cette classe est donc le suivant : </p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GestionPersonnesRequirementImpl</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * La personne doit √™tre majeure .</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Requirement</span><span class="p">(</span><span class="n">RequirementsEnum</span><span class="p">.</span><span class="na">REQ_PERSONNE_AGE</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// Start of user code 1b38da379e5345c55bdffa8f819e2607</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">exigenceREQ_PERSONNE_AGE</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DemoNotImplementedException</span><span class="p">(</span>
<span class="w">                </span><span class="s">"La r√®gle de gestion : La personne doit √™tre majeure n'a pas √©t√© impl√©ment√©e."</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// End of user code</span>

<span class="w">    </span><span class="c1">// Start of user code 5b1f0e7b5b1a0ffc337957baef521227</span>
<span class="w">    </span><span class="c1">// End of user code</span>
<span class="p">}</span>
</code></pre></div>
<p>C'est au d√©veloppeur d'impl√©menter le code pour la r√®gle de gestion (on peut par ailleurs constater que c'est la totalit√© de la m√©thode qui est positionn√©e entre balises de type "<em>user code</em>" car le g√©n√©rateur ne peut connaitre par avance les param√®tres entrants et sortants pour la r√®gle de gestion. Ainsi dans le cas (tr√®s simple) de la pr√©c√©dente mod√©lisation l'impl√©mentation pourrait √™tre la suivante : </p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">exigenceREQ_PERSONNE_AGE</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">PersonneDtoImpl</span><span class="w"> </span><span class="n">personne</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">personne</span><span class="p">.</span><span class="na">getAge</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Ou encore : </p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">exigenceREQ_PERSONNE_AGE</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">PersonneDtoImpl</span><span class="w"> </span><span class="n">personne</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">personne</span><span class="p">.</span><span class="na">getAge</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">18</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">"La personne doit avoir plus de 18 ans"</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Pour int√©grer la r√®gle de gestion, c'est encore une fois au d√©veloppeur de coder l'appel √† l'emplacement d√©sir√© au sein de l'impl√©mentation de son service (avant ou apr√®s l'appel selon la r√®gle) et d'effectuer les actions n√©cessaires en fonction du retour de ladite r√®gle. </p>
<p>Par exemple : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Override</span>
<span class="nd">@Requirement</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">RequirementsEnum</span><span class="p">.</span><span class="na">REQ_PERSONNE_AGE</span><span class="w"> </span><span class="p">})</span>
<span class="kd">public</span><span class="w"> </span><span class="n">PersonneDtoImpl</span><span class="w"> </span><span class="nf">chercheParId</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">identifiant</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">   </span><span class="c1">// Appel des exigences en provenance de la mod√©lisation</span>
<span class="w">   </span><span class="c1">// requirements.exigenceREQ_PERSONNE_AGE();</span>

<span class="w">   </span><span class="c1">// Start of user code 1804fe669db8e4489d6be56c814e9b1d</span>
<span class="w">   </span><span class="c1">// End of user code</span>

<span class="w">   </span><span class="n">PersonneDtoImpl</span><span class="w"> </span><span class="n">personne</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">gestionPersonnesProvider</span><span class="p">.</span><span class="na">chercheParId</span><span class="p">(</span><span class="n">identifiant</span><span class="p">);</span>

<span class="w">   </span><span class="c1">// Start of user code 1f02d896fb99cca181e0d94fc20b42f2</span>
<span class="w">   </span><span class="c1">// On lance diretement l'exception qui va effectuer un traitement particulier </span>
<span class="w">   </span><span class="c1">// si la personne retourn√©e n'est pas majeure</span>
<span class="w">   </span><span class="n">requirements</span><span class="p">.</span><span class="na">exigenceREQ_PERSONNE_AGE</span><span class="p">(</span><span class="n">personne</span><span class="p">);</span>
<span class="w">   </span><span class="c1">// End of user code</span>

<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">personne</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Ou encore : </p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Start of user code 1f02d896fb99cca181e0d94fc20b42f2</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">requirements</span><span class="p">.</span><span class="na">exigenceREQ_PERSONNE_AGE</span><span class="p">(</span><span class="n">personne</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="c1">// On ajoute un message indiquant que la personne retourn√©e n'est pas majeure....</span>
<span class="p">}</span>
<span class="c1">// End of user code</span>
</code></pre></div>
<p>Voici donc un bref sch√©ma r√©capitulatif qui permet de mieux appr√©hender l'ensemble de traitements lors de l'appel d'un service m√©tier : </p>
<div align="center">
<img alt="G√©n√©ration soa" src="images/pcm-gen-soa-2.png" width="600"/>
</div>
<p>‚Ä¢ <strong><em>[package racine].domain.port.adapters.stub.[nom du namespace]</em></strong> : Au niveau des tests unitaires, le domaine doit pouvoir fonctionner en totale autonomie (il ne s'agit pas ici de tests d'int√©gration mais bien de tests m√©tier). Dans cette optique une classe bouchon (stub) <strong><em>[nom du service]StubImpl</em></strong> est automatiquement g√©n√©r√©e pour chaque entit√© afin de remplacer la couche de persistance. Par d√©faut, toutes les m√©thodes renvoient une "<strong><em>NotImplementedException</em></strong>". C'est au d√©veloppeur d'impl√©menter son propre jeu de test.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@StubService</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GestionPersonnesProviderStubImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">GestionPersonnesProvider</span><span class="w"> </span><span class="p">{</span>

<span class="w">   </span><span class="cm">/**</span>
<span class="cm">    * Cette m√©thode retourne la personne qui correspond √† l'identifiant pass√© en </span>
<span class="cm">    * param√®tre.</span>
<span class="cm">    * </span>
<span class="cm">    * @param identifiant : L'identifiant pour la personne.</span>
<span class="cm">    *</span>
<span class="cm">    * @return Optional&lt;PersonneDtoImpl&gt; : La personne.</span>
<span class="cm">    */</span><span class="w"> </span>
<span class="w">   </span><span class="nd">@Override</span>
<span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">PersonneDtoImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">chercheParId</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">identifiant</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Start of user code 3526af85e72642a68569bcae02d07e77</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DemoNotImplementedException</span><span class="p">(</span>
<span class="w">            </span><span class="s">"Le test n'a pas √©t√© impl√©ment√© pour le stub : GestionPersonnesServiceImpl"</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// End of user code</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">etc</span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<p>‚ùó Le stub impl√©mente toujours la m√™me interface que l'impl√©mentation de production, afin d'√™tre pris en compte par Spring, il est annot√© "<strong><em>@StubService</em></strong>".     </p>
<p>‚Ä¢ <strong><em>[package racine].domain.services.[nom du namespace]</em></strong> (TESTS) : Contient les classes Junit de test m√©tier <strong><em>[nom du service]ServiceTestImpl</em></strong> pour les services. Chaque service b√©n√©ficie de sa propre classe de test. Non impl√©ment√©e par d√©faut, c'est au d√©veloppeur de r√©aliser le codage n√©cessaire pour effectuer l'ensemble de ses propres tests m√©tier.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@ExtendWith</span><span class="p">(</span><span class="n">GestionPersonnesServiceParamResolver</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GestionPersonnesServiceTestImpl</span><span class="w"> </span><span class="p">{</span>

<span class="w">   </span><span class="nd">@Test</span>
<span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">chercheParId</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">GestionPersonnesServiceImpl</span><span class="w"> </span><span class="n">gestionPersonnes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Start of user code 3526af85e72642a68569bcae02d07e77</span>

<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DemoNotImplementedException</span><span class="p">(</span>
<span class="w">            </span><span class="s">"Le test n'a pas √©t√© impl√©ment√© pour le service : GestionPersonnesServiceImpl"</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// End of user code</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="n">etc</span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<p>‚Ä¢  <strong><em>[package racine].domain.services.resolvers.[nom du namespace]</em></strong> (TESTS) : Contient les classes de r√©solution <strong><em>[nom du service]ParamResolver</em></strong> pour les Stubs de chaque service dans le cadre des tests. Il s'agit d'une petite classe technique qui permet √† JUnit d'injecter le Stub √† la place du fournisseur initial ("Provider") de la couche d'acc√®s √† la persistance.</p>
<p><strong>Au niveau du projet du serveur (couche infrastructure)</strong> : </p>
<p>C'est au niveau du projet infrastructure que se situe la plus grande partie du code g√©n√©r√©. Vont √™tre g√©n√©r√©s, les services REST, les services de persistance (pour la majorit√© un acc√®s √† la base de donn√©es) et les diff√©rentes couches techniques qui permettent la communication et le partage des objets m√©tier entre les diff√©rentes couches (surplus de code inh√©rent √† l'architecture hexagonale). Comme vu pr√©c√©demment, il a √©t√© d√©cid√© pour plus de lisibili√©, de s√©parer la couche "globale" infrastructure en deux : infrastructure et application.</p>
<p>‚Ä¢ <strong><em>[package racine].infra.adapters.[nom du namespace]</em></strong> : Contient l'ensemble des classes pour l'impl√©mentation des services de persistance. Chaque service m√©tier b√©n√©ficie de son service de persistance <strong><em>[nom du service]JpaProviderImpl</em></strong> qui lui permet de coder ses acc√®s √† la base de donn√©es, gr√¢ce au "Repository" qui a √©t√© g√©n√©r√© au niveau de la demande de g√©n√©ration de la couche de persistance (voir plus haut) et qui est automatiquement inject√©e dans le service. La classe est annot√©e "<strong><em>@AdapterService</em></strong>" pour √™tre prise en compte par Spring.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@AdapterService</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GestionPersonnesJpaProviderImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">GestionPersonnesProvider</span><span class="w"> </span><span class="p">{</span>

<span class="w">     </span><span class="c1">// Start of user code 2129864a49adcaa3a812f92be467bf4e</span>
<span class="w">     </span><span class="c1">// End of user code</span>

<span class="w">     </span><span class="cm">/** Gestionnaires de persistance disponibles. */</span>
<span class="w">     </span><span class="kd">final</span><span class="w"> </span><span class="n">PersonneRepository</span><span class="w"> </span><span class="n">personneRepository</span><span class="p">;</span>

<span class="w">     </span><span class="cm">/**</span>
<span class="cm">      * Constructeur.</span>
<span class="cm">      */</span>
<span class="w">      </span><span class="nd">@Autowired</span>
<span class="w">      </span><span class="kd">public</span><span class="w"> </span><span class="nf">GestionPersonnesJpaProviderImpl</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">PersonneRepository</span><span class="w"> </span><span class="n">personneRepository</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">personneRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">personneRepository</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Start of user code 2e3e969fd52202f4f94ef7456a361c15</span>
<span class="w">        </span><span class="c1">// End of user code</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="n">etc</span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<p>‚ùó A ce niveau dans l'application, il aurait √©t√© possible de simplement positionner une annotation "<strong><em>@Service</em></strong>" ou "<strong><em>@Component</em></strong>" puisque l'infrastructure est sous Spring mais il a √©t√© not√© des effets de bord avec les couches de test, et de mani√®re g√©n√©rale, il a √©t√© consid√©r√© comme plus homog√®ne que l'ensemble des couches aient des annotations sp√©cifiques projet, mais enregistr√©e aupr√®s de Spring.</p>
<p>‚ùó Bien noter le commentaire "Gestionnaires..disponibles", en effet, par d√©faut <strong>Pacman</strong> va prendre le gestionnaire sp√©cifiquement d√©di√© √† l'entit√©, mais si des relations avec d'autres entit√©s sont trouv√©es, les gestionnaires de ces entit√©s r√©f√©renc√©es sont alors eux aussi r√©cup√©r√©s et mis √† disposition.</p>
<p>Chaque impl√©mentation d'op√©ration mod√©lis√©e est d√©coup√©e en deux m√©thodes, la m√©thode d'acc√®s, qui impl√©mente celle de l'interface et qui est charg√©e des op√©rations de copie entre les objets, et la m√©thode d'invocation qui contient l'appel √† la couche de persistance. Comme toujours (lorsque la mod√©lisation ne permet pas d'effectuer la totalit√© de la g√©n√©ration), la m√©thode d'invocation renvoie toujours une exception de type "<strong><em>NotImplementedExcption</em></strong>".</p>
<div class="codehilite"><pre><span></span><code><span class="w">  </span><span class="cm">/**</span>
<span class="cm">     * Cette m√©thode retourne la personne qui correspond √† l'identifiant pass√© en</span>
<span class="cm">     * param√®tre.</span>
<span class="cm">     * </span>
<span class="cm">     * @param identifiant : L'identifiant pour la personne.</span>
<span class="cm">     *</span>
<span class="cm">     * @return Optional&lt;PersonneDtoImpl&gt; : La personne.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">PersonneDtoImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">chercheParId</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">identifiant</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">// Start of user code 3526af85e72642a68569bcae02d07e77</span>
<span class="w">        </span><span class="c1">// End of user code</span>

<span class="w">        </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">PersonneEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chercheParId_invoke</span><span class="p">(</span><span class="n">identifiant</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">isPresent</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">PersonneMapper</span><span class="p">.</span><span class="na">toDto</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">get</span><span class="p">()));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Cette m√©thode retourne la personne qui correspond √† l'identifiant pass√© en</span>
<span class="cm">     * param√®tre.</span>
<span class="cm">     * </span>
<span class="cm">     * @param identifiant : L'identifiant pour la personne.</span>
<span class="cm">     *</span>
<span class="cm">     * @return Optional&lt;PersonneDtoImpl&gt; : La personne.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">PersonneEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">chercheParId_invoke</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">identifiant</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">// Start of user code 0d7aeafd27536987cf0cf491de14ca07</span>

<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DemoNotImplementedException</span><span class="p">(</span><span class="s">"La m√©thode 'chercheParId' n'a pas √©t√© impl√©ment√©e"</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// End of user code</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Retourne la liste des personnes pr√©sente en base.</span>
<span class="cm">     * </span>
<span class="cm">     *</span>
<span class="cm">     * @return List&lt;PersonneDtoImpl&gt; : La liste des personnes pr√©sentes en base.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">PersonneDtoImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">retourneTous</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">// Start of user code 1f82841b68b9a27af5cfcf572412847c</span>
<span class="w">        </span><span class="c1">// End of user code</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">retourneTous_invoke</span><span class="p">().</span><span class="na">stream</span><span class="p">().</span><span class="na">map</span><span class="p">(</span><span class="n">o</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">PersonneMapper</span><span class="p">.</span><span class="na">toDto</span><span class="p">(</span><span class="n">o</span><span class="p">)).</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Retourne la liste des personnes pr√©sentes en base.</span>
<span class="cm">     * </span>
<span class="cm">     *</span>
<span class="cm">     * @return List&lt;PersonneDtoImpl&gt; : La liste des personnes pr√©sentes en base.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">PersonneEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">retourneTous_invoke</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">// Start of user code ac726b97d06e0252fbb02a99667258b7</span>

<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DemoNotImplementedException</span><span class="p">(</span><span class="s">"La m√©thode 'retourneTous' n'a pas √©t√© impl√©ment√©e"</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// End of user code</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<p>Dans le cas sp√©cifique de l'application "demo" et selon la mod√©lisation effectu√©e, il s'agit pour ces deux op√©rations de simples op√©rations de type CRUD, il est donc possible de r√©aliser tr√®s simplement l'impl√©mentation suivante pour les deux m√©thodes d'invocation : </p>
<div class="codehilite"><pre><span></span><code><span class="kd">private</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">PersonneEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">chercheParId_invoke</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">identifiant</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Start of user code 0d7aeafd27536987cf0cf491de14ca07</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">personneRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">identifiant</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// End of user code     </span>
<span class="p">}</span>

<span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">PersonneEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">retourneTous_invoke</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Start of user code ac726b97d06e0252fbb02a99667258b7</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">personneRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// End of user code</span>
<span class="p">}</span>
</code></pre></div>
<p>‚Ä¢ <strong><em>[package racine].infra.entities.mappers.[nom du namespace]</em></strong> : Au niveau de l'impl√©mentation de la couche de persistance <strong><em>[nom du service]JpaProviderImpl</em></strong> il a √©t√© possible de voir que la classe faisait appel √† une m√©thode de mappeur (en locurence "<em>PersonneMapper.toDto(o)</em>"). Ce package contient l'ensemble des mappeurs qui permettent pour chaque entit√©, la recopie des donn√©es vers un objet m√©tier et celle de l'objet m√©tier vers l'entit√©. Ceci est effectu√© √† l'aide des deux m√©thodes impl√©ment√©es : "<strong><em>toDto(..)</em></strong>" et "<strong><em>toEntity()</em></strong>". </p>
<p>Chaque mappeur contient un code tr√®s simple qui permet cette copie, voici par exemple le code pour la cr√©ation de l'objet m√©tier, il s'agit du code le plus complet car la seule m√©thode √† effectuer consiste √† la recopie des champs automatiques (pour rappel, les champs automatiques ne redescendent pas et ne montent pas plus haut que la couche m√©tier) : </p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">PersonneDtoImpl</span><span class="w"> </span><span class="nf">toDto</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">PersonneEntityImpl</span><span class="w"> </span><span class="n">entity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">entity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">PersonneDtoImpl</span><span class="w"> </span><span class="n">dto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PersonneDtoImpl</span><span class="p">();</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">dto</span><span class="p">.</span><span class="na">setPersonne_id</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getPersonne_id</span><span class="p">());</span>
<span class="w">        </span><span class="n">dto</span><span class="p">.</span><span class="na">setNom</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getNom</span><span class="p">());</span>
<span class="w">        </span><span class="n">dto</span><span class="p">.</span><span class="na">setPrenom</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getPrenom</span><span class="p">());</span>
<span class="w">        </span><span class="n">dto</span><span class="p">.</span><span class="na">setAge</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getAge</span><span class="p">());</span>
<span class="w">        </span><span class="n">dto</span><span class="p">.</span><span class="na">setXtopsup</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getXtopsup</span><span class="p">());</span>
<span class="w">        </span><span class="n">dto</span><span class="p">.</span><span class="na">setXdmaj</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getXdmaj</span><span class="p">());</span>
<span class="w">        </span><span class="n">dto</span><span class="p">.</span><span class="na">setXuuid</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getXuuid</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// Start of user code 856cc109a8cab6eb0a3676613acc6f8f</span>
<span class="w">        </span><span class="c1">// End of user code</span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DemoMapperException</span><span class="p">(</span><span class="s">"Impossible de mapper la classe : PersonneDtoImpl"</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">dto</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>‚Ä¢ <strong><em>[package racine].app.adapters.controllers.[nom du namespace]</em></strong> : Contient les points d'entr√©e (sous forme de services REST dans le cas de <strong>Pacman</strong>) pour les diff√©rents service ("<em>outbounds</em>" au niveau de l'architecture REST). Chaque service <strong><em>[nom du service]ControllerImpl</em></strong> fait appel √†  l'interface en provenance du domaine <strong><em>[nom du service]Feature</em></strong> dont l'injection de l'impl√©mentation est effectu√©e dans le constructeur par le framework Spring : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">"/v0/api/personnes"</span><span class="p">)</span>
<span class="nd">@Tag</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"GestionPersonnes"</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Service de gestion des personnes."</span><span class="p">)</span>
<span class="c1">// Start of user code 5279f4e79131b3bfeb4c9f26a960106d</span>
<span class="c1">// End of user code</span>
<span class="kd">class</span> <span class="nc">GestionPersonnesControllerImpl</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Interface service m√©tier.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">GestionPersonnesService</span><span class="w"> </span><span class="n">gestionPersonnes</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Constructeur.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">GestionPersonnesControllerImpl</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">GestionPersonnesService</span><span class="w"> </span><span class="n">gestionPersonnes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">gestionPersonnes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gestionPersonnes</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Le code est ici standard et ne m√©rite pas d'explication particuli√®re. L'URI est ici branch√©e sur "<em>/v0/api/personnes</em>" selon les diff√©rents √©l√©ments de mod√©lisation (pour la version on prend toujours uniquement le num√©ro majeur pr√©c√©d√© de la lettre "v"). Au niveau des op√©rations mod√©lis√©es, le g√©n√©rateur passe toujours par un monteur pour la r√©ponse, ce qui permet √† la fois d'avoir l'ensemble du code d'appel enti√®rement g√©n√©r√© et de laisser la possibilit√© au d√©veloppeur de rajouter des informations suppl√©mentaires au niveau des balises de type "<em>user code</em>". La description Open Api est, elle aussi, automatiquement g√©n√©r√©e.</p>
<p>Pour la premi√®re op√©ration de recherche par identifiant, comme il est possible de ne pas avoir d'enregistrement et que une "<em>fault</em>" a √©t√© mod√©lis√©e, cela permet d'avoir un message personnalis√© en cas d'erreur fonctionnelle. </p>
<p>‚ùó La documentation Open Api a √©t√© volontairement retir√©e du code g√©n√©r√© afin de limiter le nombre de lignes et, dans un premier temps, se focaliser uniquement sur l'appel des diff√©rents services.</p>
<div class="codehilite"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * Cette m√©thode retourne la personne qui correspond √† l'identifiant pass√© en</span>
<span class="cm"> * param√®tre.</span>
<span class="cm"> * </span>
<span class="cm"> * @param identifiant : L'identifiant pour la personne.</span>
<span class="cm"> *</span>
<span class="cm"> * @return Optional&lt;PersonneDtoImpl&gt; : La personne.</span>
<span class="cm"> */</span>
<span class="c1">// Start of user code ea90c22bb8cac819a5c286613bb46870</span>
<span class="c1">// End of user code</span>
<span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/{id}"</span><span class="p">,</span><span class="w"> </span><span class="n">produces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"application/json;charset=utf8"</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">PersonneXtoImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">chercheParId</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"id"</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">identifiant</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">BodyBuilder</span><span class="w"> </span><span class="n">responseBuilder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Start of user code 3526af85e72642a68569bcae02d07e77</span>

<span class="w">    </span><span class="c1">// End of user code</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">gestionPersonnes</span><span class="p">.</span><span class="na">chercheParId</span><span class="p">(</span><span class="n">identifiant</span><span class="p">).</span><span class="na">map</span><span class="p">(</span><span class="n">o</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">responseBuilder</span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">PersonneMapper</span><span class="p">.</span><span class="na">toXto</span><span class="p">(</span><span class="n">o</span><span class="p">)))</span>
<span class="w">            </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DemoNotFoundException</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span><span class="w"> </span><span class="s">"La personne n'a pas √©t√© trouv√©e."</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * Retourne la liste des personnes pr√©sentes en base.</span>
<span class="cm"> * </span>
<span class="cm"> *</span>
<span class="cm"> * @return List&lt;PersonneDtoImpl&gt; : La liste des personnes pr√©sentes en base.</span>
<span class="cm"> */</span>
<span class="c1">// Start of user code 0cef7902fd0827c082758b681c5b9e44</span>
<span class="c1">// End of user code</span>
<span class="nd">@GetMapping</span><span class="p">(</span><span class="n">produces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"application/json;charset=utf8"</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">PersonneXtoImpl</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">retourneTous</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">BodyBuilder</span><span class="w"> </span><span class="n">responseBuilder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Start of user code 1f82841b68b9a27af5cfcf572412847c</span>

<span class="w">    </span><span class="c1">// End of user code</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">responseBuilder</span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">gestionPersonnes</span><span class="p">.</span><span class="na">retourneTous</span><span class="p">().</span><span class="na">stream</span><span class="p">().</span><span class="na">map</span><span class="p">(</span><span class="n">o</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">PersonneMapper</span><span class="p">.</span><span class="na">toXto</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">()));</span>
<span class="p">}</span>
</code></pre></div>
<p>‚ùó Il est √† remarquer que les objets m√©tier ne sont jamais envoy√©s au client, il sont avant recopi√©s dans des objets s√©rialis√©s de type <strong><em>[nom du dto]XtoImpl</em></strong>.</p>
<p>‚Ä¢ <strong><em>[package racine].app.entities.mappers.[nom du namespace]</em></strong> : Contient les mappeurs pour effectuer les conversions entre les objets m√©tier et les objets serialis√©s. Le code est similaire √† celui des mappeurs de la couche d'infrastructure.</p>
<p>‚Ä¢ <strong><em>[package racine].app.entities.[nom du namespace]</em></strong> : Contient la liste des objets serialis√©s qui seront envoy√©s vers ou en provenance du client. A noter simplement qu'il est possible √† ce niveau de positionner des annotations sp√©cifiques JSON afin de masquer des champs, sp√©cifier un nom particulier pour l'attribut, etc...</p>
<div class="codehilite"><pre><span></span><code><span class="cm">/** Le nom de la personne. Cette donn√©e est obligatoire. */</span>
<span class="c1">// Start of user code aee37c30f5d091a495526f636a3527bb</span>
<span class="nd">@JsonProperty</span><span class="p">(</span><span class="s">"nom"</span><span class="p">)</span>
<span class="c1">// End of user code</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">;</span>
</code></pre></div>
<h3 id="tests_1">Tests</h3>
<p>‚Ä¢ <strong><em>[package racine].app.adapters.[nom du namespace]</em></strong> : Contient la liste des classes de test d'int√©gration pour chaque service REST. Chaque classe <strong><em>[nom du service]ServiceTestImpl</em></strong> permet de lancer le serveur et d'effectuer un appel REST avec des informations par d√©faut. Suite √† la g√©n√©ration, on v√©rifie si le code de retour du service est bien celui attendu et le test est alors valid√©. Le d√©veloppeur, √† l'aide des balises de type "<em>user code</em>" peut toujours ajouter √† sa guise autant d'√©l√©m√©nts que n√©cessaires pour complexifier ses propres cas de test. </p>
<p>A l'aide de l'annotation "<strong><em>@TestPropertySource</em></strong>" on demande √† Spring de prendre le fichier de configuration "<strong><em>test.properties</em></strong>" au lieu de la configuration de production "<strong><em>application.properties</em></strong>", on demande le chargement et l'initialisation de la base de donn√©es. Toujours de la m√™me mani√®re, les diff√©rentes ressources sont inject√©es par le biais du constructeur.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@AutoConfigureMockMvc</span>
<span class="nd">@ExtendWith</span><span class="p">(</span><span class="n">SpringExtension</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@SpringBootTest</span><span class="p">(</span><span class="n">webEnvironment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringBootTest</span><span class="p">.</span><span class="na">WebEnvironment</span><span class="p">.</span><span class="na">MOCK</span><span class="p">)</span>
<span class="nd">@TestPropertySource</span><span class="p">(</span><span class="n">locations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"classpath:tests.properties"</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GestionPersonnesServiceTestImpl</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">DemoTestAbs</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Instance de {@link MockMvc} pour effectuer des requ√™tes HTTP simul√©es dans</span>
<span class="cm">     * les tests.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">MockMvc</span><span class="w"> </span><span class="n">restHelper</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Instance de {@link GestionPersonnesProvider} qui est utilis√©e pour g√©rer les</span>
<span class="cm">     * op√©rations de persistance au niveau des tests.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">"unused"</span><span class="p">)</span><span class="w"> </span><span class="c1">// Pour l'instant.</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">GestionPersonnesProvider</span><span class="w"> </span><span class="n">provider</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Instance de {@link ObjectMapper} utilis√©e pour g√©rer les op√©rations de</span>
<span class="cm">     * conversion entre une entit√© et json.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Constructeur.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="n">GestionPersonnesServiceTestImpl</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">GestionPersonnesProvider</span><span class="w"> </span><span class="n">provider</span><span class="p">,</span>
<span class="w">            </span><span class="kd">final</span><span class="w"> </span><span class="n">MockMvc</span><span class="w"> </span><span class="n">restHelper</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">provider</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">objectMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">restHelper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">restHelper</span><span class="p">;</span>
<span class="w">        </span><span class="n">initSql</span><span class="p">(</span><span class="n">dataSource</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="n">etc</span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<p>A partir du moment ou la g√©n√©ration de la couche de service a √©t√© effectu√©e, il est possible (apr√®s avoir impl√©ment√© le code de la couche de persistance au niveau de la classe <strong><em>[nom du service]JpaProviderImpl</em></strong>) d'attaquer directement les tests d'int√©gration qui permettent de valider la globalit√© de la chaine. </p>
<p>‚ùó Il est important de noter que si les tests sont lanc√©s alors que l'impl√©mentation de la classe de persistance n'a pas encore √©t√© effectu√©e, les tests renvoient (au niveau JUnit) un retour positif mais le d√©tail des tests est, quant √† lui, n√©gatif :  </p>
<p><img alt="Tests d'int√©gration" src="images/pcm-test-soa-1.png"/></p>
<p>Cela est du √† la pr√©sence par d√©faut de l'annotation "<strong><em>@Disabled("En attente de l'impl√©mentation de la couche de persistance")</em></strong>" positionn√©e par d√©faut sur chaque test. Ne pas oublier d'enlever cette annotation une fois que les tests sont impl√©ment√©s. A voir si cette annotation sera conserv√©e dans le future, mais cela √©vite d'√™tre en erreur sur un serveur d'int√©gration continue alors qu'en fait, la chaine est valide (sur 90% du code que l'on d√©sire tester) hormis une simple probl√©matique de r√©cup√©ration des donnn√©es non encore impl√©ment√©e (ce qui en soit n'est pas consid√©r√© comme une erreur). </p>
<p>Cela est donc laiss√© au choix des d√©veloppeurs qui peuvent, suite √† la premi√®re g√©n√©ration, supprimer de suite cette annotation s'ils d√©sirent que les tests soient en erreur.</p>
<p>Au niveau des tests, comme pr√©cis√© ci-dessus et par d√©faut, le code g√©n√©r√© pose juste la structure d'appel de base et v√©rifie simplement si le code de retour du service est bien celui attendu. Si cela est le cas, le test est alors consid√©r√© comme valid√©.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Test</span>
<span class="c1">// Start of user code b9016888c594d13644084667286bfe9c</span>
<span class="nd">@Disabled</span><span class="p">(</span><span class="s">"En attente de l'impl√©mentation de la couche de persistance"</span><span class="p">)</span>
<span class="c1">// End of user code</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">retourneTous</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Start of user code bd802d7d3e35db7077c719c62b551092</span>
<span class="w">    </span><span class="c1">// End of user code</span>

<span class="w">    </span><span class="cm">/** Le statut attendu suite au test. */</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">expectedStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span>

<span class="w">    </span><span class="n">restHelper</span><span class="p">.</span><span class="na">perform</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">"/v0/api/personnes"</span><span class="p">).</span><span class="na">contentType</span><span class="p">(</span><span class="s">"application/json"</span><span class="p">))</span>

<span class="w">            </span><span class="c1">// Start of user code 6446dd56a2bc98c406960c0c3f2f9d1a</span>
<span class="w">            </span><span class="c1">// End of user code</span>

<span class="w">            </span><span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">status</span><span class="p">().</span><span class="na">is</span><span class="p">(</span><span class="n">expectedStatus</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<p>‚ùó Dans le cas de recherche par identifiant, afin d'√©viter une complexit√© technique au niveau des g√©n√©rateurs (√† ce niveau il n'est plus possible (complexe) de distinguer la cl√© primaire pour l'objet m√©tier), ce champ est donc initialis√© √† 0L comme tout champ de type "Long". Or pour rappel, au niveau des scripts d'initialisation la valeur de la cl√© primaire comment √† 1000L pour √©viter les collisions avec les √©ventuels ajouts de tuples par le d√©veloppeur. Il ne faut donc pas oublier de positionner la valeur "manuellement" √† 1000L sous peine de faire √©chouer le test avec une exception de type "<strong><em>NotFoundException</em></strong>". </p>
<p><img alt="Tests d'int√©gration" src="images/pcm-test-soa-3.png"/></p>
<p>C'est donc au d√©veloppeur d'ajouter l'ensemble des attendus n√©cessaires pour compl√©ter et consolider le test de base (si n√©cessaire). Une fois la couche de persistance compl√©t√©e, les tests doivent √™tres positifs.  </p>
<p><img alt="Tests d'int√©gration" src="images/pcm-test-soa-2.png"/></p>
<h2 id="gestion-des-champs-automatiques">‚ûï Gestion des champs automatiques</h2>
<hr/>
<p>Il a √©t√© bri√®vement √©voqu√© la notion de champs automatiques pr√©c√©demment (au niveau de la mod√©lisation des entit√©s) mais l'objectif de ce paragraphe est d'entrer plus en profondeur dans la classe de gestion pour l'ensemble de ces champs. A chaque demande de g√©n√©ration de la couche de persistance, c'est la classe <strong><em>[package racine].infra.[nom de l'application]EntityAbs</em></strong> qui est recr√©√©e et qui centralise la gestion des champs automatiques. A chaque demande de g√©n√©ration pour la couche de service, c'est la classe <strong><em>[package racine].domain.entities.[nom de l'application]EntityAbs</em></strong> qui est recr√©√©e et qui centralise les attributs pour mise √† disposition au niveau des diff√©rents objets m√©tier.</p>
<h3 id="champs-predefinis">Champs pr√©d√©finis</h3>
<p>Comme pr√©cit√©; il existe trois types de champs automatiques "pr√©d√©finis" qui sont respectivement les champs : </p>
<ul>
<li><strong>Xtopsup</strong> : g√®re la suppression logique des entit√©s dans le cas ou la base de donn√©es ne doit pas permettre la suppression physique des informations. Cet indicateur, sous la forme d'un bool√©en, est pilot√© automatiquement par Spring Data √† l'aide des annotations suivantes au niveau de chaque entit√© : </li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nd">@SQLDelete</span><span class="p">(</span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"UPDATE SCH.TBL_PERSONNE SET xtopsup = true WHERE TBL_PERSONNE_ID = ?"</span><span class="p">)</span>
<span class="nd">@SQLRestriction</span><span class="p">(</span><span class="s">"xtopsup = false"</span><span class="p">)</span>
</code></pre></div>
<p>‚ùó Ces annotations sont pour l'instant positionn√©es au niveau de chaque entit√© et non au niveau de la classe parent (commune √† l'ensemble des entit√©s) afin d'apporter plus de flexibilit√© si toutefois une entit√© √©chappe √† cette r√®gle. A voir si plus tard cela est v√©ritablement utile et si cette solution est toujours p√©renne.</p>
<ul>
<li>
<p><strong>Xdmaj</strong> : La derni√®re date de mise √† jour pour l'entit√©, il s'agit d'un indicateur standard sous forme de Timestamp.</p>
</li>
<li>
<p><strong>Xuuid</strong> : Un identifiant unique universel pour l'entit√©. Il est √† noter que cette identifiant ne doit jamais √™tre modifi√© par la suite, hors il existe toutefois un "<em>setter</em>" pour cet attribut (sinon il est impossible d'effectuer les mappings entre entit√©s et objets de transfert). Cepandant, afin d'assurer l'immutabilit√© de cet attribut, il est consid√©r√© comme non modifiable au niveau JPA.</p>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="cm">/** Identifiant unique universel. */</span>
<span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"xuuid"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">unique</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">updatable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="kd">protected</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">xuuid</span><span class="p">;</span>
</code></pre></div>
<p>Toutes les autres types de champs (String, Long, Boolean, etc...) sont (comme vu au niveau du formulaire de cr√©ation), ajoutables en tant que champs automatiques √† l'ensemble des entit√©s.</p>
<p>‚ùó Pour rappel, les champs automatiques sont des champs destin√©s √† la couche de persistance, ils sont donc pr√©sents au niveau des entit√©s et des objets m√©tier uniquement, mais ne sont jamais transf√©r√©s au niveau des services REST (la seule exception √† la r√®gle √©tant l'identifiant unique universel). Ainsi au niveau des mappeurs, la seule recopie globale se situe dans la copie de l'entit√© vers le dto afin de mettre √† disposition de l'objet de transfert ces informations et de rendre possibles les traitements internes m√©tier se basant sur ces informations.</p>
<h3 id="cycle-de-vie">Cycle de vie</h3>
<p>L'initialisation de ces champs est centralis√©e au niveau de la classe de d√©finition des champs automatiques et sont g√©r√©s avec les annotations "<strong><em>@PrePersist</em></strong>"  et/ou "<strong><em>@PreUpdate</em></strong>". L'annotation "<em>@PrePersist</em>" est appel√©e uniquement lors de la cr√©ation du tuple dans la base de donn√©es, "<em>@PreUpdate</em>" est appel√© lors des demandes de mise √† jour (totale ou partielle).</p>
<p>Par exemple : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@PrePersist</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">prePersist</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="c1">// Start of user code c68eaf37cb78a1bd3a58dc7e563107ed</span>
<span class="w">   </span><span class="k">this</span><span class="p">.</span><span class="na">xuuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">();</span>
<span class="w">   </span><span class="k">this</span><span class="p">.</span><span class="na">xtopsup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="p">}</span>
</code></pre></div>
<p>‚ùó Si l'√©criture est automatique pour les champs <em>Xtopsup</em> et <em>Xuuid</em>, dans le cas ou d'autres champs sont ajout√©s, ne pas oublier de les initialiser correctement avec les valeurs d√©sir√©es ou de les mettre √† jour dans l'une de ces deux m√©thodes sous peine d'avoir des erreurs (valeur nulle) √† la cr√©ation du tuple dans la base de donn√©es.</p>
<p>Il est possible de vouloir d√©sactiver cette initialisation automatique dans le cadre de traitements sp√©cifiques ou de tests (c'est d'ailleurs le cas pour le test unitaire sur le contr√¥le d'insertion de l'ensemble des attributs en base de donn√©es cf : "<strong><em>testAllFieldsInserted()</em></strong>"). La classe contient donc un indicateur de demande de d√©sactivation pour l'initialisation de ces champs, cet indicateur est non persistant pour la couche de persistance : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Transient</span>
<span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">disableAutoInit</span><span class="p">;</span>
</code></pre></div>
<p>Et fait le v√©ritable code g√©n√©r√© (avec ce contr√¥le suppl√©mentaire) pour "<strong><em>@PrePersist</em></strong>" (et "<strong><em>@PreUpdate</em></strong>") est du type : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@PrePersist</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">prePersist</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="na">disableAutoInit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Start of user code c68eaf37cb78a1bd3a58dc7e563107ed</span>
<span class="w">      </span><span class="n">setXtopsup</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span><span class="n">setXdmaj</span><span class="p">(</span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">      </span><span class="n">setXuuid</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">());</span>
<span class="w">     </span><span class="c1">// End of user code</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Avant d'effectuer le traitement ou le test, simplement demander au niveau de l'entit√©, la d√©sactivation des annotations et renseigner "manuellement" les diff√©rents attributs de l'entit√© √† l'aide du code suivant : </p>
<div class="codehilite"><pre><span></span><code><span class="n">PersonneEntityImpl</span><span class="w"> </span><span class="n">personne</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PersonneEntityImpl</span><span class="p">();</span>
<span class="n">personne</span><span class="p">.</span><span class="na">setDisableAutoInit</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="n">personne</span><span class="p">.</span><span class="na">setXtopsup</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="n">personne</span><span class="p">.</span><span class="na">setXdmaj</span><span class="p">(</span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">truncatedTo</span><span class="p">(....);</span>
<span class="n">personne</span><span class="p">.</span><span class="na">setXuuid</span><span class="p">(</span><span class="s">"axd125fg......."</span><span class="p">);</span>
</code></pre></div>
<p>L'avantage de cet attribut est qu'il est positionnable au niveau d'un seul traitement alors que l'utilisation de profils (<strong><em>@ActiveProfile</em></strong>) est, quant √† elle, disponible uniquement au niveau de la classe de traitement. Mais encore une fois, cet attribut peut fonctionner en collaboration avec l'utilisation de profils.</p>
<p>‚ùó Note : Les objets de transfert et les objets de s√©rialisation (pour les services REST) ont eux aussi leur classe parent, mais √©pur√©e selon le type de l'objet (DTO ou XTO). Cette classe est reg√©n√©r√©e au moment de la demande de g√©n√©ration de la couche de services et a volontairement le m√™me nom <strong><em>[nom de l'application]EntityAbs</em></strong> afin de bien rappeler qu'il s'agit avant tout d'attributs sp√©cifiques √† l'entit√© et non au DTO.</p>
<h2 id="gestion-de-la-securite">üîë Gestion de la s√©curit√©</h2>
<hr/>
<p>Par d√©faut, la s√©curit√© des services REST est toujours activ√©e, il est en effet consid√©r√© que tout service devrait √† priori √™tre s√©curis√©. Toutes les classes concernant la gestion de la s√©curit√© sont situ√©es au niveau du package suivant : <strong><em>[package racine].app</em></strong> dans le projet d'infrastructure.  </p>
<p>La configuration de la s√©curit√© pour l'ensemble de l'application se nomme : <strong><em>[nom de l'application]SecurityConfig</em></strong> et son code par d√©faut est le suivant : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Configuration</span>
<span class="nd">@EnableWebSecurity</span>
<span class="kd">class</span> <span class="nc">DemoSecurityConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SecurityFilterChain</span><span class="w"> </span><span class="nf">tokenFilterChain</span><span class="p">(</span><span class="n">HttpSecurity</span><span class="w"> </span><span class="n">http</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="n">http</span><span class="p">.</span><span class="na">cors</span><span class="p">(</span><span class="n">Customizer</span><span class="p">.</span><span class="na">withDefaults</span><span class="p">()).</span><span class="na">csrf</span><span class="p">(</span><span class="n">csrf</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">csrf</span><span class="p">.</span><span class="na">disable</span><span class="p">())</span>
<span class="w">          </span><span class="p">.</span><span class="na">sessionManagement</span><span class="p">(</span><span class="n">session</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">sessionCreationPolicy</span><span class="p">(</span><span class="n">SessionCreationPolicy</span><span class="p">.</span><span class="na">STATELESS</span><span class="p">))</span>
<span class="w">          </span><span class="p">.</span><span class="na">authorizeHttpRequests</span><span class="p">(</span><span class="n">request</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">           </span><span class="n">request</span><span class="p">.</span><span class="na">requestMatchers</span><span class="p">(</span><span class="s">"/**"</span><span class="p">).</span><span class="na">permitAll</span><span class="p">().</span><span class="na">anyRequest</span><span class="p">().</span><span class="na">permitAll</span><span class="p">();</span>
<span class="w">       </span><span class="p">}).</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Pour l'instant on peut constater que toutes les URIs sont en acc√®s libre ce qui semble contredire la pr√©c√©dente affirmation mais la s√©curit√© est quant √† elle bien enclanch√©e, m√™me si dans le cadre de la mod√©lisation les d√©veloppeurs ne veulent s√©curiser aucun service ! </p>
<p>‚ùó Avec les options prises pour <strong>Pacman</strong> quelle que soit la s√©curit√© mod√©lis√©e  (<em>Http</em>, <em>ApiKey</em>, etc...) le service va attendre un jeton de type JWT. Si cela fait partie int√©grante de la norme pour <em>Oauth2</em>, c'est une d√©cision qui a √©t√© prise dans le cadre de l'utilisation d'une s√©curit√© de type <em>Http</em> ou <em>Apikey</em>. Dans ces deux derniers cas, un service d'obtiention du jeton est automatiquement g√©n√©r√© sur le point de terminaison : "<strong><em>/token</em></strong>".</p>
<h3 id="modelisation_3">Mod√©lisation</h3>
<p>Dans le cadre de l'application "demo" l'exemple ici donn√© va √™tre la mod√©lisation d'une s√©curit√© de type Open Id Connect (s√©curit√© de tpe <em>Oauth2</em> la plus courante pour les applications importantes). La s√©curit√© se mod√©lise toujours au niveau du composant dans le diagramme de mod√©lisation SOA. Ceci s'effectue au niveau de l'onglet "<em>Security Schemes</em>" dans les propri√©t√©s du composant. </p>
<p>‚ùó Il est √† noter que, dans la version actuelle de <strong>Pacman</strong> il est pour l'instant impossible de mod√©liser plusieurs s√©curit√©s au niveau du composant. </p>
<div align="center">
<img alt="Gestion de la s√©curit√©" src="images/pcm-model-security-1.png"/>
</div>
<p>Une fois la premi√®re √©tape de saisie effectu√©e, effectuer une double-clique sur la ligne de d√©finition de la nouvelle s√©curit√© qui est apparue et dans la nouvelle fen√™tre, simplement renseigner l'URI pour le serveur d'authentification  (il est √† noter que dans le cadre d'une s√©curit√© de type OIDC, le flow est authomatiquement v√©rouill√© √† "<em>AUTHORIZATION CODE</em>"). Le nom de la s√©curit√© est, quant √† lui, totalement libre afin d'√™tre explicite pour les d√©veloppeurs.</p>
<div align="center">
<img alt="Gestion de la s√©curit√©" src="images/pcm-model-security-2.png" width="400"/>
</div>
<p>Enfin, il est possible de renseigner si besoin les "<em>Scopes</em>" n√©cessaires en effectant un double-clique sur le "<em>Flow</em>" et en renseignant pour chaque "<em>Scope</em>" les rubriques "<em>Name</em>" et "<em>Description</em>".</p>
<div align="center">
<img alt="Gestion de la s√©curit√©" src="images/pcm-model-security-3.png" width="800"/>
</div>
<p>Une fois le sch√©ma de s√©curit√© d√©fini, se positionner au niveau des diff√©rents services et ajouter la s√©curit√©, soit directement au niveau du service, soit plus sp√©cifiquement au niveau des diff√©rentes op√©rations qui ont √©t√© mod√©lis√©es (si par exemple une des op√©rations ne doit pas √™tre s√©curis√©e). Pour ce faire, se positionner sur l'onglet "<em>Security</em>" et ajouter la s√©curit√© d√©sir√©e.</p>
<div align="center">
<img alt="Gestion de la s√©curit√©" src="images/pcm-model-security-4.png"/>
</div>
<p>Une cl√© rouge (ou orange si c'est le service qui a √©t√© s√©curis√© dans sa globalit√©) doit alors apparaitre au niveau de chaque op√©ration afin de confirmer que d√©sormais, l'op√©ration est soumise √† validation d'un jeton de s√©curit√©.</p>
<p><img alt="Gestion de la s√©curit√©" src="images/pcm-model-security-5.png"/></p>
<p>Il est aussi possible d'ajouter si besoin des m√©tadonn√©es suppl√©mentaires de permission au niveau des diff√©rentes op√©rations afin de sp√©cifier un (ou des) r√¥le(s) pour donner acc√®s au service. Se positionner au niveau de l'op√©ration et au niveau de l'onglet "<em>Metadatas</em>" et s√©lectionner selon le besoin les m√©tadonn√©es "<strong><em>PERMISSION</em></strong>", "<strong><em>PERMISSION_OR</em></strong>" et "<strong><em>PERMISSION_AND</em></strong>"</p>
<div align="center">
<img alt="Gestion de la s√©curit√©" src="images/pcm-model-security-6.png" width="500"/>
</div>
<p>Pour ces annotations, le corps est important, il convient donc de supprimer la description de la m√©tadonn√©e qui est positionn√©e par d√©faut dans le corps et de la remplacer par le r√¥le d√©sir√© pour l'obtention de la permission d'acc√®s. Ici par exemple, il est n√©cessaire que l'utilisateur ait le r√¥le "<em>ADMIN</em>" ou "<em>READ</em>".</p>
<div align="center">
<img alt="Gestion de la s√©curit√©" src="images/pcm-model-security-7.png"/>
</div>
<h3 id="generation_3">G√©n√©ration</h3>
<p>La demande de g√©n√©ration est de type "SOA", toutes les informations concernant la s√©curisation des services REST sont donc analys√©s et g√©n√©r√©es au moment de la demande de g√©n√©ration pour la couche de service. Suite √† la g√©n√©ration, le nouveau code pour la classe de configuration de la s√©curit√© devient donc le suivant : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Bean</span>
<span class="kd">public</span><span class="w"> </span><span class="n">SecurityFilterChain</span><span class="w"> </span><span class="nf">tokenFilterChain</span><span class="p">(</span><span class="n">HttpSecurity</span><span class="w"> </span><span class="n">http</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="k">return</span><span class="w"> </span><span class="n">http</span><span class="p">.</span><span class="na">cors</span><span class="p">(</span><span class="n">Customizer</span><span class="p">.</span><span class="na">withDefaults</span><span class="p">()).</span><span class="na">csrf</span><span class="p">(</span><span class="n">csrf</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">csrf</span><span class="p">.</span><span class="na">disable</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="na">sessionManagement</span><span class="p">(</span><span class="n">session</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">sessionCreationPolicy</span><span class="p">(</span><span class="n">SessionCreationPolicy</span><span class="p">.</span><span class="na">STATELESS</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="na">authorizeHttpRequests</span><span class="p">(</span><span class="n">request</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Gestion de la s√©curit√© pour les apis de sant√©, sp√©cifications OpenAPI, etc...</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">request</span><span class="p">.</span><span class="na">requestMatchers</span><span class="p">(</span><span class="n">whiteListPaths</span><span class="p">).</span><span class="na">permitAll</span><span class="p">()</span>

<span class="w">    </span><span class="cm">/** Liste des uris non s√©curis√©es. */</span>

<span class="w">    </span><span class="cm">/** Liste des uris s√©curis√©es avec un r√¥le sp√©cifique. */</span>

<span class="w">    </span><span class="c1">// Start of user code f93dcfaeb3f3471dffb8f1981854aebe</span>
<span class="w">    </span><span class="c1">// End of user code</span>

<span class="w">    </span><span class="cm">/** Par d√©faut, tout le reste est s√©curis√©. */</span>
<span class="w">    </span><span class="p">.</span><span class="na">anyRequest</span><span class="p">().</span><span class="na">authenticated</span><span class="p">();</span>
<span class="p">})</span>
<span class="p">.</span><span class="na">oauth2ResourceServer</span><span class="p">(</span>
<span class="w">    </span><span class="n">oauth2</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">oauth2</span><span class="p">.</span><span class="na">bearerTokenResolver</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">DemoJwtTokenResolver</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="na">jwt</span><span class="p">(</span><span class="n">Customizer</span><span class="p">.</span><span class="na">withDefaults</span><span class="p">()))</span>
<span class="w">    </span><span class="p">.</span><span class="na">exceptionHandling</span><span class="p">(</span><span class="n">Customizer</span><span class="p">.</span><span class="na">withDefaults</span><span class="p">()).</span><span class="na">build</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>Ce nouveau code appelle quelques explications : </p>
<p>‚Ä¢ La ligne d'authorisation a √©t√© modifi√©e et prend maintenant une variable nomm√©e "<strong><em>whiteListPaths</em></strong>". cette variable est inject√©e un peu plus haut dans le code √† l'aide des lignes suivantes : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Value</span><span class="p">(</span><span class="s">"${security.whitelist.paths}"</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">whiteListPaths</span><span class="p">;</span>
</code></pre></div>
<p>Gr√¢ce √† cette injection, la variable va prendre automatiquement le contenu du param√©tre "<strong><em>security.whitelist.paths</em></strong>" pr√©sent dans le fichier de configuration de l'application "<strong><em>application.properties</em></strong>". Par rappel (et par d√©faut) la valeur de ce param√®tre est le suivant : </p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ----------------------------------------------------------------------------------------------</span>
<span class="c1"># LISTE DES URIS NON SECURISEES</span>
<span class="c1"># ----------------------------------------------------------------------------------------------</span>
<span class="c1"># Ne pas oublier de reporter les modifications issues des rubriques precedentes </span>
<span class="na">security.whitelist.paths</span><span class="o">=</span><span class="s">/swagger-ui/**,/api-docs/**,/actuator/**</span>
</code></pre></div>
<p>Ce qui permet donc d'√©viter de s√©curiser ces diff√©rentes ressources...</p>
<p>‚Ä¢ Pour toutes les URIs qui ne sont pas s√©curis√©es, une ligne par URI est ajout√©e sous la rubrique "Liste des uris non s√©curis√©es". </p>
<p>Il s'agit d'une ligne du type : </p>
<div class="codehilite"><pre><span></span><code><span class="cm">/** Liste des uris non s√©curis√©es. */</span>
<span class="p">.</span><span class="na">requestMatchers</span><span class="p">(</span><span class="s">"/v0/personnes/xxx"</span><span class="p">).</span><span class="na">permitAll</span><span class="p">()</span>
</code></pre></div>
<p>‚ùó Il est donc particuli√®rement important de bien r√©fl√©chir √† la hi√©rarchie de ses URIs afin d√©viter d'avoir des trous de s√©curit√© et d'ouvrir une URI qui serait en amont d'une URI qui, elle, est s√©curis√©e. </p>
<p>‚Ä¢ Si des m√©tadonn√©es de permission avaient √©t√© positionn√©es (comme l'option avait √©t√© vue pr√©cedemment au niveau de la mod√©lisation), sous la rubrique "Liste des uris s√©curis√©es avec un r√¥le sp√©cifique" des lignes suppl√©mentaires auraient √©t√© ajout√©es, ligne de type :  </p>
<div class="codehilite"><pre><span></span><code><span class="cm">/** Liste des uris s√©curis√©es avec un r√¥le sp√©cifique. */</span>
<span class="p">.</span><span class="na">requestMatchers</span><span class="p">(</span><span class="s">"/v0/personnes/{id}"</span><span class="p">).</span><span class="na">hasAnyRole</span><span class="p">(</span><span class="s">"ROLE_ADMIN"</span><span class="p">,</span><span class="w"> </span><span class="s">"ROLE_TOTO"</span><span class="p">)</span><span class="w">    </span>
</code></pre></div>
<p>‚Ä¢ Pour r√©cup√©rer le jeton JWT, un "Resolver" est cod√© au niveau de la classe de configuration de la s√©curit√© (afin de centraliser l'ensemble du code de s√©curit√© au niveau de cette classe). Cette m√©thode va par d√©faut, toujours rechercher le jeton au niveau de l'en-t√™te avec comme cl√© de propri√©t√© : "<strong><em>Authorization</em></strong>", ce qui est la norme. </p>
<p>En cela, cette m√©thode ne rajoute rien de plus √† l'impl√©mentation par d√©faut, sauf qu'au niveau de la mod√©lisation et dans le cadre des s√©curit√©s de type <em>Http</em> ou <em>ApiKey</em>, il est possible de choisir le mode de passage diff√©rent pour ce jeton. Cette m√©thode va donc, en fonction de la mod√©lisation, √©ventuellement ajouter une recherche au niveau de la query, des cookies, etc... (la recherche dans l'en-t√™te est toujours privil√©gi√©e).</p>
<p>Le code par d√©faut pour cette m√©thode est le suivant : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Bean</span>
<span class="kd">public</span><span class="w"> </span><span class="n">BearerTokenResolver</span><span class="w"> </span><span class="nf">jwtTokenResolver</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BearerTokenResolver</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nd">@Override</span>
<span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">resolve</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="cm">/** Recherche dans l'en-t√™te, le plus courant (toujours pr√©sent). */</span>
<span class="w">       </span><span class="n">String</span><span class="w"> </span><span class="n">authHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="s">"Authorization"</span><span class="p">);</span>
<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">authHeader</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">authHeader</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">"Bearer "</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">authHeader</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
<span class="w">       </span><span class="p">}</span>
<span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"> </span><span class="c1">// Aucun jeton trouv√©.</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span><span class="w"> </span>
<span class="p">}</span>
</code></pre></div>
<p>‚Ä¢ Afin de pouvoir d√©coder le jeton JWT, un d√©codeur est mis √† disposition de la configuration de s√©curit√©. Toutes les lignes pour cette m√©thode sont entre balises de type "<em>user code</em>" afin que le d√©veloppeur puisse ajouter, modifier, supprimer et surtout v√©rifier la pr√©sence de toutes les demandes d'informations attendues au niveau du jeton.  </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Bean</span>
<span class="kd">public</span><span class="w"> </span><span class="n">JwtDecoder</span><span class="w"> </span><span class="nf">jwtDecoder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Start of user code 7115a832499feae23171aafa8601602f</span>

<span class="w">    </span><span class="n">SecretKeySpec</span><span class="w"> </span><span class="n">secretKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SecretKeySpec</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">jwtKey</span><span class="p">.</span><span class="na">getBytes</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">jwtKey</span><span class="p">.</span><span class="na">getBytes</span><span class="p">().</span><span class="na">length</span><span class="p">,</span>
<span class="w">                </span><span class="s">"HmacSHA256"</span><span class="p">);</span>
<span class="w">    </span><span class="n">NimbusJwtDecoder</span><span class="w"> </span><span class="n">decoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NimbusJwtDecoder</span><span class="p">.</span><span class="na">withSecretKey</span><span class="p">(</span><span class="n">secretKey</span><span class="p">).</span><span class="na">macAlgorithm</span><span class="p">(</span><span class="n">MacAlgorithm</span><span class="p">.</span><span class="na">HS256</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>

<span class="w">    </span><span class="cm">/** Validation issuer. */</span>
<span class="w">    </span><span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span><span class="w"> </span><span class="n">withIssuer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JwtValidators</span><span class="p">.</span><span class="na">createDefaultWithIssuer</span><span class="p">(</span><span class="s">"http://votre-application"</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/** Validation subject. */</span>
<span class="w">    </span><span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span><span class="w"> </span><span class="n">withSubject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jwt</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">subject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jwt</span><span class="p">.</span><span class="na">getSubject</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">subject</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">subject</span><span class="p">.</span><span class="na">isBlank</span><span class="p">())</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">OAuth2TokenValidatorResult</span><span class="p">.</span><span class="na">success</span><span class="p">()</span>
<span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="n">OAuth2TokenValidatorResult</span><span class="p">.</span><span class="na">failure</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OAuth2Error</span><span class="p">(</span><span class="s">"jeton non valide"</span><span class="p">,</span><span class="w"> </span><span class="s">"Manque le sujet"</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="cm">/** Validation audience. */</span>
<span class="w">    </span><span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span><span class="w"> </span><span class="n">withAudience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jwt</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">audience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jwt</span><span class="p">.</span><span class="na">getAudience</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">audience</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">audience</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">"votre-audience"</span><span class="p">))</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">OAuth2TokenValidatorResult</span><span class="p">.</span><span class="na">success</span><span class="p">()</span>
<span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="n">OAuth2TokenValidatorResult</span>
<span class="w">                </span><span class="p">.</span><span class="na">failure</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OAuth2Error</span><span class="p">(</span><span class="s">"jeton non valide"</span><span class="p">,</span><span class="w"> </span><span class="s">"Audience invalide"</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span><span class="w"> </span><span class="n">validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DelegatingOAuth2TokenValidator</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">withIssuer</span><span class="p">,</span><span class="w"> </span><span class="n">withSubject</span><span class="p">,</span><span class="w"> </span><span class="n">withAudience</span><span class="p">);</span>

<span class="w">    </span><span class="n">decoder</span><span class="p">.</span><span class="na">setJwtValidator</span><span class="p">(</span><span class="n">validator</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// End of user code</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">decoder</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>‚Ä¢ Au niveau de la couche d'infrastructure, si les d√©veloppeurs veulent acc√©der aux diff√©rentes informations contenues dans le jeton, une classe utilitaire <strong><em>[nom de l'application]CurrentJwtTokenHelper</em></strong> est aussi disponible et appelable directement au niveau de n'importe quelle partie de code.</p>
<p>‚Ä¢ Quelle que soit le type de s√©curit√©, au niveau des applications g√©n√©r√©es par <strong>Pacman</strong>, cela se soldera toujours pas le d√©codage d'un jeton de type JWT. </p>
<p>Si la s√©curit√© est de type "<em>ApiKey</em>" ou "<em>Http</em>", quelques ajouts de code sont alors effectu√©s au niveau de la classe de gestion de la s√©curit√©, comme par exemple, la mise √† disposition de l'encodeur JWT qui va se baser sur une cl√© sym√©trique contenue dans le fichier "<strong><em>application.properties</em></strong>", la mise en place automatique d'une URI "<strong><em>/token</em></strong>" pour l'obtention du jeton, etc... </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Bean</span>
<span class="nd">@Order</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">SecurityFilterChain</span><span class="w"> </span><span class="nf">authFilterChain</span><span class="p">(</span><span class="n">HttpSecurity</span><span class="w"> </span><span class="n">http</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">http</span><span class="p">.</span><span class="na">cors</span><span class="p">(</span><span class="n">Customizer</span><span class="p">.</span><span class="na">withDefaults</span><span class="p">()).</span><span class="na">csrf</span><span class="p">(</span><span class="n">csrf</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">csrf</span><span class="p">.</span><span class="na">disable</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="na">sessionManagement</span><span class="p">(</span><span class="n">session</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">sessionCreationPolicy</span><span class="p">(</span><span class="n">SessionCreationPolicy</span><span class="p">.</span><span class="na">STATELESS</span><span class="p">))</span>
<span class="w">      </span><span class="p">.</span><span class="na">securityMatcher</span><span class="p">(</span><span class="s">"/token"</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="na">authorizeHttpRequests</span><span class="p">(</span><span class="n">auth</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">auth</span><span class="p">.</span><span class="na">anyRequest</span><span class="p">().</span><span class="na">authenticated</span><span class="p">();</span>
<span class="w">   </span><span class="p">})</span>
<span class="w">   </span><span class="p">.</span><span class="na">exceptionHandling</span><span class="p">(</span><span class="n">Customizer</span><span class="p">.</span><span class="na">withDefaults</span><span class="p">())</span>
<span class="w">   </span><span class="p">.</span><span class="na">httpBasic</span><span class="p">(</span><span class="n">basic</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">basic</span><span class="p">.</span><span class="na">authenticationEntryPoint</span><span class="p">(</span><span class="n">authEntryPoint</span><span class="p">))</span>
<span class="w">   </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>De m√™me une classe suppl√©mentaire de cr√©ation du jeton est g√©n√©r√©e au niveau du package <strong><em>[package-racine].app</em></strong>, il s'agit de la classe <strong><em>[nom de l'application]JwtTokenService</em></strong> qui va permettre de cr√©er le jeton JWT. Enfin un service <strong><em>[nom de l'application]JwtTokenControllerImpl</em></strong> est aussi automatiquement g√©n√©r√© au niveau du package <strong><em>[nom de l'application].app.adapters.controllers</em></strong>. </p>
<p>Ce service est le point d'entr√©e (toujours sous le point de terminaison "<strong><em>/token</em></strong>") pour obtenir ledit jeton, et ceci en √©change d'un couple de donn√©es d'identification, g√©n√©ralement un identifiant et un mot de passe. Le code du contr√¥leur est le suivant : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">"/token"</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DemoJwtTokenControllerImpl</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="cm">/** D√©codeur pour le jeton jwt. */</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">DemoJwtTokenService</span><span class="w"> </span><span class="n">jwtService</span><span class="p">;</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="nf">DemoJwtTokenControllerImpl</span><span class="p">(</span><span class="n">DemoJwtTokenService</span><span class="w"> </span><span class="n">jwtService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">jwtService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jwtService</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@PostMapping</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="nf">authenticate</span><span class="p">(</span><span class="n">Authentication</span><span class="w"> </span><span class="n">authentication</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">     </span><span class="c1">// Start of user code 29748a05013c1ae3bc50822d509ea36e</span>
<span class="w">     </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">jwtService</span><span class="p">.</span><span class="na">generateToken</span><span class="p">(</span><span class="n">authentication</span><span class="p">);</span>
<span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="na">body</span><span class="p">(</span><span class="n">token</span><span class="p">);</span>
<span class="w">     </span><span class="c1">// End of user code</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Le d√©veloppeur peut alors ajouter l'ensemble de son code personnalis√© afin de d√©coder les informations d'authentification (balises de type "<em>user code</em>") et fournir le jeton √† l'aide du service qui a √©t√© inject√©.</p>
<p>‚Ä¢ De mani√®re g√©n√©rale (et m√™me si aucune mod√©lisation de s√©curit√© n'a encore √©t√© effectu√©e), on constate (ce qui est aussi la r√©sultante des pr√©c√©dents points) la pr√©sence des lignes suivantes : </p>
<div class="codehilite"><pre><span></span><code><span class="p">.</span><span class="na">oauth2ResourceServer</span><span class="p">(</span><span class="n">oauth2</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">oauth2</span>
<span class="w">    </span><span class="p">.</span><span class="na">bearerTokenResolver</span><span class="p">(</span><span class="n">jwtTokenResolver</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">jwt</span><span class="p">(</span><span class="n">Customizer</span><span class="p">.</span><span class="na">withDefaults</span><span class="p">()))</span>
<span class="w">    </span><span class="p">.</span><span class="na">exceptionHandling</span><span class="p">(</span><span class="n">Customizer</span><span class="p">.</span><span class="na">withDefaults</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
</code></pre></div>
<p>Spring Boot n'a pas nativement de syst√®me de d√©codage des jetons JWT, il convient donc d'utiliser celui qui est fourni par les ressources pour la gestion <em>OAuth2</em>. C'est pourquoi <em>OAuth2</em> sera toujours pr√©sent au niveau de la classe de configuration de la s√©curit√©, m√™me si la s√©curit√© demand√©e est de type <em>Http</em> ou <em>ApiKey</em>.</p>
<h3 id="tests_2">Tests</h3>
<p>Il est alors possible d'effectuer de nouveaux test (avec Swagger UI par example) afin de v√©rifier que l'appel est d√©sormait s√©curis√© et que toute tentative d'acc√®s non authoris√© se soldera par un code de type 401 ou 403.</p>
<p>‚ùó Dans le cas de l'utilisation de l'interface Swagger UI, et d'une s√©curit√© de type Oauth2, il est important de comprendre que les points de terminaison doivent √™tre valides, ce qui signifie que le serveur d'authentification doit exister et √™tre en √©tat de fonctionnement. dans le cas contraire, le service ne sera pas consid√©r√© comme s√©curis√© et l'ic√¥ne avec le cadena ne sera pas affich√©e.</p>
<h2 id="generation-des-relations">üß© G√©n√©ration des relations</h2>
<p>Dans ce chapitre, est abord√© la gestion des relations dans l'outil de mod√©lisation, en pr√©sentant les diff√©rents types de relations support√©es (association simple, bidirectionnelle, r√©cursive, etc.) ainsi que leurs variantes cardinalitaires. Pour chaque type de relation, est d√©taill√© la mani√®re dont elle peut √™tre exprim√©e dans le mod√®le ainsi que le code g√©n√©r√© automatiquement par l‚Äôoutil, tant du point de vue des scripts SQL que de la configuration JPA. </p>
<p>L‚Äôobjectif est de fournir une vue claire et pratique des possibilit√©s offertes, tout en mettant en lumi√®re les impacts concrets de chaque choix de mod√©lisation sur le code qui est produit. </p>
<p>Ici deux entit√©s seront mod√©lis√©es, avec toujours pour noms respectifs, simplement A et B.</p>
<p>‚ùó Attention dans ce chapitre, √† ne pas confondre bidirectionnel au sens JPA et bidirectionnel au sens de la mod√©lisation. Ce n'est pas parceque le d√©veloppeur doit tirer une relation bidirectionnelle (appel√©e telle qu'elle au niveau de l'outil de mod√©lisation) que l'on d√©sire au niveau JPA attaquer la relation dans les deux sens (bidirectionnel au sens JPA). La n√©cessit√© du bidirectionnel au sens JPA sera √† √©tudier selon les √©ventuels futurs besoins au niveau des g√©n√©rateurs <strong>Pacman</strong>.</p>
<p>‚ùó Au niveau des scripts SQL, ne sont pour l'instant affich√©es que les cr√©ations de table afin de rapidement visualiser les diff√©rentes relations. Ne sont donc pas pr√©sent√©s les indexs et contraintes inh√©rentes √† la cr√©ation de ces relations.</p>
<h3 id="relation-101">Relation (1)/(0,1)</h3>
<p><img alt="Relations" src="images/pcm-model-relation-1.png"/></p>
<p>La seule diff√©rence selon que la cardinalit√© soit √† 1 ou √† (0,1) consiste en la pr√©sence de "<em>not null</em>" au niveau de la cl√© √©trang√®re pour l'entit√© A. La navigabilit√© √©tant dirig√©e vers l'entit√© B, c'est l'entit√© A qui r√©cup√®re la cl√© √©trang√®re.</p>
<p>Le code SQL g√©n√©r√© est donc le suivant : </p>
<div class="codehilite"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">A</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table A */</span>
<span class="w">  </span><span class="n">A_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">ATTRIBUTEA</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="cm">/* FK vers la table B */</span>
<span class="w">  </span><span class="n">B_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">A_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">A_ID</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">B</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table B */</span>
<span class="w">  </span><span class="n">B_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">ATTRIBUTEB</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">B_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">B_ID</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<p>Au niveau des classes Java, on retrouve une relation de type <strong><em>@ManyToOne</em></strong> au niveau de l'entit√© A (<strong>Pacman</strong> n'utilise pas les relations <strong><em>@OneToOne</em></strong>). M√™me si cela n‚Äôest pas exclusif dans le sens de la base de donn√©es et que cela n'est pas intuitif, du point de vue m√©tier, la cardinalit√© (0,1) peut cependant, √™tre exprim√©e avec <em>@ManyToOne</em>, c'est le choix qui a √©t√© effectu√© pour le g√©n√©rateur <strong>Pacman</strong>.</p>
<p>En effet, <em>@ManyToOne</em> est plus courant et mieux optimis√© dans les moteurs JPA/Hibernate. Il est charg√© plus efficacement, et les jointures SQL sont plus simples. Si √† terme la relation devait √©voluer vers (0,*), <em>@ManyToOne</em> s‚Äôadapte sans pour autant casser le sch√©ma. Par ailleurs, <em>@OneToOne</em> impose g√©n√©ralement une contrainte UNIQUE sur la colonne de jointure, ce qui peut poser des probl√®mes de performances si mal index√©, surtout sur de grandes tables.</p>
<p>Entit√© A : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@ManyToOne</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">)</span>
<span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"B_ID"</span><span class="p">,</span><span class="w"> </span><span class="n">referencedColumnName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"B_ID"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">BEntityImpl</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
</code></pre></div>
<h3 id="relation-01">Relation (0,*)/(1,*)</h3>
<p><img alt="Relations" src="images/pcm-model-relation-2.png"/></p>
<p>Ici, avec la navigabilit√© dirig√©e vers B, c'est l'entit√© B qui r√©cup√®re la cl√© √©trang√®re pour pointer sur l'entit√© A. La relations se traduit par un <strong><em>@OneToMany</em></strong> au niveau de l'entit√© A et un <strong><em>@ManyToOne</em></strong> au niveau de l'entit√© B. Par d√©faut, <em>@OneToMany</em> sans <em>mappedBy</em> cr√©e une relation unidirectionnelle avec une jointure explicite. Dans un mod√®le bidirectionnel, il est courant d‚Äôutiliser <em>mappedBy</em> dans A, et un <em>@ManyToOne</em> dans B. Cela permet √† JPA de comprendre que la relation est g√©r√©e par B (le c√¥t√© poss√©dant la cl√© √©trang√®re).</p>
<div class="codehilite"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">A</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table A */</span>
<span class="w">  </span><span class="n">A_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">ATTRIBUTEA</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">A_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">A_ID</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">B</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table B */</span>
<span class="w">  </span><span class="n">B_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">ATTRIBUTEB</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table A */</span>
<span class="w">  </span><span class="n">A_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">B_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">B_ID</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<p>Entit√© A : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@OneToMany</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">,</span><span class="w"> </span><span class="n">mappedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"a"</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">BEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">relation</span><span class="p">;</span>
</code></pre></div>
<p>Entit√© B : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@ManyToOne</span>
<span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"A_ID"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">AEntityImpl</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</code></pre></div>
<h3 id="relation-recursive-101">Relation r√©cursive (1)/(0,1)</h3>
<p><img alt="Relations" src="images/pcm-model-relation-3.png"/></p>
<p>Ici la relation r√©cursive est annot√©e <strong><em>@ManyToOne</em></strong>, de m√™me que pour une relation (1)(0,1) entre deux entit√©s. La seule diff√©rence est que la cl√© √©trang√®re prend le nom de la relation (avec toujours "<em>_ID</em>" comme suffixe).</p>
<div class="codehilite"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">A</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table A */</span>
<span class="w">  </span><span class="n">A_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">ATTRIBUTEA</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="cm">/* FK vers la table A */</span>
<span class="w">  </span><span class="n">RELATIONA_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">A_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">A_ID</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<p>Entit√© A : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@ManyToOne</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">)</span>
<span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"RELATIONA_ID"</span><span class="p">,</span><span class="w"> </span><span class="n">referencedColumnName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"A_ID"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">AEntityImpl</span><span class="w"> </span><span class="n">relationA</span><span class="p">;</span>
</code></pre></div>
<h3 id="relation-recursive-01">Relation r√©cursive (0,*)/(1,*)</h3>
<p>Comme pour les relations bidirectionnelles, une table de liaison est automatiquement cr√©√©e, cette table prend pour nom la concat√©nation du nom de la table et du nom de la relation. Chaque nom est s√©par√© par un underscore. Bien noter cependant que le nom de l'attribut au niveau de la classe est bien le nom de la relation.</p>
<p><img alt="Relations" src="images/pcm-model-relation-4.png"/></p>
<div class="codehilite"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">A_RELATIONA</span>
<span class="p">(</span>
<span class="w">  </span><span class="n">A_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">A_RECURSIVE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">A_RELATIONA_PK2_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">A_ID</span><span class="p">,</span><span class="w"> </span><span class="n">A_RECURSIVE_ID</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<p>Entit√© A : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@ManyToMany</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">,</span><span class="w"> </span><span class="n">targetEntity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AEntityImpl</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@JoinTable</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"A_RELATIONA"</span><span class="p">,</span><span class="w"> </span><span class="n">joinColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"A_ID"</span><span class="p">),</span><span class="w"> </span><span class="n">inverseJoinColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"A_RECURSIVE_ID"</span><span class="p">))</span>
<span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">relationA</span><span class="p">;</span>
</code></pre></div>
<h3 id="relation-bidirectionnelle-01">Relation bidirectionnelle (0,*)/(1,*)</h3>
<p>‚ùó Il est impossible avec <strong>Pacman</strong> d'avoir des relations bidirectionnelles avec la navigabilit√© dans les deux sens, il est donc n√©cessaire apr√®s avoir tir√© la relation bidirectionnelle entre deux entit√©s, de supprimer une des deux navigabilit√©s.</p>
<p>Cette relation utilise l'annotation <strong><em>@ManyToMany</em></strong> soit au niveau de l'entit√© A, soit au niveau de l'entit√© B, selon la navigabilit√© qui a √©t√© initialement mod√©lis√©e. Ici la navigabilit√© est point√©e sur B, c'est donc l'entit√© A qui prend la relation. Par ailleurs, une table de liaison est automatiquement g√©n√©r√©e avec la concat√©nation du nom de la table et celui de la relation (d√©pend de la navigabilit√©). Les deux noms sont s√©par√©s par un underscore. Bien noter par contre que le nom de l'attribut au niveau de l'entit√© est celui de la relation (d√©pend aussi du sens de la navigabilit√©).</p>
<p><img alt="Relations" src="images/pcm-model-relation-5.png"/></p>
<div class="codehilite"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">A_RELATIONB</span>
<span class="p">(</span>
<span class="w">  </span><span class="n">A_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">B_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">A_RELATIONB_PK2_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">A_ID</span><span class="p">,</span><span class="w"> </span><span class="n">B_ID</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<p>Entit√© A : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@ManyToMany</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">,</span><span class="w"> </span><span class="n">targetEntity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BEntityImpl</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@JoinTable</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"A_RELATIONB"</span><span class="p">,</span><span class="w"> </span><span class="n">joinColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"A_ID"</span><span class="p">),</span><span class="w"> </span><span class="n">inverseJoinColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"B_ID"</span><span class="p">))</span>
<span class="kd">private</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">BEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">relationB</span><span class="p">;</span>
</code></pre></div>
<p>‚ùó On peut aussi noter que dans le cadre des relations bidirectionnelles <em>@ManyToMany</em>, <strong>Pacman</strong> utilise des <em>Set</em> et non des <em>List</em> pour le stockage des collections. Cela est pr√©conis√© avec JPA car un <em>Set</em> garantit l‚Äôunicit√© des √©l√©ments, ce qui est coh√©rent avec le mod√®le relationnel sous-jacent (en base de donn√©es, une table de jointure pour une relation <em>@ManyToMany</em> n‚Äôa pas de doublons.). En outre, JPA (notamment avec Hibernate) traite les <em>Set</em> de mani√®re plus simple et plus performante. Enfin le <em>Set</em> n‚Äôa pas d‚Äôordre, il correspond naturellement √† ce que fait la base de donn√©es (pas d‚Äôordre garanti dans une table de jointure).</p>
<h2 id="documentation-open-api">üîß Documentation Open Api</h2>
<hr/>
<p>Lors de la g√©n√©ration de la couche de services, outre l'ensemble du code √† √©x√©cuter, la documentation Open Api est aussi cr√©√©e automatiquement afin de pouvoir g√©n√©rer un fichier Swagger et √™tre lue  (notamment) par l'interface "Swagger-ui". Cette documentation (par le biais d'annotations), est g√©n√©r√©e √† trois niveaux :</p>
<ul>
<li>La documentation g√©n√©rale concernant l'ensemble des informations relatives √† l'application.</li>
<li>La documentation sp√©cifique pour l'appel de chaque service (les diff√©rentes op√©rations mod√©lis√©es).</li>
<li>La documentation pour chaque objet s√©rialis√©, en entr√©e ou en sortie.</li>
</ul>
<p>‚ùó Noter que lorsque l'on parle ici de service, il s'agit de service au sens global du terme, un service est mod√©lis√© avec des op√©rations, mais par rapport au client, une seule op√©ration est aussi un service qui est fourni par le fournisseur de service, √† ce niveau tout est service...</p>
<h3 id="documentation-generale">Documentation g√©n√©rale</h3>
<p>Toutes les informations concernant la documentation g√©n√©rale de l'application (ainsi que celles concernant la s√©curit√©) est √† mod√©liser au niveau du composant dans le fichier de mod√©lisation <strong><em>[nom de l'application].soa</em></strong>, principalement au niveau de l'onglet "<strong><em>Exposition</em></strong>".</p>
<div align="center">
<img alt="Open Api" src="images/pcm-swagger-soa-1.png"/>
</div>
<p>‚ùó Il n'est possible de mod√©liser qu'un seul composant au niveau du diagramme soa, toute vell√©it√© pour mod√©liser plusieurs composant se soldera par une alerte au niveau de la validation du diagramme.</p>
<p>Une fois la demande de g√©n√©ration de la couche de services effectu√©e, toutes les informations globales sont centralis√©es au niveau de la classe (au niveau de l'infrastructure) <strong><em>[package racine].app.[nomde l'application]OpenApiConfig</em></strong>. Cette classe n'est pas destin√©e √† avoir un corps, seules les annotations de type Open Api sont pr√©sentes. </p>
<p>Par exemple : </p>
<div class="codehilite"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * Configuration de la documentation OpenAPI pour ce composant.</span>
<span class="cm"> * </span>
<span class="cm"> * Cette classe d√©clare la configuration g√©n√©rale de l'API pour Springdoc. Elle</span>
<span class="cm"> * permet de d√©finir les m√©tadonn√©es principales de la documentation Swagger,</span>
<span class="cm"> * telles que le titre, la version, la description, les informations de contact,</span>
<span class="cm"> * les termes de licence et d'utilisation.</span>
<span class="cm"> *</span>
<span class="cm"> * Aucun code m√©tier ou logique n‚Äôest pr√©sent ici, uniquement des d√©clarations</span>
<span class="cm"> * d‚Äôannotations √† but documentaire.</span>
<span class="cm"> *</span>
<span class="cm"> * @see io.swagger.v3.oas.annotations.OpenAPIDefinition</span>
<span class="cm"> * @see io.swagger.v3.oas.annotations.info.Info</span>
<span class="cm"> * @see org.springframework.context.annotation.Configuration</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="nd">@OpenAPIDefinition</span><span class="p">(</span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Info</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"referentiel"</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"3.0.3"</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Cette API permet de g√©rer les personnes."</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">termsOfService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"https://demo.com/terms/"</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Contact</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Support Technique"</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"support@demo.com"</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"https://demo.com/support"</span><span class="p">),</span><span class="w"> </span>
<span class="w">    </span><span class="n">license</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@License</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Apache 2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"http://www.apache.org/licenses/LICENSE-2.0.html"</span><span class="p">)))</span>
<span class="kd">class</span> <span class="nc">DemoOpenApiConfig</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="documentation-des-services">Documentation des services</h3>
<p>La documentation pour les diff√©rents services est, quant √† elle, accroch√©e √† chaque op√©ration qui a √©t√© mod√©lis√©e, il n'y a pas de champ suppl√©mentaire sp√©cifique √† saisir, toutes les informations sont r√©cup√©r√©es √† partir de la mod√©lisation n√©cessaire (si correctement remplie) pour faire fonctionner un service (avec ses op√©rations). Cette documentation (toujours sous forme d'annotations) ressemble √† ceci (on reprend le pr√©c√©dent exemple de code pour l'op√©ration  "<em>chercheParId(...)</em>") mais cette fois avec la documentation Open Api :</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/{id}"</span><span class="p">,</span><span class="w"> </span><span class="n">produces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"application/json;charset=utf8"</span><span class="p">)</span>
<span class="nd">@Operation</span><span class="p">(</span><span class="n">operationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"chercheParId"</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Cette m√©thode retourne la personne qui correspond √† l'identifiant pass√© en param√®tre."</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">"GestionPersonnes"</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nd">@Parameter</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"id"</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"L'identifiant pour la personne."</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ParameterIn</span><span class="p">.</span><span class="na">PATH</span><span class="p">,</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span><span class="p">)</span><span class="w"> </span><span class="p">})</span>
<span class="nd">@ApiResponses</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@ApiResponse</span><span class="p">(</span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"200"</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"OK"</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Content</span><span class="p">(</span><span class="n">mediaType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"application/json"</span><span class="p">,</span><span class="w"> </span>
<span class="w">                           </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PersonneXtoImpl</span><span class="p">.</span><span class="na">class</span><span class="p">))),</span>
<span class="w">    </span><span class="nd">@ApiResponse</span><span class="p">(</span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"404"</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"La personne n'a pas √©t√© trouv√©e."</span><span class="p">)</span><span class="w"> </span><span class="p">})</span>
<span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">PersonneXtoImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">chercheParId</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"id"</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">identifiant</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="p">....</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="documentation-pour-les-objets-serialises">Documentation pour les objets s√©rialis√©s</h3>
<p>Au niveau des objets de type "XTO", seule l'annotation "<strong><em>@Schema</em></strong>" permet de rajouter une description pour chaque attribut (et au niveau de l'objet) : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Schema</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Une personne pour l'application de d√©mo"</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PersonneXtoImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="cm">/** Le nom de la personne. Cette donn√©e est obligatoire. */</span>
<span class="c1">// Start of user code aee37c30f5d091a495526f636a3527bb</span>
<span class="nd">@JsonProperty</span><span class="p">(</span><span class="s">"nom"</span><span class="p">)</span>
<span class="c1">// End of user code</span>
<span class="nd">@Schema</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Le nom de la personne. Cette donn√©e est obligatoire."</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">;</span>
</code></pre></div>
<h3 id="affichage-et-tests">Affichage et tests</h3>
<p>Il est ainsi possible (apr√®s lancement de l'application), d'utiliser l'outil open source Swagger UI qui permet d'afficher et de tester visuellement une API d√©crite avec Swagger/OpenAPI, ceci, directement dans un navigateur web. Swagger UI va lire le fichier de sp√©cification et le transformer en une interface web qui permet :</p>
<ul>
<li>De naviguer dans les endpoints de l‚ÄôAPI (group√©s par ressource).</li>
<li>De voir les param√®tres, le corps des requ√™tes ainsi que les r√©ponses attendues.</li>
<li>D‚Äôex√©cuter des requ√™tes HTTP directement via les formulaires interactifs.</li>
</ul>
<div align="center">
<img alt="Open Api" src="images/pcm-swagger-soa-2.png"/>
</div>
<h2 id="generation-avancee">üìê G√©n√©ration avanc√©e</h2>
<hr/>
<h3 id="mise-a-disposition-de-lentity-manager">Mise √† disposition de l'entity manager</h3>
<p>Au niveau de la couche de persistance, pour l'acc√®s √† la base de donn√©es, il est pr√©conis√© de passer par la notion de "Repository". Spring Data fournit en effet  une abstraction tr√®s pratique pour la plupart des op√©rations CRUD et les requ√™tes simples ou mod√©r√©ment complexes. Cependant, il existe certains cas o√π il est pr√©f√©rable (ou n√©cessaire) d'utiliser directement l'EntityManager. Par exemple :</p>
<ul>
<li>Effectuer plusieurs op√©rations dans une seule transaction, avec un contr√¥le fin sur le flush, clear, ou l'ordre des op√©rations.</li>
<li>Utiliser des requ√™tes dynamiques ou avec crit√®res tr√®s complexes.</li>
<li>Optimiser les performances (batchs, fetch tuning, etc.).</li>
<li>Faire des utilisations avanc√©es de Lock, Hints, FlushMode, etc...</li>
<li>Contourner la gestion automatique par Spring Data.</li>
</ul>
<p>Il est donc possible de demander express√©ment au g√©n√©rateur d'effectuer l'injection de l'Entity Manager. Comme, au niveau de la mod√©lisation, il s'agit d'une information qui concerne la persistance, il est n√©cessaire d'agir au niveau de l'entit√© en positionnant la m√©tadonn√©e "<strong><em>ENTITY_MANAGER</em></strong>". Cette m√©tadonn√©e n'a pas besoin de corps, il est donc possible de supprimer ou non le commentaire associ√© lors de l'affectation de la m√©tadonn√©e.</p>
<div align="center">
<img alt="Entity manager" src="images/pcm-model-adv-entity-1.png" width="500"/>
</div>
<p>Visualisation de la m√©tadonn√©e associ√©e √† l'entit√© "<em>Personne</em>" :</p>
<p><img alt="Entity manager" src="images/pcm-model-adv-entity-2.png"/></p>
<p>‚ùó Le r√©sultat ne sera visible par contre, qu'au moment de la demande de g√©n√©ration de la couche de service puisque la classe d'impl√©mentation de la persistance <em>[nom du service]JpaProvider</em> est g√©n√©r√©e uniquement lors de la cr√©ation de la couche SOA. Par contre, tout service qui detecte l'utilisation de cette entit√© (en entr√©e ou en sortie) va automatiquement b√©n√©ficier d'un param√®tre suppl√©mentaire au niveau de son constructeur pour injecter et mettre √† disposition du d√©veloppeur l'Entity Manager. Ainsi, dans le cadre de l'application "demo", le code de la classe "<em>GestionPersonnesJpaProviderImpl</em>" devient : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@AdapterService</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GestionPersonnesJpaProviderImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">GestionPersonnesProvider</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Start of user code 2129864a49adcaa3a812f92be467bf4e</span>
<span class="w">    </span><span class="c1">// End of user code</span>

<span class="w">    </span><span class="cm">/** Le gestionnaire de persistance de jpa. */</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">EntityManager</span><span class="w"> </span><span class="n">entityManager</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/** Gestionnaires de persistance disponibles. */</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">PersonneRepository</span><span class="w"> </span><span class="n">personneRepository</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Constructeur.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">GestionPersonnesJpaProviderImpl</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">PersonneRepository</span><span class="w"> </span><span class="n">personneRepository</span><span class="p">,</span><span class="w"> </span><span class="n">EntityManager</span><span class="w"> </span><span class="n">entityManager</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">personneRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">personneRepository</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">entityManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entityManager</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Start of user code 2e3e969fd52202f4f94ef7456a361c15</span>
<span class="w">        </span><span class="c1">// End of user code</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">etc</span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="utilisation-du-lazy-loading">Utilisation du lazy loading</h3>
<p>Par d√©faut, dans les relations, toute entit√© r√©f√©renc√©e est automatiquement charg√©e en "EAGER", ainsi, si une entit√© r√©f√©rence une autre entit√© qui r√©f√©rence elle m√™me une autre entit√©, etc... toute la grappe va √™tre charg√©e et renvoy√©e au niveau du service REST. Il existe cependant de nombreux cas ou le chargement paresseux peut √™tre pr√©f√©rable. <strong>Pacman</strong> met donc √† disposition une m√©tadonn√©e qui peut s'appliquer aux r√©f√©rences entre les entit√©s. </p>
<p>Si on rajoute une entit√© au niveau de la mod√©lisation d√©j√† existante (par exemple, une personne habite √† une ou plusieurs adresses), le diagramme devient le suivant : </p>
<p><img alt="Entity manager" src="images/pcm-model-adv-entity-3.png"/></p>
<p>Il est alors possible de s√©lectionner le lien qui effectue la r√©f√©rence et de lui affecter la m√©tadonn√©e "<strong><em>FETCH_LAZY</em></strong>". </p>
<div align="center">
<img alt="Entity manager" src="images/pcm-model-adv-entity-4.png" width="500"/>
</div>
<p>‚ùó Cela n'est pas montr√© au niveau de ce document, mais il est √©vident que la modification a aussi √©t√© report√©e au niveau de la couche SOA avec rajout du DTO et de la relation associ√©e.</p>
<p>Cette m√©tadonn√©e n'a pas besoin de corps, il est donc possible pour le d√©veloppeur de supprimer ou non la description pour la m√©tadonn√©e.</p>
<p><img alt="Entity manager" src="images/pcm-model-adv-entity-5.png"/></p>
<p>Au niveau du code g√©n√©r√©, un nouvel attribut pour la classe "<em>PersonneEntityImpl</em>" est cr√©√©, avec le code suivant : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@OneToMany</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">LAZY</span><span class="p">,</span><span class="w"> </span><span class="n">mappedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"personne"</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AdresseEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">habite</span><span class="p">;</span>
</code></pre></div>
<p>Sans annotation le code aurait simplement √©t√© du type (par d√©faut) : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@OneToMany</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">,</span><span class="w"> </span><span class="n">mappedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"personne"</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AdresseEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">habite</span><span class="p">;</span>
</code></pre></div>
<p>Par contre une diff√©rence majeure est visible au niveau des mappeurs d'infrastructure, au niveau de la recopie de la liste, le mappeur v√©rifie auparavant si l'entit√© r√©f√©renc√©e est toujours pilotable par JPA. Cela √©vite de demander le chargement lors de la recopie des objets, recopie encore une fois inh√©rente √† l'architecture hexagonale. </p>
<p>Le code devient alors le suivant : </p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">PersonneDtoImpl</span><span class="w"> </span><span class="nf">toDto</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">PersonneEntityImpl</span><span class="w"> </span><span class="n">entity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">entity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">PersonneDtoImpl</span><span class="w"> </span><span class="n">dto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PersonneDtoImpl</span><span class="p">();</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">dto</span><span class="p">.</span><span class="na">setPersonne_id</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getPersonne_id</span><span class="p">());</span>
<span class="w">        </span><span class="n">dto</span><span class="p">.</span><span class="na">setNom</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getNom</span><span class="p">());</span>
<span class="w">        </span><span class="n">dto</span><span class="p">.</span><span class="na">setPrenom</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getPrenom</span><span class="p">());</span>
<span class="w">        </span><span class="n">dto</span><span class="p">.</span><span class="na">setAge</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getAge</span><span class="p">());</span>
<span class="w">        </span><span class="n">dto</span><span class="p">.</span><span class="na">setHabite</span><span class="p">(</span><span class="n">Hibernate</span><span class="p">.</span><span class="na">isInitialized</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getHabite</span><span class="p">())</span>
<span class="w">                </span><span class="o">?</span><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="na">getHabite</span><span class="p">().</span><span class="na">stream</span><span class="p">().</span><span class="na">map</span><span class="p">(</span><span class="n">o</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">AdresseMapper</span><span class="p">.</span><span class="na">toDto</span><span class="p">(</span><span class="n">o</span><span class="p">)).</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">())</span>
<span class="w">                </span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">AdresseDtoImpl</span><span class="o">&gt;</span><span class="p">());</span>
<span class="w">        </span><span class="n">dto</span><span class="p">.</span><span class="na">setXtopsup</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getXtopsup</span><span class="p">());</span>
<span class="w">        </span><span class="n">dto</span><span class="p">.</span><span class="na">setXdmaj</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getXdmaj</span><span class="p">());</span>
<span class="w">        </span><span class="n">dto</span><span class="p">.</span><span class="na">setXuuid</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getXuuid</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// Start of user code 856cc109a8cab6eb0a3676613acc6f8f</span>
<span class="w">        </span><span class="c1">// End of user code</span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DemoMapperException</span><span class="p">(</span><span class="s">"Impossible de mapper la classe : PersonneDtoImpl"</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">dto</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="utilisation-de-cascade">Utilisation de cascade</h3>
<p>En JPA (Java Persistence API), l'attribut cascade est utilis√© pour propager automatiquement certaines op√©rations (comme persist, merge, remove, etc.) d'une entit√© parent vers ses entit√©s enfants associ√©es via une relation (@OneToMany, @ManyToOne, @OneToOne, @ManyToMany).</p>
<p>Pour rappel, les diff√©rentes valeurs possibles de propagation pour cet attribut sont :</p>
<table>
<thead>
<tr>
<th><strong>Valeur</strong></th>
<th><strong>Description</strong></th>
<th><strong>Op√©rations couvertes</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CascadeType.ALL</code></td>
<td>Applique toutes les op√©rations de persistance</td>
<td><code>PERSIST</code>, <code>MERGE</code>, <code>REMOVE</code>, <code>REFRESH</code>, <code>DETACH</code></td>
</tr>
<tr>
<td><code>CascadeType.PERSIST</code></td>
<td>Propage l'op√©ration de persistance</td>
<td><code>PERSIST</code></td>
</tr>
<tr>
<td><code>CascadeType.MERGE</code></td>
<td>Propage l'op√©ration de fusion</td>
<td><code>MERGE</code></td>
</tr>
<tr>
<td><code>CascadeType.REMOVE</code></td>
<td>Propage l'op√©ration de suppression</td>
<td><code>REMOVE</code></td>
</tr>
<tr>
<td><code>CascadeType.REFRESH</code></td>
<td>Propage l'op√©ration de rafra√Æchissement</td>
<td><code>REFRESH</code></td>
</tr>
<tr>
<td><code>CascadeType.DETACH</code></td>
<td>Propage l'op√©ration de d√©tachement</td>
<td><code>DETACH</code></td>
</tr>
</tbody>
</table>
<p>Si besoin, il est possible d'ajouter le param√®tre "<em>Cascade</em>" dans le cadre du chargement des relations. Se positionner sur la relation et rajouter une m√©tadonn√©e "<strong><em>CASCADE</em></strong>". Ici le corps de la m√©tadonn√©e est important, supprimer la description et renseigner le type de "<em>Cascade</em>" d√©sir√©.</p>
<div align="center">
<img alt="Cascade" src="images/pcm-model-adv-entity-7.png" width="500"/>
</div>
<p>Une fois la demande de g√©n√©ration de la couche de persistance effectu√©e, le code des relations devient alors : </p>
<ul>
<li>Pour <strong><em>PersonneEntityImpl</em></strong> : </li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nd">@OneToMany</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">,</span><span class="w"> </span><span class="n">cascade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CascadeType</span><span class="p">.</span><span class="na">PERSIST</span><span class="p">,</span><span class="w"> </span><span class="n">mappedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"personne"</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AdresseEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">habite</span><span class="p">;</span>
</code></pre></div>
<ul>
<li>Pour <strong><em>AdresseEntityImpl</em></strong> : </li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nd">@ManyToOne</span><span class="p">()</span>
<span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"PERSONNE_ID"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">PersonneEntityImpl</span><span class="w"> </span><span class="n">personne</span><span class="p">;</span>
</code></pre></div>
<p>Il est bien entendu possible au niveau de la m√©tadonn√©e, de rentrer plusieurs valeurs s√©par√©es par une virgule, par exemple "<em>PERSIST, MERGE, DETACH</em>" donnera √† la g√©n√©ration : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@OneToMany</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">,</span><span class="w"> </span><span class="n">cascade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">CascadeType</span><span class="p">.</span><span class="na">PERSIST</span><span class="p">,</span><span class="w"> </span><span class="n">CascadeType</span><span class="p">.</span><span class="na">MERGE</span><span class="p">,</span><span class="w"> </span><span class="n">CascadeType</span><span class="p">.</span><span class="na">DETACH</span><span class="p">},</span><span class="w"> </span><span class="n">mappedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"personne"</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AdresseEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">habite</span><span class="p">;</span>
</code></pre></div>
<h3 id="utilisation-des-transactions">Utilisation des transactions</h3>
<p>Il est possible de positionner des transactions soit directement au niveau de l'infrastructure pour la couche de persistance, soit au niveau plus g√©n√©ral de la couche m√©tier. Dans le cas de la couche d'infrastructure, des balises de type "<em>user code</em>" permettent de positionner l'annotation "<strong><em>@Transactionnal</em></strong>" de JPA au niveau de la classe <strong><em>[nom du service]JpaProviderImpl</em></strong> : </p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Start of user code 488633ccb55331e8e15a31ef0159efbc</span>
<span class="nd">@Transactional</span>
<span class="c1">// End of user code</span>
<span class="kd">private</span><span class="w"> </span><span class="n">PersonneEntityImpl</span><span class="w"> </span><span class="nf">sauvegarde_invoke</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">PersonneDtoImpl</span><span class="w"> </span><span class="n">personne</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="p">....)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="c1">// Start of user code 0d7aeafd27536987cf0cf491de14ca07</span>
<span class="w">   </span><span class="n">op√©ration</span><span class="w"> </span><span class="mi">1</span>
<span class="w">   </span><span class="n">op√©ration</span><span class="w"> </span><span class="mi">2</span>
<span class="w">   </span><span class="n">etc</span><span class="p">...</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="p">}</span>
</code></pre></div>
<p>Comme pr√©cit√©, il est aussi possible de poser l'annotation plus haut au niveau de la couche m√©tier sur la classe <strong><em>[nom du service]ServiceImpl</em></strong>, soit directement sur la totalit√© de la classe : </p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Start of user code 4a236703b9d5317c198dc3e3d6db3fc6</span>
<span class="nd">@Transactionnal</span>
<span class="c1">// End of user code</span>
<span class="nd">@DomainService</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GestionPersonnesServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">GestionPersonnesService</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">etc</span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<p>soit au niveau d'une ou plusieurs op√©rations : </p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Start of user code ea90c22bb8cac819a5c286613bb46870</span>
<span class="nd">@Transactionnal</span>
<span class="c1">// End of user code</span>
<span class="nd">@Override</span>
<span class="nd">@Requirement</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">RequirementsEnum</span><span class="p">.</span><span class="na">REQ_PERSONNE_AGE</span><span class="w"> </span><span class="p">})</span>
<span class="kd">public</span><span class="w"> </span><span class="n">PersonneDtoImpl</span><span class="w"> </span><span class="nf">sauvegarde</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">PersonneDtoImpl</span><span class="w"> </span><span class="n">personne</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="p">...)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">etc</span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<p>‚ùó Dans le dernier cas, il s'agit ici de l'annotation <strong><em>@Transactionnal</em></strong> du domaine (<strong>[package racine].domain.Transactionnal</strong><em>) et non celle de JPA, puisque le domaine est totalement ind√©pendant de toute technologie. Pour rappel, cette annotation est g√©r√©e automatiquement gr√¢ce aux classes situ√©es dans le package d'infrastructure : </em><strong>[package racine].infra</strong>*</p>
<h3 id="utilisation-de-lheritage">Utilisation de l'h√©ritage</h3>
<p>‚ùó La mod√©lisation de l'h√©ritage est encore en version Alpha, elle sera pleinement support√©e tr√®s prochainement.</p>
<p>Avec <strong>Pacman</strong> l'h√©ritage entre entit√©s est support√© afin de favoriser la r√©utilisation et la structuration du mod√®le m√©tier. Cependant, de mani√®re g√©n√©rale, il est conseill√© de ne pas en abuser car il ne faut pas oublier que l‚Äôimpl√©mentation de l‚Äôh√©ritage en JPA peut introduire une complexit√© technique non n√©gligeable et avoir un impact n√©gatif sur les performances.</p>
<p>En effet, si JPA propose par d√©faut plusieurs strat√©gies de mapping pour l‚Äôh√©ritage, aucune des strat√©gies disponibles (SINGLE_TABLE, JOINED, TABLE_PER_CLASS) n‚Äôest pleinement satisfaisante. Chacune pr√©sente des compromis importants en termes de performances, de lisibilit√© des donn√©es ou de complexit√© des requ√™tes SQL g√©n√©r√©es. Par exemple, la strat√©gie SINGLE_TABLE centralise toutes les entit√©s dans une seule table avec des colonnes parfois inutilis√©es, ce qui peut alourdir la structure et la maintenance. La strat√©gie JOINED, plus propre sur le plan du mod√®le relationnel, implique de multiples jointures co√ªteuses √† l'ex√©cution. Quant √† TABLE_PER_CLASS, elle rend les requ√™tes globales complexes voire inefficaces. </p>
<p>Ces limitations font que l‚Äôh√©ritage JPA doit √™tre abord√© avec prudence. Il est donc recommand√© de l'utiliser avec parcimonie et uniquement lorsqu‚Äôil apporte une r√©elle valeur m√©tier, afin de garantir un code g√©n√©r√© plus simple, plus lisible et plus efficace √† l'ex√©cution.</p>
<p>Cela dit,  <strong>Pacman</strong> permet de pallier pour majeure partie √† ces limitations car il g√©n√®re sa propre impl√©mentation de l'h√©ritage.  </p>
<p>Les r√®gles sont les suivantes : </p>
<ul>
<li>Tous les attributs d√©finis dans les entit√©s parentes sont automatiquement repris dans les sous-entit√©s.</li>
<li>Toutes les relations d√©finies dans les entit√©s parentes sont automatiquement reprises dans les sous-entit√©s. </li>
<li>Ceci implique la cr√©ation d'une table de liaison par sous-entit√© lors de relations bidirectionnelles de type (0,*) ou (1,*).</li>
<li>Ceci implique la multiplication des identifiants pour les cl√©s √©trang√®res dans le cas des relations non-bidirectionnelles de type (0,*) ou (1,*).</li>
</ul>
<p>Quant utiliser l'h√©ritage avec <strong>Pacman</strong> et sous quelle forme ?</p>
<ul>
<li>‚úÖ pleinement support√©, aucun impact de performance.</li>
<li>‚ö†Ô∏è support√© mais en version alpha pour l'instant.Ô∏è</li>
<li>üõ†Ô∏èÔ∏èÔ∏è en cours d'impl√©mentation, non finalis√© sur l'ensemble des couches.</li>
</ul>
<p>‚úÖ Factoriser un ensemble d'attributs communs √† plusieurs entit√©s. Ici il ne faut pas confondre avec la notion de champs automatiques vue pr√©c√©dement qui elle, applique des attributs mais sur la totalit√© des entit√©s mod√©lis√©es. Avec l'h√©ritage il est ainsi possible d'avoir un contr√¥le plus fin sur les attributs communs. </p>
<p>‚ö†Ô∏è  Ajouter des relations de type (0,1) entre les entit√©s h√©rit√©es.</p>
<p>üõ†Ô∏èÔ∏èÔ∏èÔ∏èÔ∏èÔ∏è Ajouter des relations de type (0,*) entre les entit√©s h√©rit√©es.</p>
<p>üõ†Ô∏èÔ∏èÔ∏èÔ∏èÔ∏èÔ∏è Ajouter des relations bidirectionnelles de type (0,*) entre les entit√©s h√©rit√©es.</p>
<p>A titre indicatif, voici un exemple de mod√©lisation avec h√©ritage qui regroupe l'ensemble des possibilit√©s disponibles (au niveau des diff√©rentes relations) par <strong>Pacman</strong>.</p>
<div align="center">
<img alt="Mod√©lisation h√©ritage" src="images/pcm-model-heritage-1.png"/>
</div>
<p>Et le code SQL g√©n√©r√© (ne sont pas pr√©sent√©es pour l'instant les couches Java au niveau entit√©s et objets m√©tier) : </p>
<div class="codehilite"><pre><span></span><code><span class="cm">/******************************************************************/</span>
<span class="cm">/* Base de donnees:      h2                                       */</span>
<span class="cm">/* Application:          demo                                     */</span>
<span class="cm">/* Date de creation:     02/06/2025 12:59:43                      */</span>
<span class="cm">/******************************************************************/</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* Sequences                                                      */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">CAMION_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">MOTO_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">FOURGONNETTE_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">CITADINE_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">BERLINE_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">COULEUR_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">REMORQUE_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">GARAGE_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">CONDUCTEURPRINCIPAL_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">TRAJET_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">PROPRIETAIRE_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">PASSAGER_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : CAMION                                                 */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CAMION</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table CAMION */</span>
<span class="w">  </span><span class="n">CAMION_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TYPECAMION</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">CHARGEUTILE</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">IMMATRICULATIONVEHICULE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">MARQUEVEHICULE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TYPECARBURANT</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table CONDUCTEURPRINCIPAL */</span>
<span class="w">  </span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table GARAGE */</span>
<span class="w">  </span><span class="n">GARAGE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table PROPRIETAIRE */</span>
<span class="w">  </span><span class="n">PROPRIETAIRE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="cm">/* FK vers la table REMORQUE */</span>
<span class="w">  </span><span class="n">REMORQUE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table CAMION */</span>
<span class="w">  </span><span class="n">APOURVEHICULEDEREMPLACEMENT_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">CAMION_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">CAMION_ID</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">CAMION_IDX1_1</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">CAMION</span><span class="p">(</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">CAMION_IDX1_2</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">CAMION</span><span class="p">(</span><span class="n">GARAGE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">CAMION_IDX1_3</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">CAMION</span><span class="p">(</span><span class="n">PROPRIETAIRE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">CAMION_IDX1_4</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">CAMION</span><span class="p">(</span><span class="n">REMORQUE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">CAMION_IDX1_5</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">CAMION</span><span class="p">(</span><span class="n">APOURVEHICULEDEREMPLACEMENT_ID</span><span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">CAMION</span><span class="p">.</span><span class="n">CAMION_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table CAMION'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">CAMION</span><span class="p">.</span><span class="n">CHARGEUTILE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'commentaire attribut utilitaire'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">CAMION</span><span class="p">.</span><span class="n">IMMATRICULATIONVEHICULE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'commentaire attribute vehicule'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : MOTO                                                   */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">MOTO</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table MOTO */</span>
<span class="w">  </span><span class="n">MOTO_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TYPETRANSMISSION</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">NBPLACES</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TYPEMOTORISATION</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">IMMATRICULATIONVEHICULE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">MARQUEVEHICULE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TYPECARBURANT</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table CONDUCTEURPRINCIPAL */</span>
<span class="w">  </span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table GARAGE */</span>
<span class="w">  </span><span class="n">GARAGE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table PROPRIETAIRE */</span>
<span class="w">  </span><span class="n">PROPRIETAIRE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="cm">/* FK vers la table MOTO */</span>
<span class="w">  </span><span class="n">APOURVEHICULEDEREMPLACEMENT_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">MOTO_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">MOTO_ID</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">MOTO_IDX1_1</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">MOTO</span><span class="p">(</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">MOTO_IDX1_2</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">MOTO</span><span class="p">(</span><span class="n">GARAGE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">MOTO_IDX1_3</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">MOTO</span><span class="p">(</span><span class="n">PROPRIETAIRE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">MOTO_IDX1_4</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">MOTO</span><span class="p">(</span><span class="n">APOURVEHICULEDEREMPLACEMENT_ID</span><span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">MOTO</span><span class="p">.</span><span class="n">MOTO_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table MOTO'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">MOTO</span><span class="p">.</span><span class="n">NBPLACES</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'commentaire pesonnel'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">MOTO</span><span class="p">.</span><span class="n">IMMATRICULATIONVEHICULE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'commentaire attribute vehicule'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : FOURGONNETTE                                           */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">FOURGONNETTE</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table FOURGONNETTE */</span>
<span class="w">  </span><span class="n">FOURGONNETTE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">HAUTEURSEUILCHARGEMENT</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">CHARGEUTILE</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">IMMATRICULATIONVEHICULE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">MARQUEVEHICULE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TYPECARBURANT</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table CONDUCTEURPRINCIPAL */</span>
<span class="w">  </span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table GARAGE */</span>
<span class="w">  </span><span class="n">GARAGE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table PROPRIETAIRE */</span>
<span class="w">  </span><span class="n">PROPRIETAIRE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="cm">/* FK vers la table FOURGONNETTE */</span>
<span class="w">  </span><span class="n">APOURVEHICULEDEREMPLACEMENT_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">FOURGONNETTE_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">FOURGONNETTE_ID</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">FOURGONNETTE_IDX1_1</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">FOURGONNETTE</span><span class="p">(</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">FOURGONNETTE_IDX1_2</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">FOURGONNETTE</span><span class="p">(</span><span class="n">GARAGE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">FOURGONNETTE_IDX1_3</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">FOURGONNETTE</span><span class="p">(</span><span class="n">PROPRIETAIRE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">FOURGONNETTE_IDX1_4</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">FOURGONNETTE</span><span class="p">(</span><span class="n">APOURVEHICULEDEREMPLACEMENT_ID</span><span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">FOURGONNETTE</span><span class="p">.</span><span class="n">FOURGONNETTE_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table FOURGONNETTE'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">FOURGONNETTE</span><span class="p">.</span><span class="n">CHARGEUTILE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'commentaire attribut utilitaire'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">FOURGONNETTE</span><span class="p">.</span><span class="n">IMMATRICULATIONVEHICULE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'commentaire attribute vehicule'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : CITADINE                                               */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CITADINE</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table CITADINE */</span>
<span class="w">  </span><span class="n">CITADINE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">ATTRIBUTECITADINE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">NORMEANTIPOLLUTION</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">NBPLACES</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TYPEMOTORISATION</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">IMMATRICULATIONVEHICULE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">MARQUEVEHICULE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TYPECARBURANT</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table CONDUCTEURPRINCIPAL */</span>
<span class="w">  </span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table GARAGE */</span>
<span class="w">  </span><span class="n">GARAGE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table PROPRIETAIRE */</span>
<span class="w">  </span><span class="n">PROPRIETAIRE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="cm">/* FK vers la table CITADINE */</span>
<span class="w">  </span><span class="n">APOURVEHICULEDEREMPLACEMENT_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">CITADINE_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">CITADINE_ID</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">CITADINE_IDX1_1</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">CITADINE</span><span class="p">(</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">CITADINE_IDX1_2</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">CITADINE</span><span class="p">(</span><span class="n">GARAGE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">CITADINE_IDX1_3</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">CITADINE</span><span class="p">(</span><span class="n">PROPRIETAIRE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">CITADINE_IDX1_4</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">CITADINE</span><span class="p">(</span><span class="n">APOURVEHICULEDEREMPLACEMENT_ID</span><span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">CITADINE</span><span class="p">.</span><span class="n">CITADINE_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table CITADINE'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">CITADINE</span><span class="p">.</span><span class="n">NORMEANTIPOLLUTION</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'commentaire attribut voiture'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">CITADINE</span><span class="p">.</span><span class="n">NBPLACES</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'commentaire pesonnel'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">CITADINE</span><span class="p">.</span><span class="n">IMMATRICULATIONVEHICULE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'commentaire attribute vehicule'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : BERLINE                                                */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">BERLINE</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table BERLINE */</span>
<span class="w">  </span><span class="n">BERLINE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">ATTRIBUTBERLINE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">NORMEANTIPOLLUTION</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">NBPLACES</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TYPEMOTORISATION</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">IMMATRICULATIONVEHICULE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">MARQUEVEHICULE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TYPECARBURANT</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table CONDUCTEURPRINCIPAL */</span>
<span class="w">  </span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table GARAGE */</span>
<span class="w">  </span><span class="n">GARAGE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table PROPRIETAIRE */</span>
<span class="w">  </span><span class="n">PROPRIETAIRE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="cm">/* FK vers la table BERLINE */</span>
<span class="w">  </span><span class="n">APOURVEHICULEDEREMPLACEMENT_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">BERLINE_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">BERLINE_ID</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">BERLINE_IDX1_1</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">BERLINE</span><span class="p">(</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">BERLINE_IDX1_2</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">BERLINE</span><span class="p">(</span><span class="n">GARAGE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">BERLINE_IDX1_3</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">BERLINE</span><span class="p">(</span><span class="n">PROPRIETAIRE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">BERLINE_IDX1_4</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">BERLINE</span><span class="p">(</span><span class="n">APOURVEHICULEDEREMPLACEMENT_ID</span><span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">BERLINE</span><span class="p">.</span><span class="n">BERLINE_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table BERLINE'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">BERLINE</span><span class="p">.</span><span class="n">NORMEANTIPOLLUTION</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'commentaire attribut voiture'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">BERLINE</span><span class="p">.</span><span class="n">NBPLACES</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'commentaire pesonnel'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">BERLINE</span><span class="p">.</span><span class="n">IMMATRICULATIONVEHICULE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'commentaire attribute vehicule'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : COULEUR                                                */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">COULEUR</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table COULEUR */</span>
<span class="w">  </span><span class="n">COULEUR_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TYPECOULEUR</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="cm">/* FK vers la table CAMION */</span>
<span class="w">  </span><span class="n">CAMION_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table MOTO */</span>
<span class="w">  </span><span class="n">MOTO_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table FOURGONNETTE */</span>
<span class="w">  </span><span class="n">FOURGONNETTE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table CITADINE */</span>
<span class="w">  </span><span class="n">CITADINE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table BERLINE */</span>
<span class="w">  </span><span class="n">BERLINE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">COULEUR_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">COULEUR_ID</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">COULEUR_IDX1_1</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">COULEUR</span><span class="p">(</span><span class="n">CAMION_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">COULEUR_IDX1_2</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">COULEUR</span><span class="p">(</span><span class="n">MOTO_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">COULEUR_IDX1_3</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">COULEUR</span><span class="p">(</span><span class="n">FOURGONNETTE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">COULEUR_IDX1_4</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">COULEUR</span><span class="p">(</span><span class="n">CITADINE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">COULEUR_IDX1_5</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">COULEUR</span><span class="p">(</span><span class="n">BERLINE_ID</span><span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">COULEUR</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'commentaire couleur'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">COULEUR</span><span class="p">.</span><span class="n">COULEUR_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table COULEUR'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : REMORQUE                                               */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">REMORQUE</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table REMORQUE */</span>
<span class="w">  </span><span class="n">REMORQUE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TYPEREMORQUE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">REMORQUE_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">REMORQUE_ID</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">REMORQUE</span><span class="p">.</span><span class="n">REMORQUE_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table REMORQUE'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : GARAGE                                                 */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">GARAGE</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table GARAGE */</span>
<span class="w">  </span><span class="n">GARAGE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">NOMGARAGE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">GARAGE_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">GARAGE_ID</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">GARAGE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'commentaire usine'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">GARAGE</span><span class="p">.</span><span class="n">GARAGE_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table GARAGE'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : CONDUCTEURPRINCIPAL                                    */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CONDUCTEURPRINCIPAL</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table CONDUCTEURPRINCIPAL */</span>
<span class="w">  </span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">NOMCONDUCTEURPRINCIPAL</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">CONDUCTEURPRINCIPAL_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">CONDUCTEURPRINCIPAL</span><span class="p">.</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table CONDUCTEURPRINCIPAL'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : TRAJET                                                 */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">TRAJET</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table TRAJET */</span>
<span class="w">  </span><span class="n">TRAJET_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TYPETRAJET</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">TRAJET_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">TRAJET_ID</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">TRAJET</span><span class="p">.</span><span class="n">TRAJET_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table TRAJET'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : PROPRIETAIRE                                           */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PROPRIETAIRE</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table PROPRIETAIRE */</span>
<span class="w">  </span><span class="n">PROPRIETAIRE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">NOMPROPRIETAIRE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">PROPRIETAIRE_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PROPRIETAIRE_ID</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">PROPRIETAIRE</span><span class="p">.</span><span class="n">PROPRIETAIRE_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table PROPRIETAIRE'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : PASSAGER                                               */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PASSAGER</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table PASSAGER */</span>
<span class="w">  </span><span class="n">PASSAGER_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">NOMPASSAGER</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="cm">/* FK vers la table CAMION */</span>
<span class="w">  </span><span class="n">CAMION_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table MOTO */</span>
<span class="w">  </span><span class="n">MOTO_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table FOURGONNETTE */</span>
<span class="w">  </span><span class="n">FOURGONNETTE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table CITADINE */</span>
<span class="w">  </span><span class="n">CITADINE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="cm">/* FK vers la table BERLINE */</span>
<span class="w">  </span><span class="n">BERLINE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">PASSAGER_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PASSAGER_ID</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">PASSAGER_IDX1_1</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">PASSAGER</span><span class="p">(</span><span class="n">CAMION_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">PASSAGER_IDX1_2</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">PASSAGER</span><span class="p">(</span><span class="n">MOTO_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">PASSAGER_IDX1_3</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">PASSAGER</span><span class="p">(</span><span class="n">FOURGONNETTE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">PASSAGER_IDX1_4</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">PASSAGER</span><span class="p">(</span><span class="n">CITADINE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">PASSAGER_IDX1_5</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">PASSAGER</span><span class="p">(</span><span class="n">BERLINE_ID</span><span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">PASSAGER</span><span class="p">.</span><span class="n">PASSAGER_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table PASSAGER'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE DE LIAISON : CAMION_EFFECTUETRAJET                       */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CAMION_EFFECTUETRAJET</span>
<span class="p">(</span>
<span class="w">  </span><span class="n">CAMION_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TRAJET_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">CAMION_EFFECTUETRAJET_PK2_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">CAMION_ID</span><span class="p">,</span><span class="w"> </span><span class="n">TRAJET_ID</span><span class="p">)</span>
<span class="p">);</span>


<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE DE LIAISON : MOTO_EFFECTUETRAJET                         */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">MOTO_EFFECTUETRAJET</span>
<span class="p">(</span>
<span class="w">  </span><span class="n">MOTO_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TRAJET_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">MOTO_EFFECTUETRAJET_PK2_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">MOTO_ID</span><span class="p">,</span><span class="w"> </span><span class="n">TRAJET_ID</span><span class="p">)</span>
<span class="p">);</span>


<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE DE LIAISON : FOURGONNETTE_EFFECTUETRAJET                 */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">FOURGONNETTE_EFFECTUETRAJET</span>
<span class="p">(</span>
<span class="w">  </span><span class="n">FOURGONNETTE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TRAJET_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">FOURGONNETTE_EFFECTUETRAJET_PK2_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">FOURGONNETTE_ID</span><span class="p">,</span><span class="w"> </span><span class="n">TRAJET_ID</span><span class="p">)</span>
<span class="p">);</span>


<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE DE LIAISON : CITADINE_EFFECTUETRAJET                     */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CITADINE_EFFECTUETRAJET</span>
<span class="p">(</span>
<span class="w">  </span><span class="n">CITADINE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TRAJET_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">CITADINE_EFFECTUETRAJET_PK2_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">CITADINE_ID</span><span class="p">,</span><span class="w"> </span><span class="n">TRAJET_ID</span><span class="p">)</span>
<span class="p">);</span>


<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE DE LIAISON : BERLINE_EFFECTUETRAJET                      */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">BERLINE_EFFECTUETRAJET</span>
<span class="p">(</span>
<span class="w">  </span><span class="n">BERLINE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">TRAJET_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">BERLINE_EFFECTUETRAJET_PK2_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">BERLINE_ID</span><span class="p">,</span><span class="w"> </span><span class="n">TRAJET_ID</span><span class="p">)</span>
<span class="p">);</span>


<span class="cm">/******************************************************************/</span>
<span class="cm">/* Contraintes                                                    */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CAMION</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">CAMION_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">CONDUCTEURPRINCIPAL</span><span class="w"> </span><span class="p">(</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CAMION</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">CAMION_FK1_2</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">GARAGE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">GARAGE</span><span class="w"> </span><span class="p">(</span><span class="n">GARAGE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CAMION</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">CAMION_FK1_3</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PROPRIETAIRE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">PROPRIETAIRE</span><span class="w"> </span><span class="p">(</span><span class="n">PROPRIETAIRE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CAMION</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">CAMION_FK1_4</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">REMORQUE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">REMORQUE</span><span class="w"> </span><span class="p">(</span><span class="n">REMORQUE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CAMION</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">CAMION_FK1_5</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">APOURVEHICULEDEREMPLACEMENT_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">CAMION</span><span class="w"> </span><span class="p">(</span><span class="n">CAMION_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">MOTO</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">MOTO_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">CONDUCTEURPRINCIPAL</span><span class="w"> </span><span class="p">(</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">MOTO</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">MOTO_FK1_2</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">GARAGE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">GARAGE</span><span class="w"> </span><span class="p">(</span><span class="n">GARAGE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">MOTO</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">MOTO_FK1_3</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PROPRIETAIRE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">PROPRIETAIRE</span><span class="w"> </span><span class="p">(</span><span class="n">PROPRIETAIRE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">MOTO</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">MOTO_FK1_4</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">APOURVEHICULEDEREMPLACEMENT_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">MOTO</span><span class="w"> </span><span class="p">(</span><span class="n">MOTO_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">FOURGONNETTE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">FOURGONNETTE_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">CONDUCTEURPRINCIPAL</span><span class="w"> </span><span class="p">(</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">FOURGONNETTE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">FOURGONNETTE_FK1_2</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">GARAGE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">GARAGE</span><span class="w"> </span><span class="p">(</span><span class="n">GARAGE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">FOURGONNETTE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">FOURGONNETTE_FK1_3</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PROPRIETAIRE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">PROPRIETAIRE</span><span class="w"> </span><span class="p">(</span><span class="n">PROPRIETAIRE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">FOURGONNETTE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">FOURGONNETTE_FK1_4</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">APOURVEHICULEDEREMPLACEMENT_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">FOURGONNETTE</span><span class="w"> </span><span class="p">(</span><span class="n">FOURGONNETTE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CITADINE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">CITADINE_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">CONDUCTEURPRINCIPAL</span><span class="w"> </span><span class="p">(</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CITADINE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">CITADINE_FK1_2</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">GARAGE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">GARAGE</span><span class="w"> </span><span class="p">(</span><span class="n">GARAGE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CITADINE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">CITADINE_FK1_3</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PROPRIETAIRE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">PROPRIETAIRE</span><span class="w"> </span><span class="p">(</span><span class="n">PROPRIETAIRE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CITADINE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">CITADINE_FK1_4</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">APOURVEHICULEDEREMPLACEMENT_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">CITADINE</span><span class="w"> </span><span class="p">(</span><span class="n">CITADINE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">BERLINE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">BERLINE_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">CONDUCTEURPRINCIPAL</span><span class="w"> </span><span class="p">(</span><span class="n">CONDUCTEURPRINCIPAL_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">BERLINE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">BERLINE_FK1_2</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">GARAGE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">GARAGE</span><span class="w"> </span><span class="p">(</span><span class="n">GARAGE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">BERLINE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">BERLINE_FK1_3</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PROPRIETAIRE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">PROPRIETAIRE</span><span class="w"> </span><span class="p">(</span><span class="n">PROPRIETAIRE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">BERLINE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">BERLINE_FK1_4</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">APOURVEHICULEDEREMPLACEMENT_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">BERLINE</span><span class="w"> </span><span class="p">(</span><span class="n">BERLINE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">COULEUR</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">COULEUR_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">CAMION_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">CAMION</span><span class="w"> </span><span class="p">(</span><span class="n">CAMION_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">COULEUR</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">COULEUR_FK1_2</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">MOTO_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">MOTO</span><span class="w"> </span><span class="p">(</span><span class="n">MOTO_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">COULEUR</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">COULEUR_FK1_3</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">FOURGONNETTE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">FOURGONNETTE</span><span class="w"> </span><span class="p">(</span><span class="n">FOURGONNETTE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">COULEUR</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">COULEUR_FK1_4</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">CITADINE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">CITADINE</span><span class="w"> </span><span class="p">(</span><span class="n">CITADINE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">COULEUR</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">COULEUR_FK1_5</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">BERLINE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">BERLINE</span><span class="w"> </span><span class="p">(</span><span class="n">BERLINE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PASSAGER</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">PASSAGER_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">CAMION_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">CAMION</span><span class="w"> </span><span class="p">(</span><span class="n">CAMION_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PASSAGER</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">PASSAGER_FK1_2</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">MOTO_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">MOTO</span><span class="w"> </span><span class="p">(</span><span class="n">MOTO_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PASSAGER</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">PASSAGER_FK1_3</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">FOURGONNETTE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">FOURGONNETTE</span><span class="w"> </span><span class="p">(</span><span class="n">FOURGONNETTE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PASSAGER</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">PASSAGER_FK1_4</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">CITADINE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">CITADINE</span><span class="w"> </span><span class="p">(</span><span class="n">CITADINE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PASSAGER</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">PASSAGER_FK1_5</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">BERLINE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">BERLINE</span><span class="w"> </span><span class="p">(</span><span class="n">BERLINE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CAMION_EFFECTUETRAJET</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">CAMION_EFFECTUETRAJET_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">CAMION_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">CAMION</span><span class="w"> </span><span class="p">(</span><span class="n">CAMION_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CAMION_EFFECTUETRAJET</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">CAMION_EFFECTUETRAJET_FK1_2</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">TRAJET_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">TRAJET</span><span class="w"> </span><span class="p">(</span><span class="n">TRAJET_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">MOTO_EFFECTUETRAJET</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">MOTO_EFFECTUETRAJET_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">MOTO_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">MOTO</span><span class="w"> </span><span class="p">(</span><span class="n">MOTO_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">MOTO_EFFECTUETRAJET</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">MOTO_EFFECTUETRAJET_FK1_2</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">TRAJET_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">TRAJET</span><span class="w"> </span><span class="p">(</span><span class="n">TRAJET_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">FOURGONNETTE_EFFECTUETRAJET</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">FOURGONNETTE_EFFECTUETRAJET_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">FOURGONNETTE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">FOURGONNETTE</span><span class="w"> </span><span class="p">(</span><span class="n">FOURGONNETTE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">FOURGONNETTE_EFFECTUETRAJET</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">FOURGONNETTE_EFFECTUETRAJET_FK1_2</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">TRAJET_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">TRAJET</span><span class="w"> </span><span class="p">(</span><span class="n">TRAJET_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CITADINE_EFFECTUETRAJET</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">CITADINE_EFFECTUETRAJET_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">CITADINE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">CITADINE</span><span class="w"> </span><span class="p">(</span><span class="n">CITADINE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CITADINE_EFFECTUETRAJET</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">CITADINE_EFFECTUETRAJET_FK1_2</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">TRAJET_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">TRAJET</span><span class="w"> </span><span class="p">(</span><span class="n">TRAJET_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">BERLINE_EFFECTUETRAJET</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">BERLINE_EFFECTUETRAJET_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">BERLINE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">BERLINE</span><span class="w"> </span><span class="p">(</span><span class="n">BERLINE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">BERLINE_EFFECTUETRAJET</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">BERLINE_EFFECTUETRAJET_FK1_2</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">TRAJET_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">TRAJET</span><span class="w"> </span><span class="p">(</span><span class="n">TRAJET_ID</span><span class="p">);</span>
</code></pre></div>
<p>Si on effectue une mod√©lisation inverse avec un outil de mod√©lisation √† partir du script SQL g√©n√©r√© par  <strong>Pacman</strong> , on peut mieux visualiser les diff√©rentes relations qui seront effectivement appliqu√©es au niveau de la base de donn√©es (les impacts majeurs ont √©t√© entour√©s avec un cadre de couleur rouge) : </p>
<div align="center">
<img alt="Mod√©lisation h√©ritage" src="images/pcm-model-heritage-2.png"/>
</div>
<h3 id="renvoie-dentites-partielles">Renvoie d'entit√©s partielles</h3>
<p>Pour une entit√©, il est souvent souhaitable de ne pas vouloir renvoyer la totalit√© des informations au niveau du client. </p>
<p>Les solutions les plus simples consistent : </p>
<ul>
<li>
<p>A positionner une annotation JSON de type "<strong><em>@JsonIgnore</em></strong>" au niveau de l'objet s√©rialis√© :  cette solution est rapidement limit√©e car elle s'applique √† l'ensemble des services qui vont utiliser cette entit√©.  Or selon  le service, il peut en exister qui demandent √† renvoyer la totalit√© des informations, d'autres qui ne vont renvoyer qu'une partie, etc...</p>
</li>
<li>
<p>A cr√©er autant d'entit√©s que d√©sir√©es, avec plus ou moins d'informations selon les services. Ce solution n'est pas vraiment envisageable car chaque entit√© est mapp√©e sur une table de la base de donn√©es, il y aurait donc plusieurs tables pour le stockage de l'information, ce qui semble incoh√©rent au niveau de la persistance. </p>
</li>
</ul>
<p>La probl√©matique principale est qu'au niveau de la mod√©lisation, si un objet m√©tier (DTO) est reli√©e √† une entit√©, il n'est pas possible de supprimer des attributs au niveau de l'objet m√©tier (il est seulement possible d'en rajouter). </p>
<ul>
<li>A utiliser le lazy loading sur le chargement des r√©f√©rences afin de renvoyer seulement une partie de la grappe d'objet. Cette solution est viable, mais son seul inconv√©nient est que cela n'√©vite pas l'affichage d'objets nulls au niveau de l'objet s√©rialis√© (XTO). Le client est ainsi averti que  potentiellement, cette information est disponible, ce que ne d√©sire pas for√ß√©ment les d√©veloppeurs. Par ailleur si la donn√©e que l'on ne souhaite pas renvoyer ne se situe pas au niveau d'une relation mais directement au niveau de l'entit√©, cette solution ne permet pas de r√©soudre la probl√©matique.</li>
</ul>
<p>üëç Le plus simple et le plus efficace consiste √† utiliser l'annotation "<strong><em>@JsonView</em></strong>" en collaboration avec la d√©finition de "vues" qui sont essentiellement des groupes de propri√©t√©s que l'on souhaite s√©rialiser pour des cas d‚Äôutilisation sp√©cifiques. </p>
<p>Ici, la mod√©lisation n'apporte aucune valeur ajout√©e et c'est au d√©veloppeur d'√©crire le code n√©cessaire pour la d√©finition et la prise en compte de ses vues. Les diff√©rentes √©tapes sont les suivantes : </p>
<p>1 - Renseigner la classe <strong><em>[nom de l'application]JsonViews</em></strong> situ√©e au niveau du package racine pour la couche application <strong><em>[package racine].app</em></strong> avec la d√©finition des diff√©rentes vues souhait√©es, par exemple : </p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DemoJsonViews</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Vue publique</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Publique</span><span class="w"> </span><span class="p">{}</span><span class="w">   </span>
<span class="w">  </span><span class="c1">// Vue pour les audits</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Audit</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span>
<span class="w">  </span><span class="c1">// Vue de synth√®se, par exemple pour une liste ou un aper√ßu rapide. H√©rite de la vue d'audit</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Sommaire</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Audit</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span>
<span class="p">}</span>
</code></pre></div>
<p>2 - Au niveau de l'objet XTO de s√©rialisation utiliser les balises de type "<em>user code</em>" afin de positionner sur chaque attribut l'annotation d√©sir√©e avec le nom de la vue, par exemple : </p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Start of user code aee37c30f5d091a495526f636a3527bb</span>
<span class="nd">@JsonProperty</span><span class="p">(</span><span class="s">"nom"</span><span class="p">)</span>
<span class="n">JsonView</span><span class="p">(</span><span class="n">DemoJsonViews</span><span class="p">.</span><span class="na">Audit</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="c1">// End of user code</span>
<span class="nd">@Schema</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"DESCRIPTION A IMPLEMENTER"</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">;</span>

<span class="c1">// Start of user code 209f4226d4ca0e91af3607674c06a9bc</span>
<span class="nd">@JsonProperty</span><span class="p">(</span><span class="s">"prenom"</span><span class="p">)</span>
<span class="nd">@JsonView</span><span class="p">(</span><span class="n">DemoJsonViews</span><span class="p">.</span><span class="na">Publique</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="c1">// End of user code</span>
<span class="nd">@Schema</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"DESCRIPTION A IMPLEMENTER"</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">prenom</span><span class="p">;</span>
</code></pre></div>
<p>3 - Au niveau du service REST, utiliser les balises de type "<em>user code</em>" pour sp√©cifier les diff√©rentes vues g√©r√©es par le service.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Start of user code 2374b233496f92fc018299b4aa11a061</span>
<span class="nd">@JsonView</span><span class="p">(</span><span class="n">DemoJsonViews</span><span class="p">.</span><span class="na">Audit</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="c1">// End of user code</span>
<span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/{id}"</span><span class="p">,</span><span class="w"> </span><span class="n">produces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"application/json;charset=utf8"</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">PersonneXtoImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">rechercheParId</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@PathVariable</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"id"</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">identifiant</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">etc</span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="domaine-et-persistances">Domaine et persistances.</h3>
<p>Ce paragraphe sera compl√©t√© prochainement.</p>
<h3 id="mise-en-place-dun-service-pagine">Mise en place d'un service pagin√©</h3>
<p>Les √©tapes pour mettre en place un service pagin√©, sont les suivantes : </p>
<ul>
<li>D√©finir un param√®tre pour le num√©ro de la page demand√©e.</li>
<li>D√©finir un param√®tre pour le nombre d'enregistrements √† renvoyer par page.</li>
<li>Cocher la case "Paged" au niveau des propri√©t√©s pour l'op√©ration</li>
</ul>
<p>L'op√©ration est alors marqu√©e comme "pagin√©e" et une petit ic√¥ne apparait en bas √† droite de cette derni√®re. </p>
<p><img alt="Pagination" src="images/pcm-model-adv-pagination-9.png"/></p>
<p>Au niveau de l'onlet "<strong><em>Exposition</em></strong>" pour le param√®tre qui v√©hicule le num√©ro de page demand√©, il est n√©cessaire de lui d√©finir son mode de passage :</p>
<div align="center">
<img alt="Pagination" src="images/pcm-model-adv-pagination-10.png"/>
</div>
<p>Faire de m√™me pour le param√®tre qui v√©hicule le nombre d'enregistrements demand√©s par page : </p>
<div align="center">
<img alt="Pagination" src="images/pcm-model-adv-pagination-11.png"/>
</div>
<p>Enfin, attribuer les deux param√®tres √† la notion de pagination en saisissant la rubrique "<strong><em>Pagination</em></strong>" au niveau de l'onglet "<strong><em>Operation</em></strong>" : </p>
<div align="center">
<img alt="Pagination" src="images/pcm-model-adv-pagination-12.png"/>
</div>
<p>‚ùó Selon la "norme" en vigueur, il est conseill√© de nommer les param√®tres "<strong><em>page</em></strong>" et "<strong><em>size</em></strong>". Il est possible avec la mod√©lisation d'appeler diff√©rement les param√®tres (en interne) et de laisser "<strong><em>page</em></strong>" et "<strong><em>size</em></strong>" uniquement au niveau du param√®tre de passage, par exemple : </p>
<div align="center">
<img alt="Pagination" src="images/pcm-model-adv-pagination-14.png"/>
</div>
<p>Une fois la demande de g√©n√©ration de la couche de service effectu√©e, le code est alors le suivant pour le service REST : </p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">PersonneXtoImpl</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">retourneTous</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"page"</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">page</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"size"</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">BodyBuilder</span><span class="w"> </span><span class="n">responseBuilder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Start of user code 1f82841b68b9a27af5cfcf572412847c</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">sortBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// End of user code</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">responseBuilder</span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">gestionPersonnes</span><span class="p">.</span><span class="na">retourneTous</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">sortBy</span><span class="p">).</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">o</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">PersonneMapper</span><span class="p">.</span><span class="na">toXto</span><span class="p">(</span><span class="n">o</span><span class="p">)).</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">()));</span>
<span class="p">}</span>
</code></pre></div>
<p>On peut remarquer la pr√©sence d'un param√®tre "<strong><em>sortBy</em></strong>" qui est automatiquement ajout√© et transf√©r√© au niveau de couches inf√©rieures. Ce param√®tre est initialis√© entre balises de type "<em>user code</em>" ce qui permet au d√©veloppeur de d√©finir ses crit√®res de tri pour la r√©ponse (le nom de la colonne).</p>
<p><strong>Le code du service m√©tier au niveau du domaine</strong> : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">PersonneDtoImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">retourneTous</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">sortBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Appel des exigences en provenance de la mod√©lisation</span>
<span class="w">    </span><span class="c1">// Start of user code b3cd801bacaa8215ea8b99cd493f3c64</span>
<span class="w">    </span><span class="c1">// End of user code</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">PersonneDtoImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">personnes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">gestionPersonnesProvider</span><span class="p">.</span><span class="na">retourneTous</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">sortBy</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Start of user code fc7467f7f1fb6f5cccd57590429003e4</span>
<span class="w">    </span><span class="c1">// End of user code</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">personnes</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Et enfin, le code au niveau de l'implementation de la couche de persistance : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">PersonneDtoImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">retourneTous</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">sortBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Start of user code 1f82841b68b9a27af5cfcf572412847c</span>
<span class="w">    </span><span class="c1">// End of user code</span>

<span class="w">    </span><span class="n">Page</span><span class="o">&lt;</span><span class="n">PersonneEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pageEntity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">retourneTous_invoke</span><span class="p">(</span><span class="n">PageRequest</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">Sort</span><span class="p">.</span><span class="na">by</span><span class="p">(</span><span class="n">sortBy</span><span class="p">)));</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">pageEntity</span><span class="p">.</span><span class="na">getContent</span><span class="p">().</span><span class="na">stream</span><span class="p">().</span><span class="na">map</span><span class="p">(</span><span class="n">o</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">PersonneMapper</span><span class="p">.</span><span class="na">toDto</span><span class="p">(</span><span class="n">o</span><span class="p">)).</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="mise-en-place-du-circuit-breaker">Mise en place du "circuit-breaker"</h3>
<p>Un "circuit-breaker" est un m√©canisme qui emp√™che un syst√®me de continuer √† appeler un service en √©chec, afin de limiter la propagation des erreurs et de laisser le service d√©faillant se r√©tablir.</p>
<p>Dans le contexte des services REST il s'agit d'un m√©canisme de protection qui interrompt temporairement les appels vers un service distant lorsqu‚Äôun certain seuil d‚Äô√©checs est atteint, afin d‚Äô√©viter de surcharger un service instable, de pr√©server les ressources du client, et am√©liorer la r√©silience globale de l‚Äôarchitecture. </p>
<p>Les objectifs sont donc de : </p>
<ul>
<li>Limiter l‚Äôimpact des pannes de services tiers ou en cascade.</li>
<li>R√©duire les temps de r√©ponse c√¥t√© client en √©vitant des appels vou√©s √† l‚Äô√©chec.</li>
<li>Permettre la reprise progressive d‚Äôun service REST une fois r√©tabli.</li>
</ul>
<p>Avec <strong>Pacman</strong> la mod√©lisation d'un tel service s'effectue par l'ajout de services de type "<strong><em>Required</em></strong>", √† la diff√©rence des services de type "<strong><em>Provided</em></strong>" utilis√©s jusqu'√† maintenant. La mod√©lisation n'impacte ni la couche domaine, ni la couche application au niveau de l'infrastructure, seul un "<em>adapter</em>" est ajout√© avec pour nom <strong><em>[nom du service]ExternalProvider</em></strong> (au lieu de <strong><em>[nom du service]JpaProvider</em></strong>)</p>
<p><img alt="Entity manager" src="images/pcm-model-adv-circuit-15.png"/></p>
<p>Le code g√©n√©r√© au niveau de l'impl√©mentation du service d'infrastructure est le suivant : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@AdapterService</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GestionAppelsExternesExternalProviderImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">GestionAppelsExternesProvider</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="nd">@CircuitBreaker</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"estUtilisateurFaceBookCircuitBreaker"</span><span class="p">,</span><span class="w"> </span><span class="n">fallbackMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"estUtilisateurFaceBookFallback"</span><span class="p">)</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="nf">estUtilisateurFaceBook</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">uuid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">     </span><span class="c1">// Start of user code ee90aef40f6fecc8cc4976ab9a5abe88</span>
<span class="w">     </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DemoNotImplementedException</span><span class="p">(</span><span class="s">"La m√©thode 'estUtilisateurFaceBook' n'a pas √©t√© impl√©ment√©e"</span><span class="p">);</span>
<span class="w">     </span><span class="c1">// End of user code</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * M√©thode de repli pour {@link #estUtilisateurFaceBook} en cas d'√©chec ou</span>
<span class="cm">   * d'indisponibilit√© du service externe. Il est √† noter que cette m√©thode doit</span>
<span class="cm">   * avoir exactement les m√™mes param√®tres (dans le m√™me ordre) que la m√©thode</span>
<span class="cm">   * principale, seule une exception de type 'Throwable' est ajout√©e en fin de</span>
<span class="cm">   * signature.</span>
<span class="cm">   */</span>
<span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="nf">estUtilisateurFaceBookFallback</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">uuid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Start of user code a5dbdd4d474e95235c3ac793abc576e5</span>
<span class="w">    </span><span class="c1">// Logique de repli (par exemple, retourner une r√©ponse par d√©faut)</span>

<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DemoNotImplementedException</span><span class="p">(</span>
<span class="w">      </span><span class="s">"La m√©thode 'estUtilisateurFaceBook' de fallback n'a pas √©t√© impl√©ment√©e"</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// End of user code</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Le param√®trage du nombre de tentatives d'appel, du d√©lai entre chaque appel, etc.. est disponible au niveau du fichier de configuration de l'application : "<strong><em>application.properties</em></strong>".</p>
<h3 id="exemple-de-modelisation-avancee">Exemple de mod√©lisation avanc√©e</h3>
<p>Voici √† titre d'exemple, une mod√©lisation pour la couche de persistance qui permet de visualiser rapidement l'ensemble des possibilit√©s disponibles, on ne s'interesse ici qu'a l'entit√© principale afin principalement de montrer les diff√©rentes relations g√©n√©r√©es. </p>
<div align="center">
<img alt="Entity manager" src="images/pcm-model-adv-entity-8.png"/>
</div>
<p>Et le code des relations associ√©es pour l'entit√© principale <em>PersonneDetailEntityImpl</em> : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_PERSONNE_DETAIL"</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"SCH"</span><span class="p">)</span>
<span class="nd">@SequenceGenerator</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"PERSONNEDETAIL_SEQUENCE"</span><span class="p">,</span><span class="w"> </span><span class="n">sequenceName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"SCH.TBL_PERSONNE_DETAIL_SEQ"</span><span class="p">,</span><span class="w"> </span><span class="n">allocationSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="nd">@SQLDelete</span><span class="p">(</span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"UPDATE SCH.TBL_PERSONNE SET xtopsup = true WHERE TBL_PERSONNE_DETAIL_ID = ?"</span><span class="p">)</span>
<span class="nd">@SQLRestriction</span><span class="p">(</span><span class="s">"xtopsup = false"</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PersonneDetailEntityImpl</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">DemoEntityAbs</span><span class="w"> </span><span class="p">{</span>

<span class="w">   </span><span class="c1">// CONSTANTES ET ATTRIBUTS</span>
<span class="w">   </span><span class="c1">// Start of user code d7bbcbe6a7acc56177d5556a145d9bb1</span>

<span class="w">   </span><span class="c1">// End of user code</span>

<span class="w">   </span><span class="cm">/** Id. */</span>
<span class="w">   </span><span class="nd">@Id</span>
<span class="w">   </span><span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GenerationType</span><span class="p">.</span><span class="na">SEQUENCE</span><span class="p">,</span><span class="w"> </span><span class="n">generator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"PERSONNEDETAIL_SEQUENCE"</span><span class="p">)</span>
<span class="w">   </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_PERSONNE_DETAIL_ID"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">personneDetail_id</span><span class="p">;</span>

<span class="w">   </span><span class="cm">/** Le num√©ro de s√©curit√© sociale pour la personne. */</span>
<span class="w">   </span><span class="c1">// Start of user code 2fc90baa97ca768b902d1318a899060e</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="w">   </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"NUMSECU"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">numSecu</span><span class="p">;</span>

<span class="w">   </span><span class="cm">/** L'√¢ge de la personne. */</span>
<span class="w">   </span><span class="c1">// Start of user code 7d637d275668ed6d41a9b97e6ad3a556</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="w">   </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"AGE"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>

<span class="w">   </span><span class="cm">/** Le genre de la personne. */</span>
<span class="w">   </span><span class="c1">// Start of user code 7f80095aea4d66af1121f1fbe916066d</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="w">   </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"GENRE"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">genre</span><span class="p">;</span>

<span class="w">   </span><span class="cm">/** La date de naissance pour la personne. */</span>
<span class="w">   </span><span class="c1">// Start of user code 204e5968d93f74819a495317664f9a8a</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="w">   </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"DATENAISSANCE"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">columnDefinition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"DATE"</span><span class="p">)</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">dateNaissance</span><span class="p">;</span>

<span class="w">   </span><span class="cm">/** Le nom pour la personne (h√©rit√©). */</span>
<span class="w">   </span><span class="c1">// Start of user code aee37c30f5d091a495526f636a3527bb</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="w">   </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"NOM"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">;</span>

<span class="w">   </span><span class="cm">/** Le pr√©nom pour la personne (h√©rit√©). */</span>
<span class="w">   </span><span class="c1">// Start of user code 209f4226d4ca0e91af3607674c06a9bc</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="w">   </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"PRENOM"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">prenom</span><span class="p">;</span>

<span class="w">   </span><span class="cm">/** La liste des adresses pour la personne. */</span>
<span class="w">   </span><span class="c1">// Start of user code d6d3f83da68f8d7a4af10f3792bc571a</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="w">   </span><span class="nd">@OneToMany</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">,</span><span class="w"> </span><span class="n">mappedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"personneDetail"</span><span class="p">)</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AdresseEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">aPourAdresse</span><span class="p">;</span>

<span class="w">   </span><span class="cm">/** La m√®re pour la personne. */</span>
<span class="w">   </span><span class="c1">// Start of user code 4f8b5bff6538bc508d8cc45e8a1ec6dd</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="w">   </span><span class="nd">@ManyToOne</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">)</span>
<span class="w">   </span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"APOURMERE_ID"</span><span class="p">,</span><span class="w"> </span><span class="n">referencedColumnName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_PERSONNEDETAIL_ID"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">PersonneDetailEntityImpl</span><span class="w"> </span><span class="n">aPourMere</span><span class="p">;</span>

<span class="w">   </span><span class="cm">/** Le p√®re pour la personne. */</span>
<span class="w">   </span><span class="c1">// Start of user code 88bb032457e70f1191a3c6542f38fce4</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="w">   </span><span class="nd">@ManyToOne</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">)</span>
<span class="w">   </span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"APOURPERE_ID"</span><span class="p">,</span><span class="w"> </span><span class="n">referencedColumnName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_PERSONNEDETAIL_ID"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">PersonneDetailEntityImpl</span><span class="w"> </span><span class="n">aPourPere</span><span class="p">;</span>

<span class="w">   </span><span class="cm">/** La voiture principale pour la personne. */</span>
<span class="w">   </span><span class="c1">// Start of user code 08432f639b4515c84e5338822fea6baf</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="w">   </span><span class="nd">@ManyToOne</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">)</span>
<span class="w">   </span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_VOITURE_ID"</span><span class="p">,</span><span class="w"> </span><span class="n">referencedColumnName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_VOITURE_ID"</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">VoitureEntityImpl</span><span class="w"> </span><span class="n">voiture</span><span class="p">;</span>

<span class="w">   </span><span class="cm">/** La liste des fr√®res pour la personne. */</span>
<span class="w">   </span><span class="c1">// Start of user code d06fd39424c52878b6c1b055a2469523</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="w">   </span><span class="nd">@ManyToMany</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">,</span><span class="w"> </span><span class="n">targetEntity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PersonneDetailEntityImpl</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">   </span><span class="nd">@JoinTable</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_PERSONNEDETAILAPOURFRERE"</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"SCH"</span><span class="p">,</span><span class="w"> </span><span class="n">joinColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_PERSONNEDETAIL_ID"</span><span class="p">)</span>
<span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="n">inverseJoinColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_PERSONNEDETAIL_1_ID"</span><span class="p">))</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">PersonneDetailEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">aPourFrere</span><span class="p">;</span>

<span class="w">   </span><span class="cm">/** La liste des loisirs pour la personne. */</span>
<span class="w">   </span><span class="c1">// Start of user code 373fdd8ab6e4368cee4c045b1594d983</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="w">   </span><span class="nd">@ManyToMany</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">,</span><span class="w"> </span><span class="n">targetEntity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoisirEntityImpl</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">   </span><span class="nd">@JoinTable</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_PERSONNEDETAILAPOURLOISIR"</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"SCH"</span><span class="p">,</span><span class="w"> </span><span class="n">joinColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_PERSONNEDETAIL_ID"</span><span class="p">)</span>
<span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="n">inverseJoinColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_LOISIR_ID"</span><span class="p">))</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">LoisirEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">aPourLoisir</span><span class="p">;</span>

<span class="w">   </span><span class="cm">/** La liste des soeurs pour la personne. */</span>
<span class="w">   </span><span class="c1">// Start of user code aa719428a3d8ea0dc0813733b65145c3</span>
<span class="w">   </span><span class="c1">// End of user code</span>
<span class="w">   </span><span class="nd">@ManyToMany</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">,</span><span class="w"> </span><span class="n">targetEntity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PersonneDetailEntityImpl</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">   </span><span class="nd">@JoinTable</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_PERSONNEDETAILAPOURSOEUR"</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"SCH"</span><span class="p">,</span><span class="w"> </span><span class="n">joinColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_PERSONNEDETAIL_ID"</span><span class="p">)</span>
<span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="n">inverseJoinColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TBL_PERSONNEDETAIL_1_ID"</span><span class="p">))</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">PersonneDetailEntityImpl</span><span class="o">&gt;</span><span class="w"> </span><span class="n">aPourSoeur</span><span class="p">;</span>

<span class="w">   </span><span class="n">etc</span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<p>Au niveau du script de cr√©ation pour la base de donn√©es, comme il y a une notion d'h√©ritage qui a √©t√© mod√©lis√©e (uniquement pour pouvoir renvoyer des objets <em>personneEntityIml</em> et <em>personneDetailEntityImpl</em>, une seule table est cr√©e, la table <em>TBL_PERSONNE_DETAIL</em>. </p>
<div class="codehilite"><pre><span></span><code><span class="cm">/******************************************************************/</span>
<span class="cm">/* Base de donnees:      h2                                       */</span>
<span class="cm">/* Application:          demo                                     */</span>
<span class="cm">/* Date de creation:     13/05/2025 10:55:16                      */</span>
<span class="cm">/******************************************************************/</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* Sequences                                                      */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">PERSONNE_DETAIL_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">LOISIR_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">ADRESSE_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">VOITURE_SEQ</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : PERSONNE                                               */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PERSONNE_DETAIL</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table PERSONNE */</span>
<span class="w">  </span><span class="n">PERSONNE_DETAIL_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">NUMSECU</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">AGE</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="w">  </span><span class="n">GENRE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">DATENAISSANCE</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">  </span><span class="n">NOM</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">PRENOM</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">XTOPSUP</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">'false'</span><span class="p">,</span>
<span class="w">  </span><span class="n">XDMAJ</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">XUUID</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">APOURMERE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">APOURPERE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">VOITURE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">PERSONNE_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">PERSONNEDETAIL_IDX1_1</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">PERSONNE</span><span class="p">(</span><span class="n">APOURMERE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">PERSONNEDETAIL_IDX1_2</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">PERSONNE</span><span class="p">(</span><span class="n">APOURPERE_ID</span><span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">PERSONNEDETAIL_IDX1_3</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">PERSONNE</span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">PERSONNE</span><span class="p">.</span><span class="n">PERSONNE_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table PERSONNE'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">PERSONNE</span><span class="p">.</span><span class="n">NUMSECU</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Le num√©ro de s√©curit√© sociale pour la personne'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">PERSONNE</span><span class="p">.</span><span class="n">AGE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'L''√¢ge de la personne'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">PERSONNE</span><span class="p">.</span><span class="n">GENRE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Le genre de la personne'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">PERSONNE</span><span class="p">.</span><span class="n">DATENAISSANCE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'La date de naissance pour la personne'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">PERSONNE</span><span class="p">.</span><span class="n">NOM</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Le nom de la personne'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">PERSONNE</span><span class="p">.</span><span class="n">PRENOM</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Le pr√©nom de la personne'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">PERSONNE</span><span class="p">.</span><span class="n">APOURMERE_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'La m√®re pour la personne'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">PERSONNE</span><span class="p">.</span><span class="n">APOURPERE_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Le p√®re pour la personne'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">PERSONNE</span><span class="p">.</span><span class="n">VOITURE_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'La personne peut avoir une voiture principale'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : LOISIR                                                 */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">LOISIR</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table LOISIR */</span>
<span class="w">  </span><span class="n">LOISIR_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">TYPE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">XTOPSUP</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">'false'</span><span class="p">,</span>
<span class="w">  </span><span class="n">XDMAJ</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">XUUID</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">LOISIR_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">LOISIR_ID</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">LOISIR</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Les loisirs pratiqu√©s par des personnes'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">LOISIR</span><span class="p">.</span><span class="n">LOISIR_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table LOISIR'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">LOISIR</span><span class="p">.</span><span class="k">TYPE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Le type pour le loisir'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : ADRESSE                                                */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">ADRESSE</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table ADRESSE */</span>
<span class="w">  </span><span class="n">ADRESSE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">RUE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">CODEPOSTAL</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">VILLE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">XTOPSUP</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">'false'</span><span class="p">,</span>
<span class="w">  </span><span class="n">XDMAJ</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">XUUID</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">PERSONNE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">ADRESSE_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">ADRESSE_ID</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">ADRESSE_IDX1_1</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">ADRESSE</span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">ADRESSE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'La liste des adresses pour les personnes'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">ADRESSE</span><span class="p">.</span><span class="n">ADRESSE_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table ADRESSE'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">ADRESSE</span><span class="p">.</span><span class="n">RUE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'La rue pour l''adresse'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">ADRESSE</span><span class="p">.</span><span class="n">CODEPOSTAL</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Le code postal pour l''adresse'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">ADRESSE</span><span class="p">.</span><span class="n">VILLE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'La ville pour l''adresse'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">ADRESSE</span><span class="p">.</span><span class="n">PERSONNE_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Une personne peut avoir de une √† plusieurs adresses'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE : VOITURE                                                */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">VOITURE</span>
<span class="p">(</span>
<span class="w">  </span><span class="cm">/* PK de la table VOITURE */</span>
<span class="w">  </span><span class="n">VOITURE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">MARQUE</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">PUISSANCEFISCALE</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="w">  </span><span class="n">XTOPSUP</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">'false'</span><span class="p">,</span>
<span class="w">  </span><span class="n">XDMAJ</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">XUUID</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">VOITURE_PK1_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">VOITURE_ID</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">VOITURE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'La liste des voitures principales pour les personnes'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">VOITURE</span><span class="p">.</span><span class="n">VOITURE_ID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Cl√© primaire pour la table VOITURE'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">VOITURE</span><span class="p">.</span><span class="n">MARQUE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'La marque pour la voiture'</span><span class="p">;</span>
<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">VOITURE</span><span class="p">.</span><span class="n">PUISSANCEFISCALE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'La puissance fiscale pour la voiture'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE DE LIAISON : PERSONNEDETAIL_APOURFRERE                   */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PERSONNEDETAIL_APOURFRERE</span>
<span class="p">(</span>
<span class="w">  </span><span class="n">PERSONNE_DETAIL_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">PERSONNE_DETAIL_RECURSIVE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">PERSONNEDETAILAPOURFRERE_PK2_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">,</span><span class="w"> </span><span class="n">PERSONNE_1_ID</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PERSONNEDETAIL_APOURFRERE</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'La liste des fr√®res pour la personne'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE DE LIAISON : PERSONNEDETAIL_APOURLOISIR                  */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PERSONNEDETAIL_APOURLOISIR</span>
<span class="p">(</span>
<span class="w">  </span><span class="n">PERSONNE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">LOISIR_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">PERSONNEDETAILAPOURLOISIR_PK2_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">,</span><span class="w"> </span><span class="n">LOISIR_ID</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PERSONNEDETAILA_POURLOISIR</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'Une personne peut partiquer de 0 √† plusieurs loisirs'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* TABLE DE LIAISON : PERSONNEDETAIL_APOURSOEUR                    */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PERSONNEDETAILAPOURSOEUR</span>
<span class="p">(</span>
<span class="w">  </span><span class="n">PERSONNE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="n">PERSONNE_DETAIL_RECURSIVE_ID</span><span class="w"> </span><span class="nb">NUMBER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="k">constraint</span><span class="w"> </span><span class="n">PERSONNEDETAILAPOURSOEUR_PK2_1</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">,</span><span class="w"> </span><span class="n">PERSONNE_1_ID</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">comment</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PERSONNEDETAIL_APOURSOEUR</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s1">'La liste des soeurs pour la personne'</span><span class="p">;</span>

<span class="cm">/******************************************************************/</span>
<span class="cm">/* Contraintes                                                    */</span>
<span class="cm">/******************************************************************/</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PERSONNE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">PERSONNE_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">APOURMERE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">PERSONNE</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PERSONNE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">PERSONNE_FK1_2</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">APOURPERE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">PERSONNE</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PERSONNE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">PERSONNE_FK1_3</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">PERSONNE</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">ADRESSE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">ADRESSE_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">PERSONNE</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PERSONNEDETAIL_APOURFRERE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">PERSONNEDETAILAPOURFRERE_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">PERSONNE</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PERSONNEDETAIL_APOURFRERE</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">PERSONNEDETAILAPOURFRERE_FK1_2</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">PERSONNE</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PERSONNEDETAIL_APOURLOISIR</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">PERSONNEDETAILAPOURLOISIR_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">PERSONNE</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PERSONNEDETAIL_APOURLOISIR</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">PERSONNEDETAILAPOURLOISIR_FK1_2</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">LOISIR_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">LOISIR</span><span class="w"> </span><span class="p">(</span><span class="n">LOISIR_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PERSONNEDETAIL_APOURSOEUR</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">PERSONNEDETAILAPOURSOEUR_FK1_1</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">PERSONNE</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">);</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PERSONNEDETAIL_APOURSOEUR</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="n">PERSONNEDETAILAPOURSOEUR_FK1_2</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">PERSONNE</span><span class="w"> </span><span class="p">(</span><span class="n">PERSONNE_ID</span><span class="p">);</span>
</code></pre></div>
<p>Au niveau de la couche domaine avec les objets m√©tier on retouve le DTO, comme plusieurs champs ont √©t√© marqu√©s comme obligatoires, la m√©thode de validation est la suivante : </p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="n">PersonneDetailDtoImpl</span><span class="w"> </span><span class="nf">validate</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DemoValidationException</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="n">ValidatorUtils</span><span class="p">.</span><span class="na">checkMandatory</span><span class="p">(</span><span class="s">"numSecu"</span><span class="p">,</span><span class="w"> </span><span class="n">numSecu</span><span class="p">,</span><span class="w"> </span><span class="n">errors</span><span class="p">);</span>
<span class="w">    </span><span class="n">ValidatorUtils</span><span class="p">.</span><span class="na">checkMandatory</span><span class="p">(</span><span class="s">"genre"</span><span class="p">,</span><span class="w"> </span><span class="n">genre</span><span class="p">,</span><span class="w"> </span><span class="n">errors</span><span class="p">);</span>
<span class="w">    </span><span class="n">ValidatorUtils</span><span class="p">.</span><span class="na">checkMandatory</span><span class="p">(</span><span class="s">"nom"</span><span class="p">,</span><span class="w"> </span><span class="n">nom</span><span class="p">,</span><span class="w"> </span><span class="n">errors</span><span class="p">);</span>
<span class="w">    </span><span class="n">ValidatorUtils</span><span class="p">.</span><span class="na">checkMandatory</span><span class="p">(</span><span class="s">"prenom"</span><span class="p">,</span><span class="w"> </span><span class="n">prenom</span><span class="p">,</span><span class="w"> </span><span class="n">errors</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">errors</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DemoValidationException</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">errors</span><span class="p">.</span><span class="na">toArray</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[</span><span class="n">errors</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="o">]</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Enfin les m√©thodes "<strong><em>equals(), hashcode() et toString()</em></strong>" ont √©t√© red√©finies, ici par exemple le code de la m√©thode "<strong><em>equals()</em></strong>" : </p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">equals</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">PersonneDetailDtoImpl</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">PersonneDetailDtoImpl</span><span class="w"> </span><span class="n">personneDetail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PersonneDetailDtoImpl</span><span class="p">)</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">personneDetail_id</span><span class="p">,</span><span class="w"> </span><span class="n">personneDetail_id</span><span class="p">)</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">numSecu</span><span class="p">,</span><span class="w"> </span><span class="n">personneDetail</span><span class="p">.</span><span class="na">numSecu</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">age</span><span class="p">,</span><span class="w"> </span><span class="n">personneDetail</span><span class="p">.</span><span class="na">age</span><span class="p">)</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">genre</span><span class="p">,</span><span class="w"> </span><span class="n">personneDetail</span><span class="p">.</span><span class="na">genre</span><span class="p">)</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">dateNaissance</span><span class="p">,</span><span class="w"> </span><span class="n">personneDetail</span><span class="p">.</span><span class="na">dateNaissance</span><span class="p">)</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">nom</span><span class="p">,</span><span class="w"> </span><span class="n">personneDetail</span><span class="p">.</span><span class="na">nom</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">prenom</span><span class="p">,</span><span class="w"> </span><span class="n">personneDetail</span><span class="p">.</span><span class="na">prenom</span><span class="p">)</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">xtopsup</span><span class="p">,</span><span class="w"> </span><span class="n">personneDetail</span><span class="p">.</span><span class="na">xtopsup</span><span class="p">)</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">xdmaj</span><span class="p">,</span><span class="w"> </span><span class="n">personneDetail</span><span class="p">.</span><span class="na">xdmaj</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">xuuid</span><span class="p">,</span><span class="w"> </span><span class="n">personneDetail</span><span class="p">.</span><span class="na">xuuid</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="validation-de-la-modelisation">‚úîÔ∏è Validation de la mod√©lisation</h2>
<hr/>
<p>Bien que vu pr√©c√©demment, un chapitre est toutefois consacr√© exclusivement √† ce "g√©n√©rateur". Comme pr√©cit√©, la validation de la mod√©lisation est automatiquement lanc√©e avant chaque demande de g√©n√©ration pour la couche de persistance, la couche de service ou encore la cr√©ation des scripts SQL.</p>
<ul>
<li>Si aucune erreur n'est d√©tect√©e, le g√©n√©rateur est alors activ√© et la g√©n√©ration est effectu√©e.</li>
<li>En cas d'erreur, une fen√™tre est affich√©e et la poursuite de la g√©n√©ration est stopp√©e (ne pas tenir compte du "<em>java.lang.reflect.invocationTargetException</em>").</li>
</ul>
<div align="center">
<img alt="Pagination" src="images/pcm-gen-validation-1.png" width="500"/>
</div>
<ul>
<li>Il est alors possible de visualiser le rapport au niveau du projet de mod√©lisation en ouvrant le fichier <strong><em>[nom de l'application]-validation.log</em></strong>. Ce fichier permet de cibler l'objet en cause, d'afficher la ou les erreur(s) rencontr√©e(s) et de proposer une solution pour le contournement de chaque erreur.</li>
</ul>
<pre>
---------------------------------------------------------------------------------------------------------------------------------------------------
 objet                                       | erreur rencontr√©e               | solution potentielle                                             |
---------------------------------------------------------------------------------------------------------------------------------------------------
 referentiel.GestionPersonnes.chercheParId() | Op√©ration sans statut de retour | Attachez un code statut au param√®tre de retour pour une op√©ration|
 referentiel.GestionPersonnes.retourneTous() | Op√©ration sans statut de retour | Attachez un code statut au param√®tre de retour pour une op√©ration|

</pre>
<ul>
<li>Il est aussi possible de lancer directement la v√©rification du mod√®le qui se soldera obligatoirement par l'affichage d'une fen√™tre indiquant soit la pr√©sence d'erreur(s) de mod√©lisation, soit la bonne prise en compte du mod√®le.</li>
</ul>
<h2 id="deploiement-de-lapplication">üì¶ D√©ploiement de l'application</h2>
<hr/>
<p>Ce paragraphe sera compl√©t√© prochainement.</p>
<h2 id="problemes-courants-et-resolution">‚ùì Probl√®mes Courants et R√©solution</h2>
<hr/>
<p>‚Ä¢ <strong>Quand je relance une g√©n√©ration j'ai des erreurs au niveau de mes classes √† cause de donn√©es manquantes dans les imports</strong> : ceci est une probl√©matique li√©e plus pr√©cis√©ment √† des modifications de mod√©lisation suite √† g√©n√©rations ant√©rieures. </p>
<p><strong>Pacman</strong>, afin de conserver les imports non g√©n√©r√©s (ceux sp√©cifiquement (et √©ventuellement) rajout√©s par les d√©veloppeurs) est oblig√© de g√©n√©rer les imports entre balise de type "<em>user code</em>". Ainsi, lors des futures demandes de g√©n√©ration, les imports utilisateurs ne sont pas √©cras√©s. </p>
<p>La probl√©matique est que, en cons√©quence, il devient impossible au g√©n√©rateur de cr√©er de nouveaux imports si besoin. Bien souvent ces imports concernent des listes ou des sets, d'ou le message envoy√© par l'IDE indiquant qu'il ne sait pas les r√©soudre et que cela n√©cessite une intervention utilisateur.</p>
<p>Il n'est par ailleurs pas possible au niveau des imports de cr√©er une section libre pour la g√©n√©ration et une section "<em>user code</em>" pour les imports sp√©cifiques utilisateurs car l'organisation automatique ne fonctionne pas si les balises sont positionn√©es diff√©rement. </p>
<p>L'unique solution pour l'instant consiste donc √† lancer une organisation automatique des imports manuellement sur les diff√©rentes classes en erreur et effectuer les choix n√©cessaires. Lors de la prochaine demande de g√©n√©ration, les imports √©tant reconstitu√©s, les classes ne devraient plus √™tre en erreur.</p>
<p>‚Ä¢ <strong>Suite √† demande de g√©n√©ration, mes classes ont des warnings</strong> :  en ouvrant une classe, je vois que de nombreux imports ne sont pas utilis√©s. Pourtant, au niveau de mon fichier "<em>project.properties</em>" je ne suis pas en mode debug. </p>
<p>Il peut arriver que, suite √† une demande de g√©n√©ration (pour une raison encore non expliqu√©e), les t√¢ches de fin de traitement ne soient pas lanc√©es. L'organisation automatique des imports n'est alors pas activ√©e et comme <strong>Pacman</strong> dans sa politique de gestion des imports g√©n√®re plus d'imports que n√©cessaires, ceux-ci ne sont alors pas supprim√©s. Il suffit simplement de relancer une g√©n√©ration pour r√©soudre le probl√®me.</p>
<h2 id="annexes">üìé Annexes</h2>
<hr/>
<p>‚Ä¢ Liste des m√©tadonn√©es disponibles (certaines m√©tadonn√©es sont pr√©sentes mais ne sont pas encore actives, ou seront probablement supprim√©es suite √† √©tudes. Par ailleurs, certaines m√©tadonn√©es ne concernent pas le framework Spring Boot (ne pas oublier que <strong>Pacman</strong> est un g√©n√©rateur multi-frameworks et que dans un avenir proche, le framework Spi4j sera aussi inclu).</p>
<p>Ces m√©tadonn√©es sont pour l'instant toujours list√©es mais avec une ic√¥ne üö´. </p>
<table>
<thead>
<tr>
<th>M√©tadonn√©e</th>
<th>Corps</th>
<th>Description</th>
<th>S'applique sur</th>
</tr>
</thead>
<tbody>
<tr>
<td>PHYSICAL_NAME</td>
<td>OUI</td>
<td>Nom pour la table</td>
<td>ENTITY</td>
</tr>
<tr>
<td>PHYSICAL_SHORT_NAME</td>
<td>OUI</td>
<td>Nom (longues tables)</td>
<td>ENTITY, REFERENCE</td>
</tr>
<tr>
<td>PHYSICAL_DEFAULT</td>
<td>OUI</td>
<td>Valeur par d√©faut</td>
<td>ENTITY</td>
</tr>
<tr>
<td>PHYSICAL_CHECK</td>
<td>OUI</td>
<td>Contrainte de v√©rification pour insertion ou modification</td>
<td>ENTITY</td>
</tr>
<tr>
<td>PHYSICAL_UNIQUE</td>
<td>OUI</td>
<td>Contrainte d'unicit√© pour la colonne</td>
<td>ATTRIBUTE</td>
</tr>
<tr>
<td>PHYSICAL_SIZE</td>
<td>OUI</td>
<td>Taille de l'attribut</td>
<td>ATTRIBUTE</td>
</tr>
<tr>
<td>VERSION</td>
<td>OUI</td>
<td>Version de l'entit√© (implique la gestion automatique du Lock Optimiste)</td>
<td>SYSTEM, CATEGORY, DTO</td>
</tr>
<tr>
<td>REFERENTIALüö´</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>COMPUTED</td>
<td>NON</td>
<td>Champ calcul√© par le d√©veloppeur</td>
<td>ATTRIBUTE</td>
</tr>
<tr>
<td>USERüö´</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>PERMISSIONS</td>
<td>OUI</td>
<td>Op√©ration √† ex√©cuter selon permission(s)</td>
<td>OPERATION</td>
</tr>
<tr>
<td>PERMISSIONS_OR</td>
<td>OUI</td>
<td>Op√©ration √† ex√©cuter selon permission(s)</td>
<td>OPERATION</td>
</tr>
<tr>
<td>PERMISSIONS_AND</td>
<td>OUI</td>
<td>Op√©ration √† ex√©cuter selon permission(s)</td>
<td>OPERATION</td>
</tr>
<tr>
<td>VOL_NB_ROWSüö´</td>
<td>OUI</td>
<td>Nombre d'entit√©s √† cr√©er</td>
<td>ENTITY</td>
</tr>
<tr>
<td>VOL_MIN_OCCURSüö´</td>
<td>OUI</td>
<td>Nombre minimum d'√©l√©ments pour la relation</td>
<td>REFERENCE</td>
</tr>
<tr>
<td>VOL_MAX_OCCURSüö´</td>
<td>OUI</td>
<td>Nombre maximum d'√©l√©ments pour la relation</td>
<td>REFERENCE</td>
</tr>
<tr>
<td>ACCEPT_UNAUTHENTIFIEDüö´</td>
<td>NON</td>
<td>Op√©ration qui accepte un utilisateur non authentifi√©</td>
<td></td>
</tr>
<tr>
<td>PAGE_SIZEüö´</td>
<td>OUI</td>
<td>Nombre d'√©l√©ments √† retourner par page</td>
<td>OPERATION</td>
</tr>
<tr>
<td>AUTH_TOKEN</td>
<td>OUI</td>
<td>R√©cup√©ration d'un jeton d'authentification</td>
<td>OPERATION</td>
</tr>
<tr>
<td>API_VERSION</td>
<td>NON</td>
<td></td>
<td>COMPONENT</td>
</tr>
<tr>
<td>LIBRARY_NAME</td>
<td>OUI</td>
<td>Nom exact de la librairie</td>
<td>DTO</td>
</tr>
<tr>
<td>LITERAL_PARAM_VALUE</td>
<td>OUI</td>
<td>D√©finition d'une √©num√©ration complexe</td>
<td>LITERAL</td>
</tr>
<tr>
<td>LITERALS_PARAMS_STRUCT</td>
<td>OUI</td>
<td>D√©finition d'une √©num√©ration complexe</td>
<td>ENUMERATION</td>
</tr>
<tr>
<td>CASCADE_TYPE</td>
<td>OUI</td>
<td>Gestion des relations entre d√©pendances</td>
<td>REFERENCE</td>
</tr>
<tr>
<td>FETCH_LAZY</td>
<td>NON</td>
<td>Demande de chargement paresseux</td>
<td>REFERENCE</td>
</tr>
<tr>
<td>ENTITY_MANAGER</td>
<td>NON</td>
<td>Demande d'utilisation de l'entity manager</td>
<td>ENTITY</td>
</tr>
</tbody>
</table>
<p>‚Ä¢ Liste des r√®gles de validation dans les diff√©rents diagrammes.</p>
<table>
<thead>
<tr>
<th>R√®gle</th>
<th>S'applique sur</th>
</tr>
</thead>
<tbody>
<tr>
<td>Pas d'entit√© vide (sans attribut)</td>
<td>ENTITY/DTO</td>
</tr>
<tr>
<td>Pas d'attribut avec 'identifier' de coch√©</td>
<td>ENTITY</td>
</tr>
<tr>
<td>Pas d'attribut avec une cardinalit√© multiple</td>
<td>ENTITY</td>
</tr>
<tr>
<td>Pas d'attribut sans nom d√©fini</td>
<td>ENTITY/DTO</td>
</tr>
<tr>
<td>Pas d'attribut sans type d√©fini</td>
<td>ENTITY/DTO</td>
</tr>
<tr>
<td>Pas de relations r√©cursives avec le m√™me nom</td>
<td>ENTITY/DTO</td>
</tr>
<tr>
<td>Pas de relation de type 'composite'</td>
<td>ENTITY/DTO</td>
</tr>
<tr>
<td>Pas de relation entre sous-entit√©s et super-entit√©s</td>
<td>ENTITY/DTO</td>
</tr>
<tr>
<td>Pas de relations entre super-entit√©s</td>
<td>ENTITY/DTO</td>
</tr>
<tr>
<td>Pas de relation bidirectionnelle avec double navigabilit√©</td>
<td>ENTITY/DTO</td>
</tr>
<tr>
<td>Pas de relation bidirectionnelle avec (1) ou (0,1)</td>
<td>ENTITY/DTO</td>
</tr>
<tr>
<td>Pas de service avec des entit√©s (uniquement dto)</td>
<td>SOA</td>
</tr>
<tr>
<td>Pas de service sans param√®tre de retour</td>
<td>SOA</td>
</tr>
<tr>
<td>Pas de service sans code de retour</td>
<td>SOA</td>
</tr>
<tr>
<td>Pas de service non REST</td>
<td>SOA</td>
</tr>
<tr>
<td>Pas de pagination sur une op√©ration qui ne retourne pas de liste</td>
<td>SOA</td>
</tr>
<tr>
<td>Pas de pagination avec des param√®tres de pagination non 'Integer'</td>
<td>SOA</td>
</tr>
<tr>
<td>Pas de 'fault' sans code de retour</td>
<td>SOA</td>
</tr>
<tr>
<td>Pas de service avec '/' √† la fin du point de terminaison</td>
<td>SOA</td>
</tr>
<tr>
<td>Pas de service avec plusieurs param√®tres pass√©s dans le corps (body)</td>
<td>SOA</td>
</tr>
<tr>
<td>Pas de service avec plusieurs param√®tres de sortie</td>
<td>SOA</td>
</tr>
<tr>
<td>Pas de service avec des dtos pass√©s hors body (path ou query)</td>
<td>SOA</td>
</tr>
<tr>
<td>Pas de service avec des types binaires pass√©s dans le path</td>
<td>SOA</td>
</tr>
<tr>
<td>Pas de service avec TRACE (d√©sactiv√© pour raisons de s√©curit√©)</td>
<td>SOA</td>
</tr>
<tr>
<td>Pas de service OPTION avec des param√®tres en entr√©e</td>
<td>SOA</td>
</tr>
<tr>
<td>Pas de service HEAD avec un param√®tre en sortie.</td>
<td>SOA</td>
</tr>
<tr>
<td>Pas de multiples 'components' comme conteneur de services</td>
<td>SOA</td>
</tr>
<tr>
<td>Pas de multiples s√©curit√©s d√©finies au niveau du 'component'</td>
<td>SOA</td>
</tr>
</tbody>
</table>
</main>
<nav class="local-toc"><ul><li><a href="#introduction">üöÄ Introduction</a></li><li><a href="#le-plugin-et-larchitecture-hexagonale">üß© Le Plugin et l'architecture hexagonale</a></li><ul><li><a href="#pacman">Pacman</a></li><li><a href="#architecture-hexagonale">Architecture hexagonale</a></li><li><a href="#pacman-et-lhexagonal">Pacman et l'hexagonal</a></li></ul><li><a href="#installation">üõ†Ô∏è Installation</a></li><ul><li><a href="#prerequis">Pr√©requis</a></li><li><a href="#etapes">Etapes</a></li></ul><li><a href="#creation-dun-projet">‚òï Cr√©ation d'un projet</a></li><ul><li><a href="#wizard-de-creation">Wizard de cr√©ation</a></li><li><a href="#fichiers-generes">Fichiers G√©n√©r√©s</a></li></ul><li><a href="#les-fichiers-de-configuration-spring">üìù Les fichiers de configuration Spring</a></li><ul><li><a href="#applicationproperties">application.properties</a></li><ul><li><a href="#api-de-sante">Api de sant√©</a></li><li><a href="#open-api">Open Api</a></li><li><a href="#uris">URIs</a></li><li><a href="#serveur-http">Serveur HTTP</a></li><li><a href="#logging">Logging</a></li><li><a href="#les-profils">Les profils</a></li><li><a href="#cache">Cache</a></li><li><a href="#circuit-breaker">Circuit-breaker</a></li><li><a href="#coffre-fort">Coffre fort</a></li><li><a href="#datasources">Datasources</a></li></ul><li><a href="#testsproperties">tests.properties</a></li></ul><li><a href="#generation-de-la-couche-de-persistance">üõ¢Ô∏è G√©n√©ration de la couche de persistance</a></li><ul><li><a href="#modelisation">Mod√©lisation</a></li><li><a href="#generation">G√©n√©ration</a></li><li><a href="#tests">Tests</a></li></ul><li><a href="#generation-des-regles-de-gestion">üìè G√©n√©ration des r√®gles de gestion</a></li><ul><li><a href="#modelisation_1">Mod√©lisation</a></li><li><a href="#generation_1">G√©n√©ration</a></li></ul><li><a href="#generation-de-la-couche-de-service">üåê G√©n√©ration de la couche de service</a></li><ul><li><a href="#modelisation_2">Mod√©lisation</a></li><li><a href="#generation_2">G√©n√©ration</a></li><li><a href="#tests_1">Tests</a></li></ul><li><a href="#gestion-des-champs-automatiques">‚ûï Gestion des champs automatiques</a></li><ul><li><a href="#champs-predefinis">Champs pr√©d√©finis</a></li><li><a href="#cycle-de-vie">Cycle de vie</a></li></ul><li><a href="#gestion-de-la-securite">üîë Gestion de la s√©curit√©</a></li><ul><li><a href="#modelisation_3">Mod√©lisation</a></li><li><a href="#generation_3">G√©n√©ration</a></li><li><a href="#tests_2">Tests</a></li></ul><li><a href="#generation-des-relations">üß© G√©n√©ration des relations</a></li><ul><li><a href="#relation-101">Relation (1)/(0,1)</a></li><li><a href="#relation-01">Relation (0,*)/(1,*)</a></li><li><a href="#relation-recursive-101">Relation r√©cursive (1)/(0,1)</a></li><li><a href="#relation-recursive-01">Relation r√©cursive (0,*)/(1,*)</a></li><li><a href="#relation-bidirectionnelle-01">Relation bidirectionnelle (0,*)/(1,*)</a></li></ul><li><a href="#documentation-open-api">üîß Documentation Open Api</a></li><ul><li><a href="#documentation-generale">Documentation g√©n√©rale</a></li><li><a href="#documentation-des-services">Documentation des services</a></li><li><a href="#documentation-pour-les-objets-serialises">Documentation pour les objets s√©rialis√©s</a></li><li><a href="#affichage-et-tests">Affichage et tests</a></li></ul><li><a href="#generation-avancee">üìê G√©n√©ration avanc√©e</a></li><ul><li><a href="#mise-a-disposition-de-lentity-manager">Mise √† disposition de l'entity manager</a></li><li><a href="#utilisation-du-lazy-loading">Utilisation du lazy loading</a></li><li><a href="#utilisation-de-cascade">Utilisation de cascade</a></li><li><a href="#utilisation-des-transactions">Utilisation des transactions</a></li><li><a href="#utilisation-de-lheritage">Utilisation de l'h√©ritage</a></li><li><a href="#renvoie-dentites-partielles">Renvoie d'entit√©s partielles</a></li><li><a href="#domaine-et-persistances">Domaine et persistances.</a></li><li><a href="#mise-en-place-dun-service-pagine">Mise en place d'un service pagin√©</a></li><li><a href="#mise-en-place-du-circuit-breaker">Mise en place du "circuit-breaker"</a></li><li><a href="#exemple-de-modelisation-avancee">Exemple de mod√©lisation avanc√©e</a></li></ul><li><a href="#validation-de-la-modelisation">‚úîÔ∏è Validation de la mod√©lisation</a></li><li><a href="#deploiement-de-lapplication">üì¶ D√©ploiement de l'application</a></li><li><a href="#problemes-courants-et-resolution">‚ùì Probl√®mes Courants et R√©solution</a></li><li><a href="#annexes">üìé Annexes</a></li></ul></nav>
</body>
</html>